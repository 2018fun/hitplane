var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{l(n.next(t))}catch(e){o(e)}}function a(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},E8Button=function(t){function e(e,i,n){void 0===n&&(n=null);var r=t.call(this)||this;return r.param={context:null,data:null},r.isPlayCartoon=!1,r.param.context=e,r.backFun=n,r.btnImg=new egret.Bitmap,r.btnImg.texture=i,r.btnImg.touchEnabled=!0,r.addChild(r.btnImg),r.btnImg.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTouchTap,r),r.anchorOffsetX=r.btnImg.width/2,r.anchorOffsetY=r.btnImg.height/2,r}return __extends(e,t),e.prototype.changeTexture=function(t){this.btnImg.texture=t},e.prototype.onTouchTap=function(t){if(this.cartoonType=1,!this.isPlayCartoon){this.btnImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.isPlayCartoon=!0;var e=function(){this.isPlayCartoon=!1},i=function(){1==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/8,y:this.y-this.btnImg.height/8},500,egret.Ease.elasticOut).call(e,this):2==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/8,y:this.y-this.btnImg.height/8},500,egret.Ease.backOut).call(e,this):3==this.cartoonType&&egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/8,y:this.y-this.btnImg.height/8},100).call(e,this)};egret.Tween.get(this).to({scaleX:.5,scaleY:.5,x:this.x+this.btnImg.width/8,y:this.y+this.btnImg.height/8},100,egret.Ease.sineIn).call(i,this),egret.setTimeout(function(){null!=this.backFun&&(this.btnImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.backFun.apply(this.param.context,[this.param.data]))},this,300)}},e}(egret.DisplayObjectContainer);__reflect(E8Button.prototype,"E8Button");var AreaTypeEnum;!function(t){function e(t){for(var e=[],i=0;9>i;i++)e.push(t+i);return e}function i(t){for(var e=[],i=0;9>i;i++)e.push(t+9*i);return e}t.ONE_POINT=0,t.POINTS=1,t.ROW_OR_COL=2,t.POINT_EXPAND=3;var n=0,r=9,o=18,s=27,a=36,l=45,h=54,u=63,c=72;t.ROWS=[n,r,o,s,a,l,h,u,c];var d=0,g=1,p=2,y=3,f=4,_=5,m=6,w=7,E=8;t.COLS=[d,g,p,y,f,_,m,w,E],t.getOneRow=e,t.getOneCol=i}(AreaTypeEnum||(AreaTypeEnum={}));var DirectionTypeEnum;!function(t){function e(e){switch(e){case t.UP:return[9,18,7,8,10,11,26,28,27];case t.RIGHT:return[-1,-2,-19,-10,8,17,-12,6,-3];case t.DOWN:return[-9,-18,-7,-8,-10,-11,-26,-28,-27];case t.LEFT:return[1,2,19,10,-8,-17,12,-6,3];default:return console.log("direction error"),[]}}function i(e){switch(e){case t.UP:return[0,1,2,1,1,1,1,3,3,3];case t.RIGHT:return[0,0,0,-2,-1,1,2,-1,1,0];case t.DOWN:return[0,-1,-2,-1,-1,-1,-1,-3,-3,-3];case t.LEFT:return[0,0,0,2,1,-1,-2,1,-1,0];default:return console.log("direction error"),[]}}t.DIRECTION_LIST=[27,-3,-27,3],t.ERROR=-2,t.UNSET=-1,t.UP=0,t.RIGHT=1,t.DOWN=2,t.LEFT=3,t.UNCERTAIN=4,t.DIRECTION_LETTER=["U","R","D","L"],t.getGridByDirection=e,t.getRowFromHeadByDirection=i}(DirectionTypeEnum||(DirectionTypeEnum={}));var MapData=function(){function t(){this.columns=9,this.rows=9,this.numPlane=0,this._map=[],this.hasBadPlane=!1,this.headList=[],this.initialize()}return t.prototype.initialize=function(){this.numPlane=0,this._map.length=this.columns*this.rows;for(var t=0;t<this._map.length;t++)this._map[t]=new GridData(t),this._map[t].gridType=GridTypeEnum.MISS},t.prototype.clear=function(){this.numPlane=0;for(var t=0;t<this._map.length;t++)this._map[t].gridType=GridTypeEnum.MISS;this.headList=[]},t.prototype.getMapGridById=function(t){return this._map[t]},t.prototype.getMapGridByXY=function(t,e){return this._map[e*this.columns+t]},t.prototype.setMapGridTypeByPos=function(t,e,i){this._map[e*this.columns+t].gridType=i},t.prototype.setMapGridTypeByValue=function(t,e){this._map[t].gridType=e},t.prototype.setHeadDirection=function(t,e){this._map[t].direction=e},t.prototype.setBodyTypeByValue=function(t,e){this._map[t].bodyType=e},t.prototype.setDirection=function(t,e){this._map[t].direction=e},t.prototype.setGridIndex=function(t,e){this._map[t].index=e},t.prototype.checkValid=function(t,e,i){if(this.getMapGridByXY(t,e).gridType==GridTypeEnum.MISS){for(var n=e*this.columns+t,r=DirectionTypeEnum.getGridByDirection(i),o=0;o<r.length;o++)if(this._map[n+r[o]].gridType!=GridTypeEnum.MISS)return!1;return!0}return!1},t.prototype.checkForThreePlane=function(t,e,i){for(var n=this.columns*e+t,r=BadPlaceEnum.BAD_GRID_LIST,o=BadPlaceEnum.BAD_GRID_DIRECTION_LIST,s=r.length,a=0;s>a;a++){if(r[a]!=n||o[a]!=i)return egret.log("second time bad"),!0;for(var l=BadPlaceEnum.BAD_GRID_TEST_LIST[a],h=l.length,u=0;h>u;u++){var c=r[l[u]],d=o[l[u]];return this._map[c].gridType==GridTypeEnum.HEAD&&this._map[r[c]+DirectionTypeEnum.DIRECTION_LIST[d]].gridType==GridTypeEnum.BODY?(egret.log("twice bad"),!1):(egret.log("first time bad"),!0)}}},t.prototype.setPlaneGridByHead=function(t,e){return this.setPlaneGrid(t%9,Math.floor(t/9),e)},t.prototype.setPlaneGrid=function(t,e,i){if(!this.checkValid(t,e,i))return!1;if(1==this.numPlane&&!this.checkForThreePlane(t,e,i))return!1;var n=this.columns*e+t;this.setMapGridTypeByValue(n,GridTypeEnum.HEAD),this.setHeadDirection(n,i),this.setGridIndex(n,this.numPlane);for(var r=DirectionTypeEnum.getGridByDirection(i),o=0;o<r.length;o++)this.setMapGridTypeByValue(n+r[o],GridTypeEnum.BODY),this.setBodyTypeByValue(n+r[o],o),this.setDirection(n+r[o],i),this.setGridIndex(n+r[o],this.numPlane);return this.headList.push({head:n,direction:i}),!0},t.prototype.removePlane=function(t){var e=this._map[t].direction;this.setMapGridTypeByValue(t,GridTypeEnum.MISS),this.setHeadDirection(t,DirectionTypeEnum.UNSET);for(var i=DirectionTypeEnum.getGridByDirection(e),n=0;n<i.length;n++)this.setMapGridTypeByValue(t+i[n],GridTypeEnum.MISS),this.setBodyTypeByValue(t+i[n],BodyGridEnum.UNSET);this.removeHeadFromList(t)},t.prototype.removeHeadFromList=function(t){for(var e=0;e<this.headList.length;e++)(this.headList[e].head=t)&&this.headList.splice(e,1)},t.prototype.getHeadList=function(){return this.headList},t.prototype.getPlaneGrid=function(){return this._map.filter(function(t){return t.gridType!==GridTypeEnum.MISS})},Object.defineProperty(t.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),t.prototype.getPlaneGridByIndex=function(t){return this._map.filter(function(e){return e.index===t})},t}();__reflect(MapData.prototype,"MapData");var BuildingBase=function(){function t(){this.id=BuildingEnum.UNSET,this.level=0,this.top=0,this.insure=[],this.protect=!1}return t}();__reflect(BuildingBase.prototype,"BuildingBase");var BuildingControlView=function(t){function e(){var e=t.call(this)||this;return e.buf=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.controlViewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.controlViewBg),this.levelUpButton=new E8TextButton(this,RES.getRes("btn_yellow_png"),this.levelUp),this.levelUpButton.scale(.5,.5),this.levelUpButton.x=AdaptSceenUtil.curWidth()-this.levelUpButton.width-10,this.levelUpButton.y=200,this.levelUpButton.setButtonText(i18n.getInstance().getLanguage("ui_level_up")),this.addChild(this.levelUpButton),this.demolishButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.demolish),this.demolishButton.scale(.5,.5),this.demolishButton.x=AdaptSceenUtil.curWidth()-2*this.levelUpButton.width-20,this.demolishButton.y=200,this.demolishButton.setButtonText(i18n.getInstance().getLanguage("ui_demolish")),this.addChild(this.demolishButton),this.repairButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.repair),this.repairButton.scale(.5,.5),this.repairButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.repairButton.y=200,this.repairButton.visible=!1,this.repairButton.setButtonText(i18n.getInstance().getLanguage("ui_repair")),this.addChild(this.repairButton)},Object.defineProperty(e.prototype,"level",{set:function(t){this._level=t,5===this._level&&(this.levelUpButton.visible=!1)},enumerable:!0,configurable:!0}),e.prototype.levelUp=function(){CityController.getInstance().levelUpBuilding(),5===this._level&&(this.levelUpButton.visible=!1)},e.prototype.demolish=function(){CityController.getInstance().demolish()},e.prototype.repair=function(){CityController.getInstance().repairCity(this.position)},e}(egret.Sprite);__reflect(BuildingControlView.prototype,"BuildingControlView");var GridView=function(t){function e(e){var i=t.call(this)||this;return i._id=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.grid_sheet=RES.getRes("plane_sheet"),this.gridView=new egret.Bitmap,this.gridView.width=60,this.gridView.height=60,this.addChild(this.gridView)},e.prototype.updateView=function(){},e.prototype.resetView=function(){},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t),0!==this._type,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touched",{get:function(){return this._touched},set:function(t){this._touched=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(GridView.prototype,"GridView");var Panel=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){console.log("111"),this.panelBg=new egret.Bitmap,this.panelBg.texture=RES.getRes("panel_png"),this.panelBg.anchorOffsetX=this.panelBg.width/2,this.panelBg.anchorOffsetY=this.panelBg.height/2,this.addChild(this.panelBg),this.closeButton=new E8Button(this,RES.getRes("close_btn_png"),this.closePanel),this.closeButton.x=this.panelBg.x+this.panelBg.width/2-this.closeButton.width,this.closeButton.y=this.panelBg.y-this.panelBg.height/2,this.closeButton.touchEnabled=!0,this.addChild(this.closeButton),this.touchChildren=!0},e.prototype.setContent=function(){},e.prototype.updateView=function(){},e.prototype.closePanel=function(t){this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Panel.prototype,"Panel");var GasStationData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.GAS_STATION,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.level=e.level,i.mph=e.mph,i.max=e.max,i}return __extends(e,t),e}(BuildingBase);__reflect(GasStationData.prototype,"GasStationData");var RankController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.randomRankData=function(){},t.instance=null,t}();__reflect(RankController.prototype,"RankController");var RecordController=function(){function t(){if(this.recordingRound=0,this.currentRound=0,this.headRecored=[],this.hitRecorded=[],this.bulletRecorded=[],this.gridOpenRecorded=[],this.gridEachRound=[],this.girdThisRound=[],this.hittedPlane=[],this.allOpen=[],this._continuousIndex=-1,this._continuousType=GridTypeEnum.UNSET,this._continuousTimes=0,this._missTimes=0,this._bodyTimes=0,this._headTimes=0,this._indexTimes=0,this._indexOneTimes=0,this._indexTwoTimes=0,this._indexThreeTimes=0,this._indexContinuousTimes=0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.prototype.reset=function(){this.hitRecorded=[],this.headRecored=[],this.bulletRecorded=[],this.gridOpenRecorded=[],this.gridEachRound=[],this.hittedPlane=[],this._continuousIndex=-1,this._continuousTimes=0,this._continuousType=GridTypeEnum.UNSET,this._missTimes=0,this._bodyTimes=0,this._headTimes=0,this._indexOneTimes=0,this._indexThreeTimes=0,this._indexTwoTimes=0,this._indexContinuousTimes=0,this.currentRound=0;for(var t=0;81>t;t++)this.allOpen[t]=!1},t.prototype.nextRound=function(){this.currentRound++},t.prototype.recordMap=function(t){this.map=t},t.prototype.recordGridOpen=function(t){console.log(this.gridOpenRecorded),ArrayUtil.add(this.gridOpenRecorded,t.gridValue),this.girdThisRound.push(t.gridValue),this.allOpen[t.gridValue]===!1&&(this.allOpen[t.gridValue]=!0,t.gridType===GridTypeEnum.HEAD&&(ArrayUtil.add(this.headRecored,t),console.log(this.headRecored)))},t.prototype.recordEachRound=function(){this.nextRound();for(var t=[],e=0;e<this.girdThisRound.length;e++)t.push(this.girdThisRound[e]);this.gridEachRound.push(t),this.girdThisRound=[]},t.prototype.recordAction=function(t,e,i){if(void 0===e&&(e=BulletTypeEnum.MISSILE),void 0===i&&(i=!0),this.hitRecorded.push(t.gridValue),this.bulletRecorded.push(e),-1!==t.index&&ArrayUtil.add(this.hittedPlane,t.index),this.allOpen[t.gridValue]===!1&&this.isContinuous(t.index,t.gridType),e===BulletTypeEnum.ARMOR_PIERCING_MISSILE){var n=void 0,r=t.direction,o=DirectionTypeEnum.getGridByDirection(r);n=t.bodyType===GridTypeEnum.BODY?t.gridValue-o[t.bodyType]:t.gridValue,ArrayUtil.add(this.headRecored,t)}return 3===this.headRecored.length?(GameController.getInstance().gameFinished(!0),void GuideController.getInstance().guideFinished()):GuideController.getInstance().isFinished()&&t.gridType!==GridTypeEnum.HEAD&&this.bulletRecorded.length>=20?void GameController.getInstance().gameFinished(!1):void 0},t.prototype.isContinuous=function(t,e){var i=!1;return t===this._indexTimes&&(this._indexTimes++,i=!0),e===GridTypeEnum.MISS?(this._continuousType===e?(this._continuousTimes++,i=!0):(this._continuousType=GridTypeEnum.MISS,this._continuousTimes=1),this._missTimes++):e===GridTypeEnum.BODY&&(this._continuousType===GridTypeEnum.BODY?(this._continuousTimes++,i=!0):this._continuousType===GridTypeEnum.HEAD?(this._continuousTimes++,this._continuousType=GridTypeEnum.BODY,i=!0):(this._continuousType=GridTypeEnum.BODY,this._continuousTimes=1),this._bodyTimes++),e===GridTypeEnum.HEAD&&(this._continuousType===GridTypeEnum.HEAD?(this._continuousTimes++,i=!0):this._continuousType===GridTypeEnum.BODY?(this._continuousTimes++,this._continuousType=GridTypeEnum.HEAD,i=!0):(this._continuousType=GridTypeEnum.HEAD,this._continuousTimes=1),this._headTimes++),i},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"continuousType",{get:function(){return this._continuousType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"continuousTimes",{get:function(){return this._continuousTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"missTimes",{get:function(){return this._missTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bodyTimes",{get:function(){return this._bodyTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headTimes",{get:function(){return this._headTimes},enumerable:!0,configurable:!0}),t.prototype.getOneUnhitPlane=function(){return-1===this.hittedPlane.indexOf(0)?0:-1===this.hittedPlane.indexOf(1)?1:-1===this.hittedPlane.indexOf(2)?2:-1},t.prototype.getHitRecorded=function(){return this.hitRecorded},Object.defineProperty(t.prototype,"roundBullet",{get:function(){return this.bulletRecorded[this.bulletRecorded.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bulletUsed",{get:function(){return this.bulletRecorded.filter(function(t){return t!==BulletTypeEnum.GUIDED_MISSILE}).length},enumerable:!0,configurable:!0}),t.prototype.getHitPosition=function(t){return this.hitRecorded[t]},t.prototype.getBulletByIndex=function(t){return this.bulletRecorded[t]},t.prototype.getGridOpenRecorded=function(t){return this.gridOpenRecorded[t]},t.prototype.getEachGridOpenRecord=function(t){return t>=this.gridEachRound.length?[]:this.gridEachRound[t]},Object.defineProperty(t.prototype,"recordedMap",{get:function(){return this.map},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"round",{get:function(){return this.currentRound},enumerable:!0,configurable:!0}),t.prototype.isGridOpen=function(t){return this.allOpen[t]},Object.defineProperty(t.prototype,"heads",{get:function(){return this.headRecored},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(RecordController.prototype,"RecordController");var RewardController=function(){function t(){if(this.rewardList=[],this.missRewardTimes=0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.reset=function(){this.missRewardTimes=0},t.prototype.roundReward=function(){return this.hitReward},t.prototype.continuousReward=function(){switch(RecordController.getInstance().continuousType){case GridTypeEnum.MISS:break;case GridTypeEnum.BODY:var t=RecordController.getInstance().continuousTimes;t>=RewardTitleEnum.HOLY_SHIT?(SceneManager.getInstance().showTip("十连击"),GameController.getInstance().addGold(10*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.GOD_LIKE?(SceneManager.getInstance().showTip("九连击"),GameController.getInstance().addGold(9*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.MONSTER_KILL?(SceneManager.getInstance().showTip("八连击"),GameController.getInstance().addGold(8*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.WICKED_SICK?(SceneManager.getInstance().showTip("七连击"),GameController.getInstance().addGold(7*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.UNSTOPPABLE?(SceneManager.getInstance().showTip("六连击"),GameController.getInstance().addGold(6*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.MEGA_KILL?(SceneManager.getInstance().showTip("五连击"),GameController.getInstance().addGold(5*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.DOMANATING?(SceneManager.getInstance().showTip("四连击"),GameController.getInstance().addGold(4*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)):t===RewardTitleEnum.KILLING_SPREE&&(SceneManager.getInstance().showTip("三连击"),GameController.getInstance().addGold(3*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward))}},t.prototype.hitReward=function(t){var e=t.filter(function(t){return t!==GridTypeEnum.MISS}).length;if(0===e)return void this.missReward();var i=t.filter(function(t){return t===GridTypeEnum.HEAD}).length;switch(i>0&&this.headReward(i),e>=5&&this.ranmpage(e),e){case RewardTitleEnum.DOUBLE_KILL:this.doubleHit();break;case RewardTitleEnum.TRIPLE_KILL:this.tripleHit();break;case RewardTitleEnum.ULTRAKILL:this.ultraHit()}},t.prototype.headReward=function(t){switch(t){case RewardTitleEnum.DOUBLE_KILL:this.doubleKill();break;case RewardTitleEnum.TRIPLE_KILL:this.tripleKill();break;default:this.planeKill()}},t.prototype.isMissReward=function(){var t=RecordController.getInstance().missTimes;return Math.random()<.2*t-.5*this.missRewardTimes},t.prototype.missReward=function(){if(this.isMissReward())switch(SceneManager.getInstance().showTip("获得宝箱"),Math.floor(2*Math.random())){case 1:GameController.getInstance().addGold(Math.pow(2,1)*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward);case 2:BulletController.getInstance().rewardOneBullet(Math.floor(Math.random()*BulletTypeEnum.COUNT));break;case 3:}},t.prototype.planeKill=function(){SceneManager.getInstance().showTip("击中飞机头"),GameController.getInstance().addGold(Math.pow(2,1)*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.doubleKill=function(){SceneManager.getInstance().showTip("双杀"),GameController.getInstance().addGold(Math.pow(2,2)*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.tripleKill=function(){SceneManager.getInstance().showTip("三杀"),GameController.getInstance().addGold(Math.pow(2,3)*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.doubleHit=function(){SceneManager.getInstance().showTip("同时击中"),GameController.getInstance().addGold(2*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.tripleHit=function(){SceneManager.getInstance().showTip("同时击中"),GameController.getInstance().addGold(3*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.ultraHit=function(){SceneManager.getInstance().showTip("同时击中"),GameController.getInstance().addGold(4*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.ranmpage=function(t){SceneManager.getInstance().showTip("同时击中"),GameController.getInstance().addGold(t*CityController.getInstance().getBankGameReward()*Const.getInstance().baseHitReward)},t.prototype.balloonReward=function(){SceneManager.getInstance().showTip("领取气球奖励,先给你30000"),GameController.getInstance().addGold(3e4)},t.instance=null,t}();__reflect(RewardController.prototype,"RewardController");var SettingController=function(){function t(){this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"SoundPlaying",{get:function(){if(void 0===this._soundPlaying){var t=SaveDataManager.getInstance().getSoundStatus();null===t||void 0===t||""===t||"1"===t?this.SoundPlaying=!0:this._soundPlaying="1"===t?!0:!1}return this._soundPlaying},set:function(t){this._soundPlaying=t,t?(SaveDataManager.getInstance().saveSoundStatus("1"),SoundManager.getInstance().playBGM(),SoundManager.getInstance().playSound(SoundEnum.SELECT_SOUND_MP3)):(SaveDataManager.getInstance().saveSoundStatus("0"),SoundManager.getInstance().stopBGM())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lang",{get:function(){if(void 0===this._lang){var t=SaveDataManager.getInstance().getLang();null===t||void 0===t||""===t?this._lang="zh_CN":this._lang=t}return this._lang},set:function(t){SaveDataManager.getInstance().setLang(t),this._lang=t},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(SettingController.prototype,"SettingController");var Circle=function(){function t(t,e){this.data=[],this.data=e,this._length=t}return t.prototype.getNext=function(t){var e=t-1;return this.data[this.fixToPositive(e+1)%this._length]},t.prototype.getPrevious=function(t){var e=t-1;return this.data[this.fixToPositive(e-1)%this._length]},t.prototype.getArrayData=function(){return this.data},t.prototype.getData=function(t){var e=t-1;return this.data[this.fixToPositive(e)%this._length]},t.prototype.setData=function(t,e){var i=t-1;return this.data[this.fixToPositive(i)%this._length]=e,!0},Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.fixToPositive=function(t){return 0===this._length&&console.log("circle length error"),t>=0?t%this._length:this.fixToPositive(t+this._length)},t}();__reflect(Circle.prototype,"Circle");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){AdaptSceenUtil.curWidth()>AdaptSceenUtil.displayWidth()&&AdaptSceenUtil.curHeight()>AdaptSceenUtil.displayHeight()?egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.NO_SCALE:AdaptSceenUtil.curWidth()/AdaptSceenUtil.curHeight()<AdaptSceenUtil.displayWidth()/AdaptSceenUtil.displayHeight()?egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT,egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause(),CityController.getInstance().onPause()},egret.lifecycle.onResume=function(){egret.ticker.resume(),CityController.getInstance().onResume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.showLoading(),[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),[2]}})})},e.prototype.showLoading=function(){},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,15,,16]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,RES.loadConfig("resource/loading.res.json","resource/")];case 2:return e.sent(),[4,RES.loadConfig("resource/config.res.json","resource/")];case 3:return e.sent(),[4,RES.loadConfig("resource/animate.res.json","resource/")];case 4:return e.sent(),[4,RES.loadConfig("resource/placing.res.json","resource/")];case 5:return e.sent(),[4,RES.loadConfig("resource/result.res.json","resource/")];case 6:return e.sent(),[4,RES.loadGroup("config",0)];case 7:return e.sent(),[4,RES.loadGroup("loading",0)];case 8:return e.sent(),[4,RES.loadGroup("placing_scene",0)];case 9:return e.sent(),[4,RES.loadGroup("scene",0)];case 10:return e.sent(),SceneManager.getInstance().init(this.stage),[4,RES.loadGroup("away_scene",0)];case 11:return e.sent(),[4,RES.loadGroup("city_scene",0)];case 12:return e.sent(),[4,RES.loadGroup("result_scene",0)];case 13:return e.sent(),[4,RES.loadGroup("preload",0)];case 14:return e.sent(),[3,16];case 15:return t=e.sent(),console.error(t),[3,16];case 16:return[2]}})})},e.prototype.createGameScene=function(){platform.initSDK(),SceneManager.getInstance().initUIView(),AIController.getInstance().calOffline(),BuildingDataCache.getInstance(),SceneManager.getInstance().prepareScene(),GuideController.getInstance().isFinished()?SceneManager.getInstance().toCityScene():GameController.getInstance().attackOpponent()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var E8Panel=function(t){function e(e,i,n){void 0===n&&(n=null);var r=t.call(this)||this;r.param={context:null,data:null},r.isPlayCartoon=!1,r.param.context=e,r.backFun=n,r.btnImg=new egret.Bitmap,r.btnImg.texture=i,r.btnImg.anchorOffsetX=r.btnImg.width/2,r.btnImg.anchorOffsetY=r.btnImg.height/2;var o=new egret.Rectangle(30,51,150,105);return r.btnImg.scale9Grid=o,r.btnImg.scaleX=4,r.btnImg.scaleY=5,r.btnImg.touchEnabled=!0,r.addChild(r.btnImg),r}return __extends(e,t),e.prototype.changeTexture=function(t){this.btnImg.texture=t},e.prototype.onTouchTap=function(t){if(this.cartoonType=1,!this.isPlayCartoon){this.btnImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.isPlayCartoon=!0;var e=function(){this.isPlayCartoon=!1},i=function(){1==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},500,egret.Ease.elasticOut).call(e,this):2==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},500,egret.Ease.backOut).call(e,this):3==this.cartoonType&&egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},100).call(e,this)};egret.Tween.get(this).to({scaleX:.5,scaleY:.5,x:this.x+this.btnImg.width/4,y:this.y+this.btnImg.height/4},100,egret.Ease.sineIn).call(i,this),egret.setTimeout(function(){null!=this.backFun&&(this.btnImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.backFun.apply(this.param.context,[this.param.data]))},this,300)}},e}(egret.DisplayObjectContainer);__reflect(E8Panel.prototype,"E8Panel");var E8TextButton=function(t){function e(e,i,n){return void 0===n&&(n=null),t.call(this,e,i,n)||this}return __extends(e,t),e.prototype.scale=function(t,e){this.btnImg.width=this.btnImg.width*t,this.btnImg.height=this.btnImg.height*e,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},e.prototype.setButtonText=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=""),""!==i){var n=new egret.Bitmap;n.texture=RES.getRes(i),this.addChild(n)}var r=DrawUtil.textFilter(t);r.x=this.width/2+e,r.y=this.height/2,this.addChild(r)},e.prototype.setButtonEnable=function(t,e){this.changeTexture(t),this.backFun=e},e}(E8Button);__reflect(E8TextButton.prototype,"E8TextButton");var AIConst;!function(t){t.LEFT_UP=0,t.RIGHT_UP=1,t.RIGHT_DOWN=2,t.LEFT_DOWN=3,t.CENTER=4,t.TEST_POSITION=[],t.TEST_POSITION[t.LEFT_UP]=[30,40,20]}(AIConst||(AIConst={}));var AIController=function(){function t(){if(this.random=!0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){this.randomMapData=new MapData},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.randomMapData.clear()];case 1:return t.sent(),[2]}})})},t.prototype.generateRandomMap=function(){for(this.clear();this.randomMapData.numPlane<3;)this.addPlane();return this.randomMapData},t.prototype.addPlane=function(){var t=0,e=0,i=0;if(this.random)switch(t=Math.floor(4*Math.random())){case DirectionTypeEnum.UP:e=2+Math.floor(5*Math.random()),i=Math.floor(6*Math.random());break;case DirectionTypeEnum.RIGHT:e=3+Math.floor(6*Math.random()),i=2+Math.floor(5*Math.random());break;case DirectionTypeEnum.DOWN:e=2+Math.floor(5*Math.random()),i=3+Math.floor(6*Math.random());break;case DirectionTypeEnum.LEFT:e=Math.floor(6*Math.random()),i=2+Math.floor(5*Math.random())}this.randomMapData.setPlaneGrid(e,i,t)?this.randomMapData.numPlane++:this.randomMapData.clear()},t.prototype.getGridTypeById=function(t){return this.randomMapData.map[t].gridType},t.prototype.randomOpponent=function(){var t=CityController.getInstance().getTopLevel(BuildingEnum.AIRPORT);if(1===t)return[1,1,1];for(var e,i=BuildingDataCache.getInstance().getAirportDataByLevel(t),n=[],r=0;r<i.opponent;r++){var o=NumUtil.range(1,7);e=1,o>5?e=i.opponent_level:o>3?e=i.opponent_level-1:o>0&&(e=i.opponent_level-2),n.push(e)
}return n},t.prototype.calOffline=function(){var t=SaveDataManager.getInstance().getUserData().lastDate,e={time:t,missleUse:0},i=(new Date).getTime(),n=i-t;e.time=n;var r=Math.floor(n/GameConst.HOUR),o=Math.floor(n/GameConst.MINUTE),s=CityController.getInstance().getGasSpeed(),a=SaveDataManager.getInstance().getUserData().gas,l=Math.min(a,CityController.getInstance().getGasStationMax()),h=0,u=0;if(n<2*GameConst.HOUR)l=Math.min(a+s*o/60,CityController.getInstance().getGasStationMax());else{l=Math.min(a+2*s,CityController.getInstance().getGasStationMax());for(var c=0;r-3>c;c++){var d=this.randomDestroy();{if(d.id===BuildingEnum.UNSET)break;if(CityController.getInstance().isProtected(d.data.position)&&CityController.getInstance().useMissle())return void e.missleUse++;h++,d.id===BuildingEnum.GAS_STATION&&(s=CityController.getInstance().getGasSpeed()),l=Math.min(a+s,CityController.getInstance().getGasStationMax()),CityController.getInstance().destroyCity(d.data.position),u+=CityController.getInstance().calBuildingInsurePay(d.data.position)}}}console.log("赔付金额"+u),GameController.getInstance().addGold(u),new Date(t).getDate()===new Date(i).getDate()?SaveDataManager.getInstance().getUserData().setDestroyTimes(h,!1):SaveDataManager.getInstance().getUserData().setDestroyTimes(h,!0),GameController.getInstance().addGas(l-a),SaveDataManager.getInstance().getUserData().setLastDate()},t.prototype.randomDestroy=function(){var t=CityController.getInstance().getBuildings(),e=t.filter(function(t){return t.level>0});if(0===e.length)return{id:BuildingEnum.UNSET,data:null};var i=e[Math.floor(Math.random()*e.length)];return i.level-=1,{id:i.id,data:i}},t.prototype.addPlaneByBody=function(t){var e=null;console.log("generate_time"+(new Date).getTime());do e=this.generateRandomMap();while(e.map[t].gridType!==GridTypeEnum.BODY);console.log("generate_time2"+(new Date).getTime()),null!==e?GameController.getInstance().setAwayGame(e):console.log("引导地图生产错误")},t.prototype.AIPlayGame=function(){5*Math.random()},t.instance=null,t}();__reflect(AIController.prototype,"AIController");var BadPlaceEnum;!function(t){t.BAD_GRID_LIST=[4,13,20,20,24,24,31,36,37,39,40,40,40,40,41,43,44,49,56,56,60,60,67,76],t.BAD_GRID_DIRECTION_LIST=[DirectionTypeEnum.UP,DirectionTypeEnum.UP,DirectionTypeEnum.UP,DirectionTypeEnum.LEFT,DirectionTypeEnum.UP,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.UP,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.UP,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.DOWN,DirectionTypeEnum.DOWN],t.BAD_GRID_TEST_LIST=[[10,22],[23],[13,14],[10,17],[9,11],[10,17],[10,19,20],[13,15],[16],[4,13,21],[0,3,5,6],[4,14,16,21],[17,19,20,23],[2,7,9,18],[2,11,18],[7],[8,11],[3,5,12],[13,14],[6,12],[6,12],[9,11],[0],[1,12]],t.GIFT_GRID_LIST=[0,8,72,80]}(BadPlaceEnum||(BadPlaceEnum={}));var BodyGridEnum;!function(t){function e(e){return e<=t.BONE?t.BONE:e<=t.WING?t.WING:e<=t.TAIL?t.TAIL:e==t.BOTTOM?t.BOTTOM:void 0}t.UNSET=-1,t.BONE=1,t.WING=6,t.TAIL=7,t.BOTTOM=8,t.getType=e}(BodyGridEnum||(BodyGridEnum={}));var BuildingEnum;!function(t){t.buildingString=[],t.UNSET=-1,t.AIRPORT=0,t.buildingString[t.AIRPORT]="airport",t.BANK=1,t.buildingString[t.BANK]="bank",t.BULLET_SCIENCE=2,t.buildingString[t.BULLET_SCIENCE]="bullet_science",t.GAS_STATION=3,t.buildingString[t.GAS_STATION]="gas_station",t.ADVERTISE_COMPANY=4,t.buildingString[t.ADVERTISE_COMPANY]="advertise_company",t.REPAIR_FACTORY=5,t.buildingString[t.REPAIR_FACTORY]="repair_factory",t.INSURE_COMPANY=6,t.buildingString[t.INSURE_COMPANY]="insure_company",t.DEFENSE=7,t.buildingString[t.DEFENSE]="defense",t.STRATEGY_CENTER=8,t.buildingString[t.STRATEGY_CENTER]="strategy_center",t.count=8}(BuildingEnum||(BuildingEnum={}));var BulletTypeEnum;!function(t){t.BULLET_GRID={},t.BULLET_GRID_AREA=[],t.BULLET_GRID_ROW=[];var e=0;t.MISSILE=e++,t.BULLET_GRID[t.MISSILE]=[0],t.BULLET_GRID_AREA[t.MISSILE]=AreaTypeEnum.ONE_POINT,t.CROSS_BOOM=e++,t.BULLET_GRID_AREA[t.CROSS_BOOM]=AreaTypeEnum.POINTS,t.BULLET_GRID[t.CROSS_BOOM]=[-9,-1,0,1,9],t.BULLET_GRID_ROW[t.CROSS_BOOM]=[-1,0,0,0,1],t.INFRARED_ROW=e++,t.BULLET_GRID_AREA[t.INFRARED_ROW]=AreaTypeEnum.ROW_OR_COL,t.INFRARED_COL=e++,t.BULLET_GRID_AREA[t.INFRARED_COL]=AreaTypeEnum.ROW_OR_COL,t.GUIDED_MISSILE=e++,t.BULLET_GRID_AREA[t.GUIDED_MISSILE]=AreaTypeEnum.ONE_POINT,t.INCENDIARY_BOMB=e++,t.BULLET_GRID_AREA[t.INCENDIARY_BOMB]=AreaTypeEnum.POINT_EXPAND,t.ARMOR_PIERCING_MISSILE=e++,t.BULLET_GRID[t.ARMOR_PIERCING_MISSILE]=[0],t.BULLET_GRID_AREA[t.ARMOR_PIERCING_MISSILE]=AreaTypeEnum.ONE_POINT,t.NINE_PALACE_MISSILE=e++,t.BULLET_GRID_AREA[t.NINE_PALACE_MISSILE]=AreaTypeEnum.POINTS,t.BULLET_GRID[t.NINE_PALACE_MISSILE]=[-10,-9,-8,-1,0,1,8,9,10],t.BULLET_GRID_ROW[t.NINE_PALACE_MISSILE]=[-1,-1,-1,0,0,0,1,1,1],t.COUNT=e}(BulletTypeEnum||(BulletTypeEnum={}));var ColorEnum;!function(t){t.DARK_BLUE=6720510,t.BLUE=4177662,t.NATTIER_BLUE=2015226,t.CYAN=2416057,t.GREEN=1031711,t.YELLOW=16445296,t.ORANGE=16625219,t.RED=16614737,t.PINK=16535159,t.PURPLE=16017916,t.GRAY=12566463,t.colorList=[t.DARK_BLUE,t.BLUE,t.CYAN,t.GREEN,t.YELLOW,t.ORANGE,t.RED,t.PINK,t.PURPLE,t.GRAY],t.colorOrder=[t.BLUE,t.PURPLE,t.RED,t.GREEN,t.ORANGE,t.PINK]}(ColorEnum||(ColorEnum={}));var BulletController=function(){function t(){if(this.bulletList=[],this.storedBullet=null,t.instance)throw new Error("AIController singlon error")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.resetBullets=function(){this.bulletList=[];for(var t=0;3>t;t++)this.bulletList.push(this.randomOneBullet())},t.prototype.getCurrentBullet=function(){return this.bulletList[0]},t.prototype.useBullet=function(){return this.bulletList.shift()},t.prototype.rewardOneBullet=function(t){this.bulletList.unshift(t)},t.prototype.rewardBullet=function(t){this.bulletList.unshift(t),GameController.getInstance().nextAttackPhase()},t.prototype.prepareNextBullet=function(){this.randomNextBullet(),SceneManager.getInstance().awayScene.updateBullets(),GameController.getInstance().nextAttackPhase()},t.prototype.randomOneBullet=function(){var t=CityController.getInstance().getAllBuildingsByType(BuildingEnum.BULLET_SCIENCE),e=CityController.getInstance().getTopLevel(BuildingEnum.BULLET_SCIENCE),i=BulletTypeEnum.MISSILE;if(0===e)return i;for(var n=void 0,r=void 0,o=0;o<t.length;o++)if(n=t[o],r=n.then,RecordController.getInstance().getHitRecorded().length<n.first_num&&(r=n.first),Math.random()<r){i=n.bullets[Math.floor(Math.random()*n.bullets.length)];break}return i},t.prototype.randomNextBullet=function(){this.bulletList.push(this.randomOneBullet())},t.prototype.switchBullet=function(){if(null===this.storedBullet)this.storeCurrentBullet();else{var t=this.bulletList.shift();this.bulletList.unshift(this.storedBullet),this.storedBullet=t}},t.prototype.storeCurrentBullet=function(){this.storedBullet=this.bulletList.shift(),this.randomNextBullet()},Object.defineProperty(t.prototype,"stored",{get:function(){return this.storedBullet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bullets",{get:function(){return this.bulletList},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(BulletController.prototype,"BulletController");var GameConst;!function(t){t.SECOND=1e3,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR}(GameConst||(GameConst={}));var GameTypeEnum;!function(t){t.GAME_TYPE_IDLE=0,t.GAME_TYPE_MAPING=1,t.GAME_TYPE_HITTING=2,t.GAME_TYPE_DOUBLE_HITTING=3,t.GAME_TYPE_GUIDE=4}(GameTypeEnum||(GameTypeEnum={}));var GridStatusEnum;!function(t){t.COVER=0,t.KNOWN=1,t.SHOW=2,t.UNSHOW=3}(GridStatusEnum||(GridStatusEnum={}));var GridTypeEnum;!function(t){t.UNSET=-1,t.MISS=0,t.BODY=1,t.HEAD=2,t.GIFT=3,t.GOLD=4,t.TELEPORT=5}(GridTypeEnum||(GridTypeEnum={}));var GuideEnum;!function(t){t.NEW_PLAYER_GUIDE=1,t.GAME_AIM=2,t.HIT_GRID=3,t.HIT_BODY=4,t.HIT_EMPTY_GOT_BULLET=5,t.GOT_BULLET=6,t.BULLET=7,t.HIT_HEAD=8,t.THREE_PLANE_GUIDE=9,t.AWAY_GUIDE_FINISHED=10,t.TOUCH_EVERY_WHERE=1,t.TOUCH_MAP=2,t.TOUCH_BUTTON=3,t.TOUCH_BACK=4,t.GUIDE_HELP=[t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_MAP,t.TOUCH_BUTTON,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE,t.TOUCH_EVERY_WHERE]}(GuideEnum||(GuideEnum={}));var PhaseEnum=function(){function t(){}return t.PREPARE_PHASE=0,t.ATTACK_PHASE=1,t.RESULT_PHASE=2,t.END_PHASE=3,t.OVER_PHASE=4,t}();__reflect(PhaseEnum.prototype,"PhaseEnum");var PlaneTypeEnum=function(){function t(){}return t}();__reflect(PlaneTypeEnum.prototype,"PlaneTypeEnum");var RankTitleEnum;!function(t){t.King="荣耀王者"}(RankTitleEnum||(RankTitleEnum={}));var ResourceEnum;!function(t){t.GOLD="gold",t.GAS="gas"}(ResourceEnum||(ResourceEnum={}));var ResultTypeEnum;!function(t){t.WIN=1,t.FAIL=2,t.GIVE_UP=3}(ResultTypeEnum||(ResultTypeEnum={}));var RewardTitleEnum;!function(t){t.KILLING_SPREE=3,t.DOMANATING=4,t.MEGA_KILL=5,t.UNSTOPPABLE=6,t.WICKED_SICK=7,t.MONSTER_KILL=8,t.GOD_LIKE=9,t.HOLY_SHIT=10,t.DOUBLE_KILL=2,t.TRIPLE_KILL=3,t.ULTRAKILL=4,t.RAMPAGE=5}(RewardTitleEnum||(RewardTitleEnum={}));var RewardTypeEnum;!function(t){t.REWARD_TYPE_GOLD=0,t.REWARD_TYPE_BUILDING=1,t.REWARD_TYPE_BULLET=2,t.REWARD_TYPE_TIP=3,t.REWARD_TYPE_LIST=[t.REWARD_TYPE_GOLD,t.REWARD_TYPE_BUILDING,t.REWARD_TYPE_BULLET,t.REWARD_TYPE_TIP]}(RewardTypeEnum||(RewardTypeEnum={}));var SceneEnum;!function(t){t.AWAY_SCENE=0,t.CITY_SCENE=1,t.PLACING_SCENE=2,t.RESULT_SCENE=3}(SceneEnum||(SceneEnum={}));var ScoreTypeEnum;!function(t){t.NO_SCORE=0,t.YOU_ARE_CHEATER=3,t.SSS=8,t.S=10,t.A=15,t.B=20,t.C=81,t.SCORE=[t.SSS,t.S,t.A,t.B,t.C]}(ScoreTypeEnum||(ScoreTypeEnum={}));var SignTypeEnum=function(){function t(){}return t.UNSIGN=-1,t.MISS=0,t.BODY=1,t.HEAD=2,t}();__reflect(SignTypeEnum.prototype,"SignTypeEnum");var SoundEnum;!function(t){t.SELECT_SOUND_MP3="select_sound_mp3",t.CLOUD_TOUCH_MP3="cloud_touch_mp3"}(SoundEnum||(SoundEnum={}));var GridEvent=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.EventDispatcher);__reflect(GridEvent.prototype,"GridEvent");var i18n=function(){function t(){this.langData=RES.getRes("language_json")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.getLanguage=function(t){return this.langData[SettingController.getInstance().Lang][t]},t.instance=null,t}();__reflect(i18n.prototype,"i18n");var SaveDataManager=function(){function t(){this.userData=null,this.isNew=!0,this.isGuideFinished=!1,this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.getUserData=function(){return this.userData||(this.userData=new UserData),this.userData},t.prototype.saveUserData=function(){this.userData.saveUserData()},t.prototype.getFromLocal=function(t){return egret.localStorage.getItem(t)},t.prototype.saveToLocal=function(t,e){egret.localStorage.setItem(t,e)},t.prototype.saveSoundStatus=function(t){egret.localStorage.setItem("soundPlaying",t)},t.prototype.getSoundStatus=function(){return egret.localStorage.getItem("soundPlaying")},t.prototype.getLang=function(){return egret.localStorage.getItem("lang")},t.prototype.setLang=function(t){egret.localStorage.setItem("lang",t)},t.prototype.getGuide=function(){return this.userData.guide},t.prototype.setGuide=function(t){this.userData.guide=t},t.instance=null,t}();__reflect(SaveDataManager.prototype,"SaveDataManager");var SceneManager=function(){function t(){if(this.currentScene=null,this.gameLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,this.uiLayer=new egret.DisplayObjectContainer,this.effectLayer=new egret.DisplayObjectContainer,this.popLayer=new egret.DisplayObjectContainer,this.tipLayer=new egret.DisplayObjectContainer,this.headUI=null,t.instance)throw new Error("AIController singlon error")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.init=function(t){this.egretStage=t,this.saveMsg=SaveDataManager.getInstance(),this.egretStage.addChild(this.gameLayer),this.egretStage.addChild(this.uiLayer),this.egretStage.addChild(this.effectLayer),this.egretStage.addChild(this.popLayer),this.egretStage.addChild(this.tipLayer),this.egretStage.addChild(this.loadingLayer)},t.prototype.initLayer=function(t){t.x=(AdaptSceenUtil.curWidth()-AdaptSceenUtil.displayWidth())/2,t.y=(AdaptSceenUtil.curHeight()-AdaptSceenUtil.displayHeight())/2,this.egretStage.addChild(t)},t.prototype.initUIView=function(){this.headUI=new HeadUI,this.updateGas(),this.updateGold(),t.getInstance().getUILayer().addChild(this.headUI)},t.prototype.updateGold=function(){this.headUI.setGold(Math.max(this.saveMsg.getUserData().gold,0))},t.prototype.updateGas=function(){this.headUI.setGas(Math.max(this.saveMsg.getUserData().gas,0))},t.prototype.showLoading=function(){},t.prototype.prepareScene=function(){this.cityScene=new CityScene,this.awayScene=new AwayScene,this.placingScene=new PlacingScene,this.resultScene=new ResultScene,this.cityScene.x=0,this.awayScene.x=0,this.placingScene.x=0,this.resultScene.x=0},t.prototype.toResultScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.resultScene.inAnimate(),this.gameLayer.addChild(t.getInstance().resultScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.resultScene},t.prototype.toCityScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.cityScene.inAnimate(),this.gameLayer.addChild(t.getInstance().cityScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.cityScene},t.prototype.toAwayScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.awayScene.inAnimate(),this.gameLayer.addChild(t.getInstance().awayScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.awayScene},t.prototype.toPlacingScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.placingScene.inAnimate(),this.gameLayer.addChild(t.getInstance().placingScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.placingScene},t.prototype.getGameLayer=function(){return this.gameLayer},t.prototype.getEffectLayer=function(){return this.effectLayer},t.prototype.getUILayer=function(){return this.uiLayer},t.prototype.getLoadingLayer=function(){return this.loadingLayer},t.prototype.getPopLayer=function(){return this.popLayer},t.prototype.getTipLayer=function(){return this.tipLayer},t.prototype.openBuildingPop=function(t){this.popLayer.addChild(new BuildingPop(t))},t.prototype.showTip=function(t){var e=this;0!==this.tipLayer.numChildren&&this.tipLayer.removeChildren();var i=new FlippyTip(t);i.x=AdaptSceenUtil.curWidth()/2,i.y=AdaptSceenUtil.curHeight()/2,egret.setTimeout(function(){e.tipLayer.contains(i)&&e.tipLayer.removeChild(i)},this,1500),this.tipLayer.addChild(i)},t.instance=null,t}();__reflect(SceneManager.prototype,"SceneManager");var SoundManager=function(){function t(){this.init()}return t.prototype.init=function(){if(null!==t.instance)throw new Error("single instance error")},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.playBGM=function(){SettingController.getInstance().SoundPlaying},t.prototype.playSound=function(t,e){if(void 0===e&&(e=1),SettingController.getInstance().SoundPlaying){var i=RES.getRes(t);this.soundChannel=i.play(0,e)}},t.prototype.onPlayOver=function(){},t.prototype.stopBGM=function(){this.bgmChannel.stop(),void 0!==this.soundChannel&&this.soundChannel.stop()},t.instance=null,t}();__reflect(SoundManager.prototype,"SoundManager");var BulletData=function(){function t(t){this.phase=[],this.id=t.id,this.type=t.type,this.desc=t.desc,this.view=t.view,this.animate=t.animate,this.phase=t.phase}return t}();__reflect(BulletData.prototype,"BulletData");var BulletDataCache=function(){function t(){this.bulletDatas=[],this.intiData()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.intiData=function(){this.parseData(RES.getRes("bullet_json"))},t.prototype.parseData=function(t){for(var e,i=t.bullet,n=0;i>n;n++)e=new BulletData(i[n]),this.bulletDatas.push(e)},t.prototype.getBulletData=function(t){return this.bulletDatas[t]},t.instance=null,t}();__reflect(BulletDataCache.prototype,"BulletDataCache");var Const=function(){function t(){this.intiData()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.intiData=function(){this._data=RES.getRes("const_json")},Object.defineProperty(t.prototype,"maxBuilding",{get:function(){return this._data.maxBuilding},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unlockData",{get:function(){return this._data.unlockData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initBuilings",{get:function(){return this._data.initBuilings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initLevel",{get:function(){return this._data.initLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initGold",{get:function(){return this._data.initGold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initGasMax",{get:function(){return this._data.initGasMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initGas",{get:function(){return this._data.initGas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guideScene",{get:function(){return this._data.guideScene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstScene",{get:function(){return this._data.firstScene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guideData",{get:function(){return this._data.guideData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"winBullets",{get:function(){return this._data.winBullets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseHitReward",{get:function(){return this._data.baseHitReward},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"missleCost",{get:function(){return this._data.missleCost},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(Const.prototype,"Const");var GridData=function(){function t(t,e,i,n){void 0===e&&(e=GridTypeEnum.MISS),void 0===i&&(i=DirectionTypeEnum.UNSET),void 0===n&&(n=BodyGridEnum.UNSET),this._gridValue=t,this._gridType=e,this._direction=i,this._bodyType=n,this.index=-1}return Object.defineProperty(t.prototype,"row",{get:function(){return Math.floor(this._gridValue/9)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._gridValue%9},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridValue",{get:function(){return this._gridValue},set:function(t){this._gridValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridType",{get:function(){return this._gridType},set:function(t){this._gridType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bodyType",{get:function(){return this._bodyType},set:function(t){this._bodyType=t},enumerable:!0,configurable:!0}),t}();__reflect(GridData.prototype,"GridData");var HeadData=function(){function t(t){this.head=t.head,this.direction=t.direction}return t}();__reflect(HeadData.prototype,"HeadData");var CityController=function(){function t(){if(this.buildings=[],this.selectedPosition=-1,this.bolloonApearTimes=0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){this.buildingData=BuildingDataCache.getInstance(),this.citySave=SaveDataManager.getInstance().getUserData().buildings,this.center=this.buildingData.getAirportDataByLevel(this.citySave[0].level),this.center.position=0,this.buildings.push(this.center);for(var t=1;t<this.citySave.length;t++)this.buildings.push(this.buildingData.getBuildingByIdAndLevel(this.citySave[t].id,this.citySave[t].level)),this.buildings[t].position=t,this.buildings[t].top=this.citySave[t].top;this.buildingCircle=new Circle(6,this.buildings.slice(1,this.buildings.length))},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.selectPosition=function(t){this.selectedPosition=t,SceneManager.getInstance().cityScene.selectPosition(this.buildings[t],this.selectedPosition)},t.prototype.resetSelected=function(){this.selectedPosition=-1},t.prototype.updateCircle=function(){this.buildingCircle.data=this.buildings.slice(1,this.buildings.length)},t.prototype.buildBuilding=function(t){this.selectedPosition>0&&this.selectedPosition<7&&-1===this.buildings[this.selectedPosition].id&&GameController.getInstance().costGold(this.buildingData.getBuildingByIdAndLevel(t,1).cost)&&(this.buildings[this.selectedPosition]=this.buildingData.getBuildingByIdAndLevel(t,1),this.buildings[this.selectedPosition].top=1,this.buildings[this.selectedPosition].position=this.selectedPosition,this.saveCity(this.selectedPosition),this.updateCircle(),this.buildings[this.selectedPosition].id===BuildingEnum.GAS_STATION&&SceneManager.getInstance().updateGas(),SceneManager.getInstance().cityScene.build(this.buildings[this.selectedPosition]),this.buildings[this.selectedPosition].id===BuildingEnum.DEFENSE&&this.updateAll())},t.prototype.demolish=function(){if(0===this.selectedPosition)return SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_airport_cant_demolish")),void console.log("空军基地不能拆除");var t=this.buildings[this.selectedPosition].id;GameController.getInstance().addGold(this.buildings[this.selectedPosition].cost),this.buildings[this.selectedPosition]=new BuildingBase,this.buildings[this.selectedPosition].position=this.selectedPosition,this.buildings[this.selectedPosition].top=0,this.saveCity(this.selectedPosition),t===BuildingEnum.DEFENSE&&this.updateAll(),this.updateCircle(),SceneManager.getInstance().cityScene.demolish(this.buildings[this.selectedPosition]),t===BuildingEnum.GAS_STATION&&SceneManager.getInstance().updateGas()},t.prototype.levelUpBuilding=function(){if(this.selectedPosition>=0&&this.selectedPosition<7)if(this.buildings[this.selectedPosition].level<5){var t=this.buildingData.getBuildingByIdAndLevel(this.buildings[this.selectedPosition].id,this.buildings[this.selectedPosition].level+1);GameController.getInstance().costGold(t.cost)&&(this.buildings[this.selectedPosition]=t,this.buildings[this.selectedPosition].position=this.selectedPosition,this.buildings[this.selectedPosition].top=Math.max(this.buildings[this.selectedPosition].top,this.buildings[this.selectedPosition].level),this.saveCity(this.selectedPosition),this.updateCircle(),SceneManager.getInstance().cityScene.levelupBuilding(this.buildings[this.selectedPosition]),this.buildings[this.selectedPosition].id===BuildingEnum.GAS_STATION&&SceneManager.getInstance().updateGas())}else SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_building_is_top_level"))},t.prototype.getTotalScore=function(){for(var t=0,e=0;e<this.buildings.length;e++)this.buildings[e].id!==BuildingEnum.UNSET&&(t+=this.buildings[e].level);return t},t.prototype.getBuildingNum=function(t){for(var e=0,i=0;i<this.buildings.length;i++)this.buildings[i].id===t&&e++;return e},t.prototype.getTopLevel=function(t){for(var e=0,i=0;i<this.buildings.length;i++)this.buildings[i].id===t&&(e=Math.max(e,this.buildings[i].level));return e},t.prototype.getAllBuildingsByType=function(t){var e=this.buildings.filter(function(e){return e.id===t});return e},t.prototype.getBuildingBlockByType=function(t){for(var e=[],i=0;i<this.buildingCircle.length;i++)this.isBlock(this.buildingCircle.data[i].position)&&e.push(this.buildingCircle.data[i]);return e.filter(function(e){return e.id===t})},t.prototype.getBlock=function(t){for(var e=[],i=!0,n=!0,r=t;i;)if(this.isBlockNext(r)?(r++,e.push(r%this.buildingCircle.length)):i=!1,e.length===this.buildingCircle.length)return e;for(r=t;n;)this.isBlockPrevious(r)?(r--,e.push(r%this.buildingCircle.length)):n=!1;return e.push(t),e},t.prototype.isBlock=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getNext(t).id||this.buildingCircle.getData(t).id===this.buildingCircle.getPrevious(t).id},t.prototype.isBlockPrevious=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getPrevious(t).id},t.prototype.isBlockNext=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getNext(t).id},t.prototype.getBuildingByPostion=function(t){return this.buildings[t]},t.prototype.getBuildingsExceptAirpot=function(){return this.buildings},t.prototype.getBuildings=function(){return this.buildings},t.prototype.saveCity=function(t){var e={id:this.buildings[t].id,level:this.buildings[t].level,top:this.buildings[t].top,insure:this.buildings[t].insure};SaveDataManager.getInstance().getUserData().setBuilding(t,e)},t.prototype.destroyCity=function(t){this.buildings[t].level-1>=0&&(this.buildings[t].level-=1,this.saveCity(t))},t.prototype.repairCity=function(t){void 0===t&&(t=null),null===t&&(t=this.selectPosition),this.buildings[t].level<this.buildings[t].top&&(this.buildings[t].level=this.buildings[t].top,this.saveCity(t))},t.prototype.balloonFly=function(){this.bolloonApearTimes++,SceneManager.getInstance().cityScene.flyballoon()},Object.defineProperty(t.prototype,"selectedData",{get:function(){return this.buildings[this.selectedPosition]},enumerable:!0,configurable:!0}),t.prototype.updateAll=function(){SceneManager.getInstance().cityScene.cityView.updateView()},t.prototype.makeOpponenetDataByLevel=function(t){var e=200*NumUtil.range(1,100)+NumUtil.range(1,200),i={level:t,rank:e,score:1e3*t,gold:5e4*t,rob:2e4*t};return i},t.prototype.getBankGameReward=function(){for(var t=this.getAllBuildingsByType(BuildingEnum.BANK),e=1,i=0;i<t.length;i++)t[i].level>0&&(e+=t[i].game_reward);return e},t.prototype.getBankChestReward=function(){for(var t=this.getAllBuildingsByType(BuildingEnum.BANK),e=1,i=0;i<t.length;i++)t[i].level>0&&(e+=t[i].chest_reward);return e},t.prototype.getBankVedioReward=function(){for(var t=this.getAllBuildingsByType(BuildingEnum.BANK),e=1,i=0;i<t.length;i++)t[i].level>0&&(e+=t[i].vedio_reward);return e},t.prototype.getBulletDetail=function(){for(var t=this.getAllBuildingsByType(BuildingEnum.BULLET_SCIENCE),e=0;e<t.length;e++);},t.prototype.getGasStationMax=function(){return 0===this.getTopLevel(BuildingEnum.GAS_STATION)?Const.getInstance().initGasMax:this.buildingData.getGasStationByLevel(this.getTopLevel(BuildingEnum.GAS_STATION)).max},t.prototype.getGasSpeed=function(){for(var t=this.getAllBuildingsByType(BuildingEnum.GAS_STATION),e=0,i=0;i<t.length;i++)if(0===t[i].level){if(0===t[i].top){e+=0;continue}e+=this.buildingData.getGasStationByLevel(t[i].top).mph}else e+=this.buildingData.getGasStationByLevel(t[i].level).mph;return e},t.prototype.onPause=function(){this.pauseDate=(new Date).getTime()},t.prototype.onResume=function(){if(null!=this.pauseDate){var t=(new Date).getTime()-this.pauseDate;console.log(t),GameController.getInstance().addGas(this.getGasSpeed()*t/3600)}},t.prototype.calBuildingInsurePay=function(t){for(var e=this.buildings[t].insure,i=0,n=0;n<e.length;n++)i+=e[n].data.cost;return console.log(i),i},t.prototype.buildingDestroyed=function(t){return this.buildings[t].level<this.buildings[t].top?!0:!1},t.prototype.destroyRate=function(){},t.prototype.getCitySaftyRatio=function(){var t=SaveDataManager.getInstance().getUserData().getDestroyTimes(),e=t.reduce(function(t,e){return t+e},0),i=this.getTotalScore();return console.log(i),console.log(t),i+e},t.prototype.buyInsure=function(t){void 0===t&&(t=null);var e=this.selectedPosition,i=this.getCitySaftyRatio();GameController.getInstance().costGold(Math.floor(.3*this.buildings[t].cost)*i/100)&&(console.log(this.buildings[e]),this.buildings[t].insure.push({insure:this.buildings[e],ratio:i}),this.saveCity(t),SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_buy_insure_success")))},t.prototype.unInsure=function(t){void 0===t&&(t=null),this.buildBuilding[t].insure=[],this.saveCity(t),SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_exit_insure_success"))},t.prototype.canBuyBuildingAmout=function(){},t.prototype.repairAll=function(){for(var t=this.getCanRepair(),e=0;e<t.length;e++)this.repairBuilding(t[e].position);this.updateAll()},t.prototype.getCanRepair=function(){var t=this.buildings.filter(function(t){return t.top>t.level});return t},t.prototype.repairBuilding=function(t){void 0===t&&(t=null),null===t&&(t=this.selectPosition),this.buildings[t].level<this.buildings[t].top&&(this.buildings[t].level=this.buildings[t].top,this.saveCity(t))},t.prototype.isShowBanner=function(){var t=this.getAllBuildingsByType(BuildingEnum.ADVERTISE_COMPANY);return t.length>0?!0:!1},t.prototype.isProtected=function(e){return t.getInstance().getAllBuildingsByType(BuildingEnum.DEFENSE).length<=0?!1:0===e?!0:this.buildings[NumUtil.circle(6,e)].id===BuildingEnum.DEFENSE?!0:this.buildings[NumUtil.circle(6,e+1)].id===BuildingEnum.DEFENSE?!0:this.buildings[NumUtil.circle(6,e-1)].id===BuildingEnum.DEFENSE?!0:!1},t.prototype.getIsProtected=function(){var t=[],e=this.getBuildingBlockByType(BuildingEnum.DEFENSE);e.length>0&&t.push(0);for(var i=0;i<e.length;i++)ArrayUtil.add(t,NumUtil.circle(6,e[i].position+1)),ArrayUtil.add(t,NumUtil.circle(6,e[i].position)),ArrayUtil.add(t,NumUtil.circle(6,e[i].position-1));return t},t.prototype.useMissle=function(){return SaveDataManager.getInstance().getUserData().missles>0?(SaveDataManager.getInstance().getUserData().useMissle(),!0):!1},t.prototype.buyMissle=function(t){void 0===t&&(t=null);for(var e=0,i=this.getBuildingBlockByType(BuildingEnum.DEFENSE),n=0;n<i.length;n++)e+=i[n].missle;(e-SaveDataManager.getInstance().getUserData().missles)*Const.getInstance().missleCost},t.instance=null,t}();__reflect(CityController.prototype,"CityController");var MapStatsData=function(){function t(t){this.id=t.id,this.heads=t.heads,this.attacted=t.attacted}return t}();__reflect(MapStatsData.prototype,"MapStatsData");var OpponentData=function(){function t(t){this.playerName=t.playerName,this.level=t.level,this.rank=t.rank,this.city_score=t.city_score,this.distance=t.distance,this.gold=t.gold}return t}();__reflect(OpponentData.prototype,"OpponentData");var PerfectMapData=function(t){function e(){var e=t.call(this)||this;return e.numPlane=3,e}return __extends(e,t),e.prototype.setPlaneByHeadData=function(){if(3!==this.headList.length)throw new Error("headDataError");for(var t=0;t<this.headList.length;t++)this.setPlaneGridByHead(this.headList[t].head,this.headList[t].direction)},e}(MapData);__reflect(PerfectMapData.prototype,"PerfectMapData");var UserData=function(){function t(){this._gold=0,this._gas=0,this._guide=0,this._unlock=0,this._rank=0,this._destroyTimes=[0,0,0,0,0,0,0],this._missles=0,this._sharedMap=[],this._buildings=[{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]},{id:0,level:0,top:0,insure:[]}],this.initData()}return t.prototype.initData=function(){var t=SaveDataManager.getInstance().getFromLocal("userData");if(null===t||void 0===t||""===t){this._gold=Const.getInstance().initGold,this._gas=Const.getInstance().initGas,this._lastDate=(new Date).getTime(),this._unlock=Const.getInstance().unlockData,this._missles=0,this._guide=Const.getInstance().guideData;
var e=Const.getInstance().initBuilings;this._buildings=[],this._sharedMap=[];for(var i=0;i<e.length;i++){var n=Const.getInstance().initLevel[i];this.buildings.push({id:e[i],level:n,top:n,insure:[]})}for(var i=0;i<Const.getInstance().maxBuilding-e.length;i++)this._buildings.push({id:-1,level:0,top:0,insure:[]});SaveDataManager.getInstance().saveToLocal("userData",JSON.stringify({gold:this._gold,gas:this._gas,unclock:this._unlock,buildings:this._buildings,guide:this._guide,lastDate:(new Date).getTime(),destroyTimes:this._destroyTimes,sharedMap:[]}))}else{var r=JSON.parse(t);this._gold=r.gold,this._gas=r.gas,this._guide=r.guide,this._unlock=r.unlock,this._buildings=r.buildings,this._lastDate=r.lastDate,this._destroyTimes=r.destroyTimes,this._sharedMap=r.sharedMap}},Object.defineProperty(t.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=Math.max(t,0),this.saveUserData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gas",{get:function(){return this._gas},set:function(t){this._gas=Math.max(t,0),this.saveUserData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guide",{get:function(){return this._guide},set:function(t){this._guide=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unlock",{get:function(){return this._unlock},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"missles",{get:function(){return this._missles},enumerable:!0,configurable:!0}),t.prototype.setBuilding=function(t,e){this._buildings[t]={id:e.id,level:e.level,top:e.top,insure:e.insure},this.saveUserData()},Object.defineProperty(t.prototype,"buildings",{get:function(){return this._buildings},enumerable:!0,configurable:!0}),t.prototype.saveUserData=function(){SaveDataManager.getInstance().saveToLocal("userData",JSON.stringify({gold:this._gold,gas:this._gas,guide:this._guide,unlock:this._unlock,buildings:this._buildings,lastDate:this._lastDate,destroyTimes:this._destroyTimes,sharedMap:this._sharedMap}))},t.prototype.getSaveData=function(){return{gold:this._gold,gas:this._gas,guide:this._guide,unlock:this._unlock,lastDate:this.lastDate,buildings:this._buildings,destroyTimes:this._destroyTimes,sharedMap:this._sharedMap}},Object.defineProperty(t.prototype,"lastDate",{get:function(){return void 0===this._lastDate&&this.setLastDate(),this._lastDate},enumerable:!0,configurable:!0}),t.prototype.setLastDate=function(){this._lastDate=(new Date).getTime(),this.saveUserData()},t.prototype.getSharedMap=function(){return void 0===this._sharedMap&&(this._sharedMap=[],this.saveUserData()),this._sharedMap},t.prototype.shareMap=function(t){for(var e,i=!1,n=0;n<this._sharedMap.length;n++){e=0;for(var r=0;r<t.length;r++)for(var o=0;o<this._sharedMap[n].heads.length;o++)if(this._sharedMap[n].heads[o].head===t[r].head&&this._sharedMap[n].heads[o].direction===t[r].direction&&e++,3===e){i=!0,this._sharedMap[n].times++;break}}i||this.shareNewMap(t),this.saveUserData()},t.prototype.shareNewMap=function(t){this._sharedMap.push({heads:t,times:1}),this.saveUserData()},t.prototype.getDestroyTimes=function(){return void 0===this._destroyTimes&&(this._destroyTimes=[0,0,0,0,0,0,0],this.saveUserData()),this._destroyTimes},t.prototype.setDestroyTimes=function(t,e){void 0===this._destroyTimes&&(this._destroyTimes=[0,0,0,0,0,0,0]),e?(this._destroyTimes.shift(),this._destroyTimes.push(t)):this._destroyTimes[this._destroyTimes.length-1]+=t,this.saveUserData()},t.prototype.useMissle=function(){this._missles--,this.saveUserData()},t}();__reflect(UserData.prototype,"UserData");var AdvertiseCompanyData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.ADVERTISE_COMPANY,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.appear=e.appear,i.earn=e.earn,i}return __extends(e,t),e}(BuildingBase);__reflect(AdvertiseCompanyData.prototype,"AdvertiseCompanyData");var AirportData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.AIRPORT,i.level=e.level||0,i.cost=e.cost||0,i.name=e.name||"废墟",i.view=e.view||"",i.desc=e.desc||"",i.opponent=e.opponent||0,i.opponent_level=e.opponent_level||0,i}return __extends(e,t),e}(BuildingBase);__reflect(AirportData.prototype,"AirportData");var BankData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.BANK,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.game_reward=e.game_reward,i.chest_reward=e.chest_reward,i.vedio_reward=e.vedio_reward,i}return __extends(e,t),e}(BuildingBase);__reflect(BankData.prototype,"BankData");var GameController=function(){function t(){if(this.gameResult=null,this.one_round_result=[],t.instance)throw new Error("AIController singlon error");egret.setInterval(this.gameUpdate,this,1e4),egret.setInterval(this.bolloonFly,this,3e4)}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.bolloonFly=function(){CityController.getInstance().balloonFly()},t.prototype.gameUpdate=function(){var t=CityController.getInstance().getGasSpeed();this.addGas(t/360)},t.prototype.setAwayGame=function(t){this.awayMapData=t},t.prototype.attackOpponent=function(t){void 0===t&&(t=0),GuideController.getInstance().isFinished()?this.costGas(2*Math.pow(t,3))&&(this.phase=PhaseEnum.PREPARE_PHASE,this.gameResult=null,RewardController.getInstance().reset(),RecordController.getInstance().reset(),BulletController.getInstance().resetBullets(),SceneManager.getInstance().awayScene.resetGameView(t),this._type=GameTypeEnum.GAME_TYPE_HITTING,this.awayMapData=AIController.getInstance().generateRandomMap(),SceneManager.getInstance().toAwayScene(),this.phase=PhaseEnum.ATTACK_PHASE):(this.phase=PhaseEnum.PREPARE_PHASE,this.gameResult=null,RewardController.getInstance().reset(),RecordController.getInstance().reset(),BulletController.getInstance().resetBullets(),this._type=GameTypeEnum.GAME_TYPE_GUIDE,SceneManager.getInstance().awayScene.resetGameView(t,!0),GuideController.getInstance().startAwayGuide(),SceneManager.getInstance().toAwayScene(),this.phase=PhaseEnum.ATTACK_PHASE)},t.prototype.startPlacingGame=function(){this._type=GameTypeEnum.GAME_TYPE_MAPING,PlacingController.getInstance().randomMap()},t.prototype.isGuiding=function(){return GameTypeEnum.GAME_TYPE_GUIDE===t.getInstance().type},t.prototype.isHitGaming=function(){return GameTypeEnum.GAME_TYPE_HITTING===t.getInstance().type},t.prototype.isDoubleHitting=function(){return GameTypeEnum.GAME_TYPE_DOUBLE_HITTING===t.getInstance().type},t.prototype.isPlacing=function(){return GameTypeEnum.GAME_TYPE_MAPING===t.getInstance().type},t.prototype.gameStart=function(){this.phase=PhaseEnum.ATTACK_PHASE},t.prototype.gameFinished=function(t){if(this.phase=PhaseEnum.OVER_PHASE,this.gameResult=t,RecordController.getInstance().recordMap(this.awayMapData.map),t){for(var e=ScoreTypeEnum.C,i=0;i<ScoreTypeEnum.SCORE.length;i++)RecordController.getInstance().bulletUsed<=ScoreTypeEnum.SCORE[i]&&(e=ScoreTypeEnum.SCORE[i]);SceneManager.getInstance().resultScene.showResult(ResultTypeEnum.WIN,e)}else SceneManager.getInstance().resultScene.showResult(ResultTypeEnum.FAIL,ScoreTypeEnum.C);SceneManager.getInstance().toResultScene()},t.prototype.mapShowGird=function(t){if(MapUtil.gridValid(t)){var e=this.awayMapData.map[t];this.one_round_result.push(e.gridType),RecordController.getInstance().recordGridOpen(e),SceneManager.getInstance().awayScene.showGridView(t,e.gridType)}},t.prototype.nextAttackPhase=function(){this.phase=PhaseEnum.ATTACK_PHASE,BulletController.getInstance().getCurrentBullet()===BulletTypeEnum.GUIDED_MISSILE&&this.hitGrid(this.getUnHitPlaneGrid(),BulletController.getInstance().useBullet())},t.prototype.hitGrid=function(t,e){if(this.phase!==PhaseEnum.OVER_PHASE&&this.phase===PhaseEnum.ATTACK_PHASE){SceneManager.getInstance().awayScene.msgView.showHitInfo(),this.phase=PhaseEnum.RESULT_PHASE;var i;BulletTypeEnum.BULLET_GRID_AREA[e];switch(this.one_round_result=[],e){case BulletTypeEnum.MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.CROSS_BOOM:i=BulletTypeEnum.BULLET_GRID[BulletTypeEnum.CROSS_BOOM];for(var n=0;n<i.length;n++)(1!==Math.abs(i[n])||MapUtil.sameRow(t,t+i[n]))&&this.mapShowGird(t+i[n]);break;case BulletTypeEnum.INFRARED_ROW:var r=MapUtil.getXYFromValue(t).y;i=AreaTypeEnum.getOneRow(AreaTypeEnum.ROWS[r]);for(var n=0;n<i.length;n++)this.mapShowGird(i[n]);break;case BulletTypeEnum.INFRARED_COL:var o=MapUtil.getXYFromValue(t).x;i=AreaTypeEnum.getOneCol(AreaTypeEnum.COLS[o]);for(var n=0;n<i.length;n++)this.mapShowGird(i[n]);break;case BulletTypeEnum.GUIDED_MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.INCENDIARY_BOMB:this.mapShowGird(t);break;case BulletTypeEnum.ARMOR_PIERCING_MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.NINE_PALACE_MISSILE:i=BulletTypeEnum.BULLET_GRID[BulletTypeEnum.NINE_PALACE_MISSILE];for(var n=0;n<i.length;n++)(1!==Math.abs(i[n])||MapUtil.sameRow(t,t+i[n]))&&this.mapShowGird(t+i[n]);break;default:this.mapShowGird(t)}this.phase!==PhaseEnum.OVER_PHASE&&(this.phase=PhaseEnum.END_PHASE,RecordController.getInstance().recordEachRound(),RecordController.getInstance().round<20&&BulletController.getInstance().prepareNextBullet());RewardController.getInstance().hitReward(this.one_round_result);RecordController.getInstance().recordAction(this.awayMapData.map[t],e)}},t.prototype.costGold=function(t){var e=SaveDataManager.getInstance().getUserData().gold;return 0/0===Number(e)?!1:t>e?(SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_gold_not_enough")+",还差"+(t-e)),!1):(SaveDataManager.getInstance().getUserData().gold=Number(e)-Number(t),SceneManager.getInstance().updateGold(),SaveDataManager.getInstance().saveUserData(),!0)},t.prototype.costGas=function(t){var e=SaveDataManager.getInstance().getUserData().gas;return 0/0===Number(e)?!1:t>e?(SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_gas_not_enough")+",还差"+(t-e)),!1):(SaveDataManager.getInstance().getUserData().gas-=t,SceneManager.getInstance().updateGas(),SaveDataManager.getInstance().saveUserData(),!0)},t.prototype.addGold=function(t){SaveDataManager.getInstance().getUserData().gold+=t,SceneManager.getInstance().updateGold(),SaveDataManager.getInstance().saveUserData()},t.prototype.addGas=function(t){SaveDataManager.getInstance().getUserData().gas=Math.min(SaveDataManager.getInstance().getUserData().gas+t,CityController.getInstance().getGasStationMax()),SceneManager.getInstance().updateGas(),SaveDataManager.getInstance().saveUserData()},t.prototype.getMapByUser=function(){},t.prototype.getTestMapData=function(){},t.prototype.setTestMapData=function(){},t.prototype.getAwayMapData=function(t){return this.awayMapData.map[t].gridType},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAttackPhase",{get:function(){return this.phase===PhaseEnum.ATTACK_PHASE},enumerable:!0,configurable:!0}),t.prototype.getUnHitPlaneGrid=function(){var t=RecordController.getInstance().getOneUnhitPlane();return-1===t?this.getPlaneGridUnhit():this.getPlaneGridUnhitByIndex(t)},t.prototype.getPlaneGridUnhitByIndex=function(t){var e=RecordController.getInstance().getHitRecorded(),i=this.awayMapData.getPlaneGridByIndex(t),n=i.filter(function(t){return-1===e.indexOf(t.gridValue)});return ArrayUtil.random(n).gridValue},t.prototype.getPlaneGridUnhit=function(){var t=RecordController.getInstance().getHitRecorded(),e=this.awayMapData.getPlaneGrid(),i=e.filter(function(e){return-1===t.indexOf(e.gridValue)});return ArrayUtil.random(i).gridValue},t.instance=null,t}();__reflect(GameController.prototype,"GameController");var BuildingDataCache=function(){function t(){this.airportData=[null],this.bankData=[null],this.scienceData=[null],this.gasStationData=[null],this.repairFactoryData=[null],this.insureCompanyData=[null],this.defenseData=[null],this.advertiseData=[null],this.intiData()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.intiData=function(){this.parseData(RES.getRes("building_json"))},t.prototype.parseData=function(t){for(var e in t)switch(e){case BuildingEnum.buildingString[BuildingEnum.AIRPORT]:this.parseAirport(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.BANK]:this.parseBank(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.BULLET_SCIENCE]:this.parseBulletScience(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.GAS_STATION]:this.parseGasStatision(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.REPAIR_FACTORY]:this.parseRepairFactory(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.INSURE_COMPANY]:this.parseInsureCompany(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.DEFENSE]:this.parseDefense(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.ADVERTISE_COMPANY]:this.parseAdvertise(t[e]);break;default:console.log("new building has no parse")}},t.prototype.parseAirport=function(t){for(var e,i=0;i<t.length;i++)e=new AirportData(t[i]),this.airportData.push(e)},t.prototype.parseBank=function(t){for(var e,i=0;i<t.length;i++)e=new BankData(t[i]),this.bankData.push(e)},t.prototype.parseBulletScience=function(t){for(var e,i=0;i<t.length;i++)e=new BulletScienceData(t[i]),this.scienceData.push(e)},t.prototype.parseGasStatision=function(t){for(var e,i=0;i<t.length;i++)e=new GasStationData(t[i]),this.gasStationData.push(e)},t.prototype.parseRepairFactory=function(t){for(var e,i=0;i<t.length;i++)e=new RepairFactoryData(t[i]),this.repairFactoryData.push(e)},t.prototype.parseInsureCompany=function(t){for(var e,i=0;i<t.length;i++)e=new InsureCompanyData(t[i]),this.insureCompanyData.push(e)},t.prototype.parseDefense=function(t){for(var e,i=0;i<t.length;i++)e=new DefenseData(t[i]),this.defenseData.push(e)},t.prototype.parseAdvertise=function(t){var e;console.log(t);for(var i=0;i<t.length;i++)e=new AdvertiseCompanyData(t[i]),this.advertiseData.push(e)},t.prototype.getBuildingByIdAndLevel=function(t,e){if(!(e>0&&6>e))return new BuildingBase;switch(t){case BuildingEnum.AIRPORT:return this.getAirportDataByLevel(e);case BuildingEnum.BANK:return this.getBankDataByLevel(e);case BuildingEnum.BULLET_SCIENCE:return this.getBulletScienceByLevel(e);case BuildingEnum.GAS_STATION:return this.getGasStationByLevel(e);case BuildingEnum.REPAIR_FACTORY:return this.getRepairFactoryByLevel(e);case BuildingEnum.INSURE_COMPANY:return this.getInsureCompanyByLevel(e);case BuildingEnum.DEFENSE:return this.getDefenseByLevel(e);case BuildingEnum.ADVERTISE_COMPANY:return this.getAdvertiseByLevel(e)}},t.prototype.getAirportDataByLevel=function(t){return new AirportData(this.airportData[t])},t.prototype.getBankDataByLevel=function(t){return new BankData(this.bankData[t])},t.prototype.getBulletScienceByLevel=function(t){return new BulletScienceData(this.scienceData[t])},t.prototype.getGasStationByLevel=function(t){return new GasStationData(this.gasStationData[t])},t.prototype.getRepairFactoryByLevel=function(t){return new RepairFactoryData(this.repairFactoryData[t])},t.prototype.getInsureCompanyByLevel=function(t){return new InsureCompanyData(this.insureCompanyData[t])},t.prototype.getDefenseByLevel=function(t){return new DefenseData(this.defenseData[t])},t.prototype.getAdvertiseByLevel=function(t){return new AdvertiseCompanyData(this.advertiseData[t])},t.instance=null,t}();__reflect(BuildingDataCache.prototype,"BuildingDataCache");var BulletScienceData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.BULLET_SCIENCE,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.level=e.level,i.first=e.first,i.then=e.then,i.first_num=e.first_num,i.bullets=e.bullets,i}return __extends(e,t),Object.defineProperty(e.prototype,"allBulletsType",{get:function(){return this.bullets},enumerable:!0,configurable:!0}),e}(BuildingBase);__reflect(BulletScienceData.prototype,"BulletScienceData");var DefenseData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.DEFENSE,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.missle=e.missle,i}return __extends(e,t),e}(BuildingBase);__reflect(DefenseData.prototype,"DefenseData");var DebugPlatform=function(){function t(){}return t.prototype.initSDK=function(){},t.prototype.initAnalytics=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{gameKey:"02a2d376f1268780cdeb969e3385bae2",secretKey:"9b426779362d3259747c55f90ce0a40500524bcb"}]})})},t.prototype.analytics=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return console.log(t,e),[2]})})},t.prototype.setLifeCycleCallBack=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return egret.lifecycle.onPause=function(){t()},egret.lifecycle.onResume=function(){e()},[2]})})},t.prototype.setLoadingProgress=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.loadingComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.print=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return console.log(t),[2]})})},t.prototype.existRank=function(){return!1},t.prototype.getRank=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){console.log("获取"),t([{nick:"哈N她!)|A(1",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)A(2",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(3",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(4",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(5",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(6",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(7",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(8",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(9",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(10",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(11",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(12",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(13",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(14",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"}])})]})})},t.prototype.share=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return console.log(t),[2]})})},t.prototype.uploadRank=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,e]})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.offsetHead=function(){return 0},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchBanner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.showBanner=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.hideBanner=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchInterstitial=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.showInterstitial=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchVedio=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.reloadVedio=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.vedioPlay=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return i(!0),[2]})})},t.prototype.getSaveData=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{key:"key"}]})})},t.prototype.setSaveData=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.rankView=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getGameRecorderManager=function(){return null},t.prototype.shareVedio=function(t){},t.prototype.showTip=function(t){},t.prototype.stopRecord=function(){},t.prototype.pauseRecord=function(){},t.prototype.resumeRecord=function(){},t.prototype.startRecord=function(){},t.prototype.loadNextStage=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.loadFont=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getAppName=function(){return""},t.prototype.hasBannerSDK=function(){return!1},t.prototype.hasInterstitialSDK=function(){return!1},t.prototype.hasVedioSDK=function(){return!1},t.prototype.hasShareSDK=function(){return!1},t.prototype.hasShareVedioSDK=function(){return!1},t.prototype.openScheme=function(){},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform,window.platform.name="web");var InsureCompanyData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.INSURE_COMPANY,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.duration=e.duration,i.building=e.building,i.paid=e.paid,i}return __extends(e,t),e}(BuildingBase);__reflect(InsureCompanyData.prototype,"InsureCompanyData");var RepairFactoryData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.REPAIR_FACTORY,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.repair_cost=e.missle,i}return __extends(e,t),e}(BuildingBase);__reflect(RepairFactoryData.prototype,"RepairFactoryData");var AdaptSceenUtil;!function(t){function e(){return egret.MainContext.instance.stage.stageWidth/640}function i(){return egret.MainContext.instance.stage.stageHeight/egret.MainContext.instance.stage.stageWidth}function n(){return 640/1136}function r(){return(egret.MainContext.instance.stage.stageWidth-640)/2}function o(){return(egret.MainContext.instance.stage.stageHeight-1136)/2}function s(){return egret.MainContext.instance.stage}function a(){return egret.MainContext.instance.stage.stageWidth}function l(){return egret.MainContext.instance.stage.stageHeight}function h(){return 640}function u(){return 1136}function c(){return egret.MainContext.instance.stage.scaleMode}function d(t,e,i){void 0===e&&(e=1),void 0===i&&(i=0),0===i&&(i=t.totalFrames),t.currentFrame<e||t.currentFrame>=i?t.gotoAndStop(e):t.nextFrame()}function g(t,e){-1===t.indexOf(e)&&t.push(e)}function p(){t.curWidth()>=t.displayWidth()&&t.curHeight()>=t.displayHeight()?egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.NO_SCALE:t.curWidth()/t.curHeight()<t.displayWidth()/t.displayHeight()?egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH}t.factor=e,t.wDivideH=i,t.designWDivideH=n,t.x_fix=r,t.y_fix=o,t.gameStage=s,t.curWidth=a,t.curHeight=l,t.displayWidth=h,t.displayHeight=u,t.scaleMode=c,t.loopPlay=d,t.singletonPush=g,t.E8ScaleMode=p}(AdaptSceenUtil||(AdaptSceenUtil={}));var ArrayUtil;!function(t){function e(t,e){-1===t.indexOf(e)&&t.push(e)}function i(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}function n(t){return t[Math.floor(Math.random()*t.length)]}t.add=e,t.remove=i,t.random=n}(ArrayUtil||(ArrayUtil={}));var DrawUtil;!function(t){function e(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e}function i(t,i){var n=e(i),r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];r[0]=n.r/255,r[6]=n.g/255,r[12]=n.b/255;var o=new egret.ColorMatrixFilter(r);t.filters=[o]}function n(t,e,i){void 0===e&&(e=24),void 0===i&&(i=!0);var n=new egret.Sprite,r=new egret.TextField;if(r.text=t,r.size=e,r.stroke=4,r.height=r.textHeight+10,r.width=r.textWidth+10,r.strokeColor=3355443,r.lineSpacing=20,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,i){var o=new egret.TextField;o.text=t,o.textColor=3355443,o.size=e,o.stroke=4,o.strokeColor=3355443,o.x=2,o.y=4,o.height=o.textHeight+10,o.width=o.textWidth+10,n.addChild(o),o.textAlign=egret.HorizontalAlign.CENTER,o.verticalAlign=egret.VerticalAlign.MIDDLE}return n.addChild(r),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.cacheAsBitmap=!0,n}function r(t,i){var n=e(t),r=e(i),o=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];o[0]=NumUtil.range(n.r,r.r,!0)/255,o[6]=NumUtil.range(n.g,r.g,!0)/255,o[12]=NumUtil.range(n.b,r.b,!0)/255;var s=new egret.ColorMatrixFilter(o);return s}function o(t,i,n,r){void 0===r&&(r=2e3);var o=e(i),s=e(n);console.log(o),console.log(s);var a=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],l=0,h=egret.setInterval(function(){20>l?(l++,a[0]=(Math.floor((s.r-o.r)*l/20)+o.r)/255,a[6]=(Math.floor((s.g-o.g)*l/20)+o.g)/255,a[12]=(Math.floor((s.b-o.b)*l/20)+o.b)/255,t.filters=[new egret.ColorMatrixFilter(a)]):egret.clearInterval(h)},this,100)}t.spliceColor=e,t.setImageColor=i,t.textFilter=n,t.randomColor=r,t.colorTween=o}(DrawUtil||(DrawUtil={}));var MapUtil;!function(t){function e(t,e){if(t===e)return DirectionTypeEnum.UNSET;var i=s(t),n=s(e);return Math.abs(i.x-n.x)-Math.abs(i.y-n.y)>0?i.x-n.x>0?DirectionTypeEnum.RIGHT:i.x-n.x<0?DirectionTypeEnum.LEFT:DirectionTypeEnum.ERROR:Math.abs(i.x-n.x)-Math.abs(i.y-n.y)<0?i.y-n.y>0?DirectionTypeEnum.DOWN:i.y-n.y<0?DirectionTypeEnum.UP:DirectionTypeEnum.ERROR:DirectionTypeEnum.UNCERTAIN}function i(t,e){return e%9-t%9}function n(t,e){return Math.floor(e/9)-Math.floor(t/9)}function r(t,e){return Math.floor(t/9)===Math.floor(e/9)}function o(t,e){return t%9===e%9}function s(t){var e={x:t%9,y:Math.floor(t/9)};return e}function a(t,e){if(0>t||t>80)return!1;var i=s(t),n=i.x,r=i.y;switch(e){case DirectionTypeEnum.UP:return 0>n-2||n+2>8||r+3>8?!1:!0;case DirectionTypeEnum.RIGHT:return 0>r-2||r+2>8||0>n-3?!1:!0;case DirectionTypeEnum.DOWN:return 0>n-2||n+2>8||0>r-3?!1:!0;case DirectionTypeEnum.LEFT:return 0>r-2||r+2>8||n+3>8?!1:!0;default:return console.log("direction error"),!1}}function l(t){switch(t){case DirectionTypeEnum.UP:return[9,18,7,8,10,11,26,28,27];case DirectionTypeEnum.RIGHT:return[-1,-2,-19,-10,8,17,-12,6,-3];case DirectionTypeEnum.DOWN:return[-9,-18,-7,-8,-10,-11,-28,-26,-27];case DirectionTypeEnum.LEFT:return[1,2,-17,-8,10,19,-6,12,3];default:return console.log("direction error"),[]}}function h(t,e){switch(console.log("rotation,head:"+t+",direction:"+e),e){case DirectionTypeEnum.UP:return a(t+10,DirectionTypeEnum.RIGHT)?{head:t+10,direction:DirectionTypeEnum.RIGHT}:h(t+10,DirectionTypeEnum.RIGHT);case DirectionTypeEnum.RIGHT:return a(t+8,DirectionTypeEnum.DOWN)?{head:t+8,direction:DirectionTypeEnum.DOWN}:h(t+8,DirectionTypeEnum.DOWN);case DirectionTypeEnum.DOWN:return a(t-10,DirectionTypeEnum.LEFT)?{head:t-10,direction:DirectionTypeEnum.LEFT}:h(t-10,DirectionTypeEnum.LEFT);case DirectionTypeEnum.LEFT:return a(t-8,DirectionTypeEnum.UP)?{head:t-8,direction:DirectionTypeEnum.UP}:h(t-8,DirectionTypeEnum.UP);default:return console.log("direction error"),{head:t,direction:e}}}function u(t){return 0>t||t>81?!1:!0}t.getDirection=e,t.getXOffset=i,t.getYOffset=n,t.sameRow=r,t.sameCol=o,t.getXYFromValue=s,t.checkHeadAndDirection=a,t.getGridByDirection=l,t.rotationPlane=h,t.gridValid=u}(MapUtil||(MapUtil={}));var NumUtil;!function(t){function e(t,i){return i>t?e(t,i-t):0>=i?e(t,i+t):i}function i(t,e,i){void 0===i&&(i=!0);var n=Math.random()*(e-t);return t+(i?Math.floor(n):n)}function n(t,e){var i=Math.floor(Math.random()*(t.length-1)),n=t.indexOf(e);return-1===n?ColorEnum.colorList[0]:n>i?ColorEnum.colorList[i]:ColorEnum.colorList[i+1]}function r(e){var i="";if(e=Math.floor(e),1e3>=e)return e.toString();for(var n=0,r=10,o=1;e/Math.pow(r,o)>1;)o++;n=o;var s=Math.floor((n-1)/3),a=e/Math.pow(1e3,s);return i="",n%3==1?i+=a.toFixed(1):(a=Math.round(a),i+=a.toString()),s>=t.POST_FIX.length&&(s=t.POST_FIX.length-1),i+=t.POST_FIX[s-1],i.toString()}t.circle=e,t.range=i,t.exceptRange=n,t.TRILLION="T",t.BILLION="B",t.MILLION="M",t.THOUSAND="K",t.DOT=".",t.EMPTY="",t.POST_FIX=["K","M","B","T","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR","BS","BT","BU","BV","BW","BX","BY","BZ","CA","CB","CC","CD","CE","CF","CG","CH","CI","CJ","CK","CL","CM","CN","CO","CP","CQ","CR","CS","CT","CU","CV","CW","CX","CY","CZ","DA","DB","DC","DD","DE","DF","DG","DH","DI","DJ","DK","DL","DM","DN","DO","DP","DQ","DR","DS","DT","DU","DV","DW","DX","DY","DZ","EA","EB","EC","ED","EE","EF","EG","EH","EI","EJ","EK","EL","EM","EN","EO","EP","EQ","ER","ES","ET","EU","EV","EW","EX","EY","EZ"],t.numberToString=r}(NumUtil||(NumUtil={}));var LoadingScene=function(t){function e(){var e=t.call(this)||this;return e.bg=new egret.Sprite,e.w=0,e.h=0,e.mySheet=RES.getRes("load"),e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.w=egret.MainContext.instance.stage.stageWidth,this.h=egret.MainContext.instance.stage.stageHeight,this.bg.graphics.beginFill(3223857,1),this.bg.graphics.drawRect(0,0,this.w,this.h),this.bg.graphics.endFill(),this.bg.width=this.w,this.bg.height=this.h,this.addChild(this.bg),this.touchEnabled=!0,this.pgBg=new egret.Bitmap,this.pgBg.texture=this.mySheet.getTexture("pgBg"),this.pgBg.x=this.w/2,this.pgBg.y=this.h/2,this.pgBg.anchorOffsetX=this.pgBg.width/2,this.pgBg.anchorOffsetY=this.pgBg.height/2,this.addChild(this.pgBg),this.pgBar=new egret.Bitmap,this.pgBar.texture=this.mySheet.getTexture("pgBar"),this.pgBar.x=this.w/2-34,this.pgBar.y=this.h/2,this.pgBar.anchorOffsetX=this.pgBar.width/2,this.pgBar.anchorOffsetY=this.pgBar.height/2,this.addChild(this.pgBar),this.textField=new egret.TextField,this.textField.size=20,this.textField.textColor=16777215,this.textField.bold=!0,this.textField.stroke=1,this.textField.strokeColor=0,this.addChild(this.textField),this.textField.width=100,this.textField.x=this.w/2-this.textField.width/2,this.textField.y=this.h/2-this.textField.height/2-10,this.textField.textAlign="center",this.textField.text="0%"},e.prototype.onProgress=function(t,e){var i=Math.round(t/e*100);this.textField.text=i+"%",this.pgBar.width=282*(t/e)},e}(egret.Sprite);__reflect(LoadingScene.prototype,"LoadingScene",["RES.PromiseTaskReporter"]);var MineScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(MineScene.prototype,"MineScene");
var AwayGameMsgView=function(t){function e(){var e=t.call(this)||this;return e.MAP_INFO="map_info",e.HIT_INFO="hit_info",e.REWARD_INFO="reward_info",e.BANNER_INFO="banner_info",e.GUIDE_INFO="guide_info",e.msgKey=["playerName","排名","城镇积分","可掠夺金币","被进攻次数","S率","摧毁炮数"],e.msgValue=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.addChild(this.viewBg),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer),this.bullet_text=new egret.TextField,this.bullet_text.x=20,this.bullet_text.y=10,this.msgContainer.addChild(this.bullet_text),this.reward_text=new egret.TextField,this.reward_text.x=20,this.reward_text.y=10+this.bullet_text.y+this.bullet_text.height,this.msgContainer.addChild(this.reward_text),this.guide_text=new egret.TextField,this.guide_text.width=this.viewBg.width-40,this.guide_text.multiline=!0,this.guide_text.x=20,this.guide_text.y=10,this.msgContainer.addChild(this.guide_text),this.guide_help_text=new egret.TextField,this.guide_help_text.width=this.viewBg.width-40,this.guide_help_text.multiline=!0,this.guide_help_text.x=20,this.msgContainer.addChild(this.guide_help_text)},e.prototype.updateView=function(t){if(void 0===t&&(t=0),console.log("status"+this.status),this.msgContainer.removeChildren(),this.status===this.GUIDE_INFO)console.log(i18n.getInstance().getLanguage("guide_"+GuideController.getInstance().getGuideStep())),this.guide_text.text=i18n.getInstance().getLanguage("guide_"+GuideController.getInstance().getGuideStep()),this.addChild(this.guide_text),this.guide_help_text.text=i18n.getInstance().getLanguage("guide_help_"+GuideEnum.GUIDE_HELP[GuideController.getInstance().getGuideStep()]),this.guide_help_text.y=this.guide_text.height+10,this.guide_help_text.textColor=ColorEnum.RED,this.addChild(this.guide_help_text);else if(this.status===this.HIT_INFO)console.log("hit_info"),this.bullet_text.text="使用炮数:"+RecordController.getInstance().round+"/"+Const.getInstance().winBullets;else if(this.status===this.MAP_INFO)if(0===t);else{var e=void 0,i=void 0;this.msgKey[0]="韩闯",this.msgValue=[t.toString()+"级",Math.floor(Math.random()*Math.pow(10,8-t)),Math.floor(100*t*Math.random()),10*Math.floor(100*t*Math.random()),Math.floor(100*t*Math.random()),(40+20*Math.random()).toFixed(2)+"%",Math.floor(11*Math.random())+8];for(var n=0;n<this.msgKey.length;n++)e=new egret.TextField,e.text=this.msgKey[n]+":",e.x=20+Math.floor(n%2)*this.viewBg.width/2,e.y=10+Math.floor(n/2)*e.height,i=e.width,this.msgContainer.addChild(e),e=new egret.TextField,e.text=this.msgValue[n],e.x=i+20+Math.floor(n%2)*this.viewBg.width/2,e.y=10+Math.floor(n/2)*e.height,this.msgContainer.addChild(e)}else this.status===this.REWARD_INFO&&(this.reward_text.text="获得奖励:")},e.prototype.resetMsgViewStatus=function(t,e){e?this.status=this.GUIDE_INFO:this.status=this.MAP_INFO,this.updateView(t)},e.prototype.showHitInfo=function(){this.status=this.HIT_INFO,this.updateView()},e.prototype.showRewardInfo=function(){this.status=this.REWARD_INFO,this.updateView()},e.prototype.showBannerInfo=function(){this.status=this.BANNER_INFO,this.updateView()},e.prototype.showGuideInfo=function(){this.status=this.GUIDE_INFO,this.updateView()},e.prototype.getPlayerData=function(t){return-1!==t.indexOf("msg")?this.opponentData[t]:t},e}(egret.Sprite);__reflect(AwayGameMsgView.prototype,"AwayGameMsgView");var AwayGridView=function(t){function e(e){var i=t.call(this,e)||this;return i._enable=0,t.prototype.initView.call(i),i.coverSprite=new egret.Sprite,i.addChild(i.coverSprite),i.shadow_cover=new egret.Bitmap,i.shadow_cover.texture=RES.getRes("shadow_cover"),i.shadow_cover.x=-8,i.shadow_cover.y=-8,i.addChildAt(i.shadow_cover,i.getChildIndex(i.gridView)),i.middle_cover=new egret.Bitmap,i.middle_cover.texture=RES.getRes("middle_cover"),i.middle_cover.x=-8,i.middle_cover.y=-8,i.coverSprite.addChild(i.middle_cover),i.cloud_cover=new egret.Bitmap,i.cloud_cover.texture=RES.getRes("cloud_cover"),i.cloud_cover.x=-8,i.cloud_cover.y=-8,i.coverSprite.addChild(i.cloud_cover),i}return __extends(e,t),e.prototype.updateView=function(){this._touched,this._status===GridStatusEnum.COVER?(this.coverSprite.visible=!0,this.shadow_cover.visible=!0,this.gridView.texture=RES.getRes("cover_png"),this.gridView.alpha=0):this._status===GridStatusEnum.KNOWN?this.type===GridTypeEnum.HEAD||this.type===GridTypeEnum.BODY||this.type===GridTypeEnum.MISS:this._status===GridStatusEnum.SHOW?GameController.getInstance().isPlacing()?this._selected:(GameController.getInstance().isHitGaming()||GameController.getInstance().isGuiding())&&(this.type===GridTypeEnum.HEAD?(this.gridView.texture=RES.getRes("head_png"),this.gridView.alpha=1):this.type===GridTypeEnum.BODY?(this.gridView.texture=RES.getRes("body_png"),this.gridView.alpha=1):this.type===GridTypeEnum.MISS?(this.gridView.texture=null,this.gridView.alpha=1):this.type===GridTypeEnum.UNSET&&(this.gridView.texture=RES.getRes("cover_png"),this.gridView.alpha=0),this.coverSprite.visible=!1,this.shadow_cover.visible=!1):this._status===GridStatusEnum.UNSHOW},e.prototype.resetView=function(){this._status=GridStatusEnum.COVER,this._type=GridTypeEnum.MISS,this.gridView.texture=null,this.updateView()},Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"signType",{get:function(){return this._signType},set:function(t){this._signType=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enable",{get:function(){return this._enable},set:function(t){this._enable=t,0===t?(this.alpha=1,DrawUtil.setImageColor(this,16777215)):1===t?(this.alpha=.2,DrawUtil.setImageColor(this,4473924)):2===t&&(this.alpha=.2,DrawUtil.setImageColor(this,16729156))},enumerable:!0,configurable:!0}),e}(GridView);__reflect(AwayGridView.prototype,"AwayGridView");var AwayScene=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Bitmap;t.texture=RES.getRes("bg_png"),t.width=AdaptSceenUtil.curWidth(),t.height=AdaptSceenUtil.curHeight(),DrawUtil.setImageColor(t,ColorEnum.NATTIER_BLUE),this.addChild(t),this.messageView=new AwayGameMsgView,this.messageView.anchorOffsetX=this.messageView.width/2,this.messageView.x=AdaptSceenUtil.curWidth()/2,this.messageView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.messageView),this.gameView=new GameView(!1),this.addChild(this.gameView),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=32+AdaptSceenUtil.y_fix()/2+this.backButton.height/2,this.addChild(this.backButton),this.bulletControlView=new BulletControlView,this.bulletControlView.width=AdaptSceenUtil.curWidth(),this.bulletControlView.y=AdaptSceenUtil.curHeight()-this.bulletControlView.height,this.bulletControlView.visible=!1,SceneManager.getInstance().getUILayer().addChild(this.bulletControlView)},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toResultScene()},e.prototype.inAnimate=function(){this.bulletControlView.visible=!0,this.visible=!0},e.prototype.outAnimate=function(){this.bulletControlView.visible=!1,this.visible=!1},e.prototype.nextGuide=function(){this.updateMsg()},e.prototype.updateMsg=function(){this.messageView.updateView()},e.prototype.updateBullets=function(){this.bulletControlView.addNewBullet(),this.messageView.updateView()},e.prototype.resetGameView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),this.gameView.resetView(),this.bulletControlView.updateView(),this.messageView.resetMsgViewStatus(t,e)},e.prototype.showGridView=function(t,e,i){void 0===i&&(i=GridStatusEnum.SHOW),this.gameView.gridList[t].status=i,this.gameView.gridList[t].type=e},e.prototype.showGameFinished=function(){platform.hasVedioSDK},Object.defineProperty(e.prototype,"msgView",{get:function(){return this.messageView},enumerable:!0,configurable:!0}),e.prototype.getGameView=function(){return this.gameView},e}(egret.Sprite);__reflect(AwayScene.prototype,"AwayScene",["Scene"]);var BulletControlView=function(t){function e(){var e=t.call(this)||this;return e.bulletPool=[],e.bulletX=[],e.bulletY=[],e.bulletSize=[],e.controlViewBg=new egret.Bitmap,e.controlViewBg.texture=RES.getRes("control_bg_png"),e.controlViewBg.width=AdaptSceenUtil.curWidth(),e.addChild(e.controlViewBg),e.titleTextField=new egret.TextField,e.titleTextField.x=36,e.titleTextField.y=18,e.titleTextField.bold=!0,e.titleTextField.size=28,e.titleTextField.textAlign=egret.HorizontalAlign.CENTER,e.titleTextField.text=i18n.getInstance().getLanguage("ui_title_bullet"),e.addChild(e.titleTextField),e.bulletQueue=new egret.Sprite,e.addChild(e.bulletQueue),e.switchButton=new E8TextButton(e,RES.getRes("btn_purple_png"),e.switchTouched),e.switchButton.scale(.5,.5),e.switchButton.setButtonText(i18n.getInstance().getLanguage("ui_store")),e.switchButton.x=AdaptSceenUtil.curWidth()/2+AdaptSceenUtil.curWidth()/4-75,e.switchButton.y=200,e.addChild(e.switchButton),e.switchButton.touchEnabled=!0,e.initPool(),e.updateView(),e}return __extends(e,t),e.prototype.switchTouched=function(t){BulletController.getInstance().switchBullet(),this.switchButton.setButtonText(i18n.getInstance().getLanguage("ui_switch")),void 0===this.storedBullet?this.updateView(!0):this.updateView(!1)},e.prototype.initPool=function(){for(var t,e=0;5>e;e++)t=new BulletView,this.bulletPool.push(t)},e.prototype.addNewBullet=function(){this.updateView(!0)},e.prototype.updateView=function(t){void 0===t&&(t=!0),this.bulletQueue.removeChildren();for(var e=BulletController.getInstance().bullets,i=0;i<e.length;i++){var n=this.getNoUsedBulletFromPool();n.type=e[i],n.index=RecordController.getInstance().bulletUsed+i+1,n.y=120,t?(n.x=170-150*i,egret.Tween.get(n).to({x:n.x+150},500)):n.x=320-150*i,this.bulletQueue.addChild(n)}null!==BulletController.getInstance().stored&&(this.storedBullet=this.getNoUsedBulletFromPool(),this.storedBullet.type=BulletController.getInstance().stored,this.storedBullet.x=AdaptSceenUtil.curWidth()-120,this.storedBullet.y=120,this.bulletQueue.addChild(this.storedBullet))},e.prototype.initPrepare=function(){this.preparedBullet=this.getNoUsedBulletFromPool(),this.addChild(this.preparedBullet)},e.prototype.prepareNextBullet=function(){},e.prototype.getNoUsedBulletFromPool=function(){for(var t=0;t<this.bulletPool.length;t++)if(null===this.bulletPool[t].parent)return this.bulletPool[t];return null},e}(egret.Sprite);__reflect(BulletControlView.prototype,"BulletControlView");var BulletHead=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e.prototype.setName=function(t){this.playerName=t},e}(egret.Sprite);__reflect(BulletHead.prototype,"BulletHead");var BulletView=function(t){function e(){var e=t.call(this)||this;return e.used=!1,e._type=BulletTypeEnum.MISSILE,e._index=0,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.head=new BulletHead,this.view=new egret.Bitmap,this.addChild(this.view),this.anchorOffsetX=this.view.width/2,this.anchorOffsetY=this.view.height/2,this.typeTextField=new egret.TextField,this.typeTextField.multiline=!0,this.typeTextField.anchorOffsetX=this.typeTextField.width,this.typeTextField.anchorOffsetY=this.typeTextField.height,this.addChild(this.typeTextField)},e.prototype.updateView=function(){this._type===BulletTypeEnum.GUIDED_MISSILE?this.typeTextField.text=i18n.getInstance().getLanguage("ui_bullet_"+this._type)+"\n("+i18n.getInstance().getLanguage("ui_bullet_no_index")+")":this.typeTextField.text=i18n.getInstance().getLanguage("ui_bullet_"+this._type)+this._index.toString()},Object.defineProperty(e.prototype,"index",{set:function(t){this._index=t,this._index>20&&(this.visible=!1),this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{set:function(t){this._type=t,this.view.texture=RES.getRes("bullet_png"),this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{set:function(t){this._status=t,this.updateView()},enumerable:!0,configurable:!0}),e.prototype.setUsed=function(){this.used=!0},e.prototype.setBulletHeadUserName=function(t){this.head.name=t},e}(egret.Sprite);__reflect(BulletView.prototype,"BulletView");var ResultPanel=function(t){function e(){var e=t.call(this)||this;return t.prototype.initView.call(e),e.setContent(),e}return __extends(e,t),e.prototype.setContent=function(){this.title=new egret.Bitmap,this.title.texture=RES.getRes("result_success_png"),this.title.anchorOffsetX=this.title.width/2,this.addChild(this.title),this.share_btn=new E8Button(this,RES.getRes("build_button_png"),this.shareResult),this.share_btn.x=0,this.share_btn.y=0,this.addChild(this.share_btn),this.city_btn=new E8Button(this,RES.getRes("build_button_png"),this.toCityScene),this.city_btn.x=200,this.city_btn.y=0,this.addChild(this.city_btn)},e.prototype.updateView=function(){},e.prototype.toCityScene=function(){SceneManager.getInstance().toCityScene()},e.prototype.shareResult=function(){},e}(Panel);__reflect(ResultPanel.prototype,"ResultPanel");var AirPort=function(t){function e(e){void 0===e&&(e=1);var i=t.call(this)||this;return i.touchEnabled=!0,i.update(RES.getRes("city1_sheet").getTexture("building1_"+e)),i}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(AirPort.prototype,"AirPort");var Bank=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Bank.prototype,"Bank");var BuildingListView=function(t){function e(){var e=t.call(this)||this;e.buildingList=[e.airport,e.bank,e.gasStation,e.scenery,e.science],e.buildings=[1,1,1,1,1],e.scrollView=new egret.ScrollView,e.scrollView.x=0,e.scrollView.y=0,e.addChild(e.scrollView),e.airport=new AirPort,e.airport.x=-960,e.bank=new Bank,e.gasStation=new GasStation,e.scenery=new Scenery,e.science=new Science,e.airport.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onAirPortTouched,e),e.bank.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onBankTouched,e),e.gasStation.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGasStationTouched,e),e.scenery.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onSceneryTouched,e),e.science.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onScienceTouched,e);var i=new egret.Sprite;return i.addChild(e.airport),i.addChild(e.bank),i.addChild(e.gasStation),i.addChild(e.scenery),i.addChild(e.science),e.scrollView.setContent(i),e}return __extends(e,t),e.prototype.update=function(){},e.prototype.levelUPBuilding=function(t){},e.prototype.onAirPortTouched=function(t){SceneManager.getInstance().openBuildingPop(1)},e.prototype.onBankTouched=function(t){},e.prototype.onGasStationTouched=function(t){},e.prototype.onSceneryTouched=function(t){},e.prototype.onScienceTouched=function(t){},e}(egret.Sprite);__reflect(BuildingListView.prototype,"BuildingListView");var BuildingPop=function(t){function e(e){var i=t.call(this)||this;return i.buildingId=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e.prototype.setBuildingId=function(t){this.buildingId=t},e}(egret.Sprite);__reflect(BuildingPop.prototype,"BuildingPop");var CityControlView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlContainer=new egret.Sprite,this.addChild(this.controlContainer)},e.prototype.renderControlView=function(t){switch(t.id){case BuildingEnum.UNSET:this.renderGroundControl();break;case BuildingEnum.AIRPORT:this.renderAirportControl();break;case BuildingEnum.BANK:this.renderBankControl();break;case BuildingEnum.BULLET_SCIENCE:this.renderScience();break;case BuildingEnum.GAS_STATION:this.renderStation();break;case BuildingEnum.DEFENSE:this.renderDefense();break;case BuildingEnum.INSURE_COMPANY:this.renderInsure();break;case BuildingEnum.REPAIR_FACTORY:this.renderRepair();break;case BuildingEnum.ADVERTISE_COMPANY:this.renderBanner()}},e.prototype.reset=function(){this.controlContainer.removeChildren()},e.prototype.updateView=function(){},e.prototype.renderGroundControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new GroundControlView)},e.prototype.renderAirportControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new AirportControlView)},e.prototype.renderBankControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new BankControlView)},e.prototype.renderScience=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new ScienceControlView)},e.prototype.renderStation=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new StationControlView)},e.prototype.renderBanner=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new BannerControlView)},e.prototype.renderRepair=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new FactoryControlView)},e.prototype.renderInsure=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new CompanyControlView)},e.prototype.renderDefense=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new DefenseControlView)},e}(egret.Sprite);__reflect(CityControlView.prototype,"CityControlView");var CityMessageView=function(t){function e(){var e=t.call(this)||this;return e.AIRPORT_RENDER="airport_render",e.BANK_RENDER="bank_render",e.BULLET_SCIENCE_RENDER="bullet_science_render",e.GAS_STATION_RENDER="gas_station_render",e.INSURE_COMPANY_RENDER="insure_company_render",e.DEFENSE_RENDER="defense_render",e.REPAIR_FACTORY_RENDER="repair_factory_render",e.ADVERTISE_COMPANY_RENDER="advertise_company_render",e.BANNER_RENDER="banner_render",e.GROUND_RENDER="ground_render",e.RANK_RENDER="rank_render",e.renderingPhase=0,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.addChild(this.viewBg),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer),this.renderHelloMsg()},e.prototype.updateView=function(){},e.prototype.renderBanner=function(){},e.prototype.renderBullet=function(){},e.prototype.renderPosition=function(t){return 0===t.level?void this.renderDestroyMsg():void this.renderBuilding(t.id)},e.prototype.renderBuilding=function(t){switch(this.msgContainer.removeChildren(),t){case BuildingEnum.AIRPORT:this.renderAirportMsg();break;case BuildingEnum.BANK:this.renderBankMsg();break;case BuildingEnum.BULLET_SCIENCE:this.renderScience();break;case BuildingEnum.GAS_STATION:this.renderStation();break;case BuildingEnum.INSURE_COMPANY:this.renderCompany();break;case BuildingEnum.DEFENSE:this.renderDefense();break;case BuildingEnum.REPAIR_FACTORY:this.renderFactory();break;case BuildingEnum.ADVERTISE_COMPANY:this.renderAdvertise()}},e.prototype.renderDestroyMsg=function(){},e.prototype.renderHelloMsg=function(){this.msgContainer.removeChildren();var t=new egret.TextField;t.x=10,t.text="欢迎回来,我想死你了",this.msgContainer.addChild(t)},e.prototype.renderAirportMsg=function(){if(this.currentRender!==this.AIRPORT_RENDER||0===this.renderingPhase){this.currentRender=this.AIRPORT_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderAirportMsg();var t=BuildingDataCache.getInstance().getAirportDataByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.AIRPORT),t=BuildingDataCache.getInstance().getAirportDataByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}new egret.TextField},e.prototype.renderBankMsg=function(){CityController.getInstance().getBuildingBlockByType(BuildingEnum.BANK);if(this.currentRender!==this.BANK_RENDER||0===this.renderingPhase){this.currentRender=this.BANK_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderBankMsg();var t=BuildingDataCache.getInstance().getBankDataByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.BANK),t=BuildingDataCache.getInstance().getBankDataByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderScience=function(){CityController.getInstance().getBuildingBlockByType(BuildingEnum.BANK);if(this.currentRender!==this.BULLET_SCIENCE_RENDER||0===this.renderingPhase){this.currentRender=this.BULLET_SCIENCE_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderScience();var t=BuildingDataCache.getInstance().getBulletScienceByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.BULLET_SCIENCE),t=BuildingDataCache.getInstance().getBulletScienceByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderFactory=function(){if(this.currentRender!==this.REPAIR_FACTORY_RENDER||0===this.renderingPhase){this.currentRender=this.REPAIR_FACTORY_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderBankMsg();var t=BuildingDataCache.getInstance().getRepairFactoryByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.REPAIR_FACTORY),t=BuildingDataCache.getInstance().getRepairFactoryByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderCompany=function(){if(this.currentRender!==this.INSURE_COMPANY_RENDER||0===this.renderingPhase){this.currentRender=this.INSURE_COMPANY_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderBankMsg();var t=BuildingDataCache.getInstance().getInsureCompanyByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.INSURE_COMPANY),t=BuildingDataCache.getInstance().getInsureCompanyByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderDefense=function(){if(this.currentRender!==this.DEFENSE_RENDER||0===this.renderingPhase){this.currentRender=this.DEFENSE_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderDefense();var t=BuildingDataCache.getInstance().getDefenseByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.DEFENSE),t=BuildingDataCache.getInstance().getDefenseByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderStation=function(){if(this.currentRender!==this.GAS_STATION_RENDER||0===this.renderingPhase){this.currentRender=this.GAS_STATION_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderStation();var t=BuildingDataCache.getInstance().getGasStationByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.GAS_STATION),t=BuildingDataCache.getInstance().getGasStationByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderAdvertise=function(){if(this.currentRender!==this.ADVERTISE_COMPANY_RENDER||0===this.renderingPhase){this.currentRender=this.ADVERTISE_COMPANY_RENDER,this.renderingPhase=1;var t=CityController.getInstance().selectedData;this.renderCurrentLevelMsg(t)}else if(1===this.renderingPhase){var e=CityController.getInstance().selectedData.level+1;if(e>5)return this.renderingPhase++,void this.renderAdvertise();var t=BuildingDataCache.getInstance().getAdvertiseByLevel(e);this.renderNextLevelMsg(t),this.renderingPhase++}else if(2===this.renderingPhase){var e=CityController.getInstance().getTopLevel(BuildingEnum.ADVERTISE_COMPANY),t=BuildingDataCache.getInstance().getAdvertiseByLevel(e);this.renderTopLevelMsg(t),this.renderingPhase=0}},e.prototype.renderCurrentLevelMsg=function(t){var e=new egret.TextField;e.text=i18n.getInstance().getLanguage(t.name),e.x=10,this.msgContainer.addChild(e);var i=new egret.TextField;i.text=i18n.getInstance().getLanguage("ui_level")+t.level,i.x=10+e.width+100,this.msgContainer.addChild(i);var n=new egret.TextField;n.text=i18n.getInstance().getLanguage(t.desc),n.x=10,n.y=e.height,n.width=this.viewBg.width-40,n.multiline=!0,this.msgContainer.addChild(n)},e.prototype.renderNextLevelMsg=function(t){var e=new egret.TextField;e.text=i18n.getInstance().getLanguage("ui_next_level")+i18n.getInstance().getLanguage(t.name),e.x=10,this.msgContainer.addChild(e);var i=new egret.TextField;i.text=i18n.getInstance().getLanguage("ui_next_level")+t.level,i.x=10+e.width+100,this.msgContainer.addChild(i);var n=(new egret.TextField,new egret.TextField);n.text=i18n.getInstance().getLanguage(t.desc),n.x=10,n.y=e.height,n.width=this.viewBg.width-40,n.multiline=!0,this.msgContainer.addChild(n)},e.prototype.renderTopLevelMsg=function(t){var e=new egret.TextField;e.text=i18n.getInstance().getLanguage(t.name),e.x=10,this.msgContainer.addChild(e);var i=new egret.TextField;i.text=i18n.getInstance().getLanguage("ui_top_level")+t.level,i.x=10+e.width+100,this.msgContainer.addChild(i);var n=(new egret.TextField,new egret.TextField);n.text=i18n.getInstance().getLanguage(t.desc),n.x=10,n.y=e.height,n.width=this.viewBg.width-40,n.multiline=!0,this.msgContainer.addChild(n)},e}(egret.Sprite);__reflect(CityMessageView.prototype,"CityMessageView");var CityScene=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.addChild(new BackGround),this.cityMsgView=new CityMessageView,this.cityMsgView.anchorOffsetX=this.cityMsgView.width/2,this.cityMsgView.x=AdaptSceenUtil.curWidth()/2,this.cityMsgView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.cityMsgView),this.cityView=new CityView,this.cityView.touchChildren=!0,this.cityView.touchEnabled=!0,this.addChild(this.cityView),this.cityControl=new CityControlView,this.cityControl.width=AdaptSceenUtil.curWidth(),this.cityControl.x=0,this.cityControl.y=AdaptSceenUtil.curHeight()-280,this.cityControl.touchEnabled=!0,this.cityControl.visible=!1,SceneManager.getInstance().getUILayer().addChild(this.cityControl),this.balloon=new egret.Bitmap,this.balloon.touchEnabled=!0,this.balloon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBalloonReward,this),this.addChild(this.balloon)},e.prototype.inAnimate=function(){this.cityControl.visible=!0,this.cityView.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onToCityScene,this),CityController.getInstance().resetSelected(),this.cityControl.reset(),this.visible=!0},e.prototype.outAnimate=function(){this.cityControl.visible=!1,this.visible=!1,this.cityView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onToCityScene,this)},e.prototype.onToCityScene=function(t){SceneManager.getInstance().toCityScene()},e.prototype.selectPosition=function(t,e){this.cityView.updateSelected(e),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.flyballoon=function(){var t=this,e=Math.floor(3*Math.random())+1;console.log(e),this.balloon.texture=RES.getRes("balloon"+e+"_png"),this.balloon.x=AdaptSceenUtil.curWidth(),this.balloon.y=AdaptSceenUtil.curHeight()/2+100-200*Math.random(),this.balloon.scaleX=this.balloon.scaleY=(this.y+200)/100,egret.Tween.get(this.balloon).to({x:120},1e4).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).to({y:this.balloon.y+10*Math.random()},1e3).call(function(){t.balloon.visible=!1})},e.prototype.build=function(t){this.cityView.build(t),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.demolish=function(t){this.cityView.demolish(),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.levelupBuilding=function(t){this.cityView.levelUp(),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.buildDetail=function(t){this.cityMsgView.renderBuilding(t)},e.prototype.onBalloonReward=function(){this.balloon.visible=!1,RewardController.getInstance().balloonReward()},e}(egret.Sprite);__reflect(CityScene.prototype,"CityScene",["Scene"]);var CityView=function(t){function e(){var e=t.call(this)||this;return e.addSequence=[6,1,5,0,2,4,3],e.groundX=[0,100,200,100,-100,-200,-100],e.groundY=[0,-160,0,160,160,0,-160],e.groundList=new Array,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.currentSelect=null,this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("city_bg_png"),this.bg.scaleX=this.bg.scaleY=.5,this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.x=AdaptSceenUtil.curWidth()/2,this.bg.y=AdaptSceenUtil.curHeight()/2;var t;this.groundList.length=7,this.centerX=AdaptSceenUtil.curWidth()/2,this.centerY=AdaptSceenUtil.curHeight()/2;for(var e,i=CityController.getInstance().getBuildings(),n=0;n<this.addSequence.length;n++)t=new Ground(this.addSequence[n]),t.x=this.centerX+this.groundX[this.addSequence[n]],t.y=this.centerY+this.groundY[this.addSequence[n]],t.touchEnabled=!0,e=new egret.Bitmap,e.texture=RES.getRes("pillar_png"),e.anchorOffsetX=e.width/2,e.scaleX=.3,e.scaleY=.3,e.x=t.x,e.y=t.y-t.height/2,this.addChild(e),this.addChild(t),this.groundList[this.addSequence[n]]=t,null!==i[this.addSequence[n]]&&t.setBuilding(i[this.addSequence[n]].id,i[this.addSequence[n]].level);this.anchorOffsetX=this.centerX,this.anchorOffsetY=this.centerY,this.x=AdaptSceenUtil.curWidth()/2,this.y=AdaptSceenUtil.curHeight()/2,this.addBuildingTouchEventListener()},e.prototype.addBuildingTouchEventListener=function(){for(var t=0;t<this.groundList.length;t++)this.groundList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.groundTouched,this),this.groundList[t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groundTouchBegin,this)},e.prototype.removeBuildingTouchEventListener=function(){for(var t=0;t<this.groundList.length;t++)this.groundList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.groundTouched,this),this.groundList[t].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groundTouchBegin,this)},e.prototype.updateView=function(t){if(void 0===t&&(t=null),null===t)for(var e=CityController.getInstance().getBuildings(),i=0;i<Const.getInstance().maxBuilding;i++)this.groundList[i].setBuilding(e[i].id,e[i].level);
else{var e=CityController.getInstance().getBuildings();this.groundList[t].setBuilding(e[t].id,e[t].level)}},e.prototype.groundTouchBegin=function(t){this.removeBuildingTouchEventListener(),this.longTouchTime=(new Date).getTime();var e=t.target;this.currentLongTouch=e,t.target.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),t.target.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},e.prototype.touchMove=function(t){},e.prototype.touchEnd=function(t){t.target.scaleX=t.target.scaleY=.8,egret.Tween.get(t.target).to({scaleX:1,scaleY:1},500,egret.Ease.bounceOut),this.addBuildingTouchEventListener();var e=(new Date).getTime();e-this.longTouchTime<1500||(t.target.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this))},e.prototype.groundTouched=function(t){var e=t.target;CityController.getInstance().selectPosition(e.position)},e.prototype.closeUp=function(t){egret.Tween.get(this,{loop:!1}).to({x:this.centerX-2*this.groundX[t],y:this.centerY-2*this.groundY[t],scaleX:2,scaleY:2},1500)},e.prototype.updateSelected=function(t){null!==this.currentSelect&&(this.groundList[this.currentSelect].selected=!1),this.currentSelect=t,this.groundList[t].selected=!0},e.prototype.build=function(t){this.groundList[this.currentSelect].setBuilding(t.id,1)},e.prototype.demolish=function(){this.groundList[this.currentSelect].demolish()},e.prototype.levelUp=function(){this.groundList[this.currentSelect].levelUp()},e}(egret.Sprite);__reflect(CityView.prototype,"CityView");var GasStation=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(GasStation.prototype,"GasStation");var Ground=function(t){function e(e){var i=t.call(this)||this;return i.stars=[],i.starPos=[[{x:0,y:-100,rotation:0}],[{x:-15,y:-100,rotation:0},{x:15,y:-100,rotation:0}],[{x:-30,y:-100,rotation:-10},{x:0,y:-105,rotation:0},{x:30,y:-100,rotation:10}],[{x:-30,y:-100,rotation:-15},{x:-10,y:-105,rotation:-5},{x:10,y:-105,rotation:5},{x:30,y:-100,rotation:15}],[{x:-40,y:-90,rotation:-40},{x:-20,y:-100,rotation:-10},{x:0,y:-105,rotation:0},{x:20,y:-100,rotation:10},{x:40,y:-90,rotation:40}]],i._position=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.bgView=new egret.Bitmap,this.bgView.texture=RES.getRes("ground_png"),this.bgView.anchorOffsetX=this.bgView.width/2,this.bgView.anchorOffsetY=this.bgView.height/2,this.bgView.scaleX=this.bgView.scaleY=.3,this.bgView.alpha=1,this.addChild(this.bgView),this.buildingView=new egret.Bitmap,this.addChild(this.buildingView),this.selectedView=new egret.Bitmap,this.selectedView.texture=RES.getRes("selected_png"),this.selectedView.anchorOffsetX=this.bgView.width/2,this.selectedView.anchorOffsetY=this.bgView.height/2,this.selectedView.scaleX=this.selectedView.scaleY=.3,this.addChild(this.selectedView),this.protectedView=new egret.Bitmap,this.protectedView.texture=RES.getRes("protect_png"),this.protectedView.anchorOffsetX=this.protectedView.width/2,this.protectedView.anchorOffsetY=this.protectedView.height/2,this.protectedView.scaleX=this.protectedView.scaleY=.3,this.addChild(this.protectedView),this.levelStars=new egret.Sprite,this.addChild(this.levelStars);for(var t,e=0;5>e;e++)t=new egret.Bitmap,t.texture=RES.getRes("star_png"),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.scaleX=t.scaleY=.2,this.stars.push(t);this.updateView()},e.prototype.updateView=function(){console.log(CityController.getInstance().isProtected(this.position)),CityController.getInstance().isProtected(this.position)?this.protectedView.visible=!0:this.protectedView.visible=!1,this.levelStars.removeChildren();for(var t=0;t<this.level;t++)this.stars[t].x=this.starPos[this.level-1][t].x,this.stars[t].y=this.starPos[this.level-1][t].y,this.stars[t].rotation=this.starPos[this.level-1][t].rotation,this.levelStars.addChild(this.stars[t])},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),e.prototype.setBuilding=function(t,e){if(-1===t)return void this.updateView();if(this.buildingId===t&&this.buildingLevel===e)return void this.updateView();if(t!==this.buildingId){var i=BuildingEnum.buildingString[t];this.buildingView.texture=RES.getRes("view_"+i+"_png"),this.buildingView.anchorOffsetX=this.buildingView.width/2,this.buildingView.anchorOffsetY=this.buildingView.height/2,this.buildingView.scaleX=this.buildingView.scaleY=.3}this.buildingId=t,this.buildingLevel=e,this.updateView()},e.prototype.levelUp=function(){this.buildingLevel++,this.updateView()},e.prototype.demolish=function(){this.buildingId=-1,this.buildingLevel=0,this.buildingView.texture=null,this.updateView()},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"id",{get:function(){return this.buildingId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.buildingLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{set:function(t){this._selected=t,t?DrawUtil.setImageColor(this.bgView,14496733):DrawUtil.setImageColor(this.bgView,16777215)},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Ground.prototype,"Ground");var RankButtom=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e}(egret.Sprite);__reflect(RankButtom.prototype,"RankButtom");var Scenery=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Scenery.prototype,"Scenery");var Science=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Science.prototype,"Science");var BankControlView=function(t){function e(){var e=t.call(this)||this;return e.initBankView(),e}return __extends(e,t),e.prototype.initBankView=function(){return this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),void this.addChild(this.titleTextField)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(BankControlView.prototype,"BankControlView");var BannerControlView=function(t){function e(){var e=t.call(this)||this;return e.initBankView(),e}return __extends(e,t),e.prototype.initBankView=function(){return this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),void this.addChild(this.titleTextField)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(BannerControlView.prototype,"BannerControlView");var GuideController=function(){function t(){if(this.current_step=0,this.guideList=[],t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){this.guideData=Number(SaveDataManager.getInstance().getUserData().guide);for(var t=this.guideData,e=0;t>0&&0!==(t&&1);)t>>=1,this.guideList.push(!0),e++;this.current_step=e,console.log("current_step"+this.current_step)},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.isNew=function(){return console.log(this.guideData),0===this.guideData},t.prototype.isFinished=function(){return console.log(this.guideList),this.guideList.length>=10},t.prototype.getGuideStep=function(){return this.current_step},t.prototype.getGuide=function(){return this.guideData},t.prototype.saveGuide=function(t){this.guideData=t,SaveDataManager.getInstance().setGuide(this.guideData)},t.prototype.dropPlaneGuide=function(){},t.prototype.startAwayGuide=function(){this.current_step=1,this.guideStep(this.current_step)},t.prototype.hitGridGuide=function(t){console.log("grid"+t);var e=SceneManager.getInstance().awayScene;this.current_step===GuideEnum.HIT_GRID?(e.showGridView(t,GridTypeEnum.BODY),BulletController.getInstance().useBullet(),AIController.getInstance().addPlaneByBody(t)):this.current_step>=GuideEnum.HIT_BODY&&GameController.getInstance().hitGrid(t,BulletController.getInstance().useBullet()),this.onNextGuide()},t.prototype.guideStep=function(t){var e=SceneManager.getInstance().awayScene;switch(e.updateMsg(),t){case GuideEnum.NEW_PLAYER_GUIDE:console.log("欢迎来到,迷雾云端～您在这里需要击落下边地图上的三架飞机，当然显示生活中您是不能这么干的。(悼念MH370遇难同胞)"),SceneManager.getInstance().awayScene.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextGuide,this),console.log(GuideEnum.NEW_PLAYER_GUIDE);break;case GuideEnum.GAME_AIM:console.log("如下地图上有三架1-5-1-3样式的飞机,你需要找到他们的位置所在并击中他们的头部,来取得胜利");break;case GuideEnum.HIT_GRID:console.log("点击屏幕试着发射一枚导弹吧"),SceneManager.getInstance().awayScene.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextGuide,this),SceneManager.getInstance().awayScene.getGameView().setGuideStepGridEnable(GuideEnum.HIT_GRID);break;case GuideEnum.HIT_BODY:console.log("恭喜你！成功的击中了一家飞机的身体,黄色的标记水晶,表示攻击中飞机身体"),console.log("那么这这架飞机可能是这个样子,看看能否击中飞机头部!");break;case GuideEnum.HIT_EMPTY_GOT_BULLET:BulletController.getInstance().rewardOneBullet(BulletTypeEnum.NINE_PALACE_MISSILE),console.log("好可惜,没有猜中飞机头部的位置,不过值得庆幸的是我们击中了一个隐藏的宝箱"),console.log("我们获得了一个重磅炸弹，这种炸弹可以对一个范围目标进行攻击哦");break;case GuideEnum.GOT_BULLET:console.log("获得的炸弹将会在下一次攻击中使用哦,我们还可以点击储藏,将这个炸弹保留到下一回合"),console.log("但是如果这局没有使用这个炸弹,他将被折算成金币赠与你哦～");break;case GuideEnum.BULLET:console.log("在一次进攻中,我们的轰炸机只能携带20颗炸弹呢,所以一定要在使用前~"),console.log("所以一定要用这20枚炸弹击落敌方的三架飞机，我们才能获取这次进攻的战斗奖励～");break;case GuideEnum.HIT_HEAD:console.log("再次尝试点击屏幕,对敌方阵营进行摧毁吧");break;case GuideEnum.THREE_PLANE_GUIDE:console.log("恭喜你，成功的战胜了敌人"),console.log("点击这里,获得本次进攻的奖励")}},t.prototype.onNextGuide=function(t){void 0===t&&(t=null),this.current_step++,this.guideList.length<this.current_step&&(this.guideList.push(!0),this.guideData+=Math.pow(2,this.current_step)),console.log(this.guideList),console.log(this.current_step),SaveDataManager.getInstance().setGuide(this.guideData),SaveDataManager.getInstance().saveUserData(),this.guideStep(this.current_step)},t.prototype.guideFinished=function(){this.current_step=GuideEnum.AWAY_GUIDE_FINISHED,this.guideList.length<this.current_step&&(this.guideList.push(!0),this.guideData+=Math.pow(2,this.current_step)),console.log(this.guideList),console.log(this.current_step),SaveDataManager.getInstance().setGuide(this.guideData),SaveDataManager.getInstance().saveUserData()},t.instance=null,t}();__reflect(GuideController.prototype,"GuideController");var BuildingView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.buildingView=new egret.Bitmap,this.buildingView.x=this.width/2,this.buildingView.y=this.height/2,this.buildingView.touchEnabled=!0,this.addChild(this.buildingView),this.nameText=new egret.TextField,this.nameText.textAlign=egret.HorizontalAlign.CENTER,this.nameText.x=this.width/2,this.nameText.y=30,this.addChild(this.nameText),this.levelText=new egret.TextField,this.levelText.x=this.bg.width-20,this.addChild(this.levelText),this.insureText=new egret.TextField,this.insureText.x=this.bg.width-50,this.addChild(this.insureText),[2]})})},e.prototype.updateData=function(){},Object.defineProperty(e.prototype,"view",{set:function(t){this.buildingView.texture=RES.getRes(t),this.buildingView.anchorOffsetX=this.buildingView.width/2,this.buildingView.anchorOffsetY=this.buildingView.height/2,this.buildingView.scaleX=this.buildingView.scaleY=.25},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t,this.nameText.text=this._name,this.nameText.anchorOffsetX=this.nameText.width/2,this.nameText.anchorOffsetY=this.nameText.height/2,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t,this.levelText.text=this._level.toString(),this.updateData()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BuildingView.prototype,"BuildingView");var CompanyControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.INSURE_STATUS=1,e.INFO_STATUS=2,e.UNINSURE_STATUS=3,e.initInsure(),e}return __extends(e,t),e.prototype.initInsure=function(){this.status=this.INIT_STATUS,this.demolishButton.visible=!1,this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton),this.saftyRatioText=new egret.TextField,this.saftyRatioText.text="城市安全评估:"+CityController.getInstance().getCitySaftyRatio().toString(),this.saftyRatioText.x=0,this.saftyRatioText.y=100,this.addChild(this.saftyRatioText),this.insureTimesText=new egret.TextField,this.insureTimesText.text="还可投保建筑数"+CityController.getInstance().selectedData.building,this.insureTimesText.x=350,this.insureTimesText.y=100,this.addChild(this.insureTimesText),this.buyButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.onShowBuldingList),this.buyButton.scale(.5,.5),this.buyButton.setButtonText(i18n.getInstance().getLanguage("ui_buy_insure")),this.buyButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.buyButton.y=200,this.addChild(this.buyButton),this.cancelButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.onShowInsuredBuilding),this.cancelButton.scale(.5,.5),this.cancelButton.setButtonText(i18n.getInstance().getLanguage("ui_uninsure")),this.cancelButton.x=AdaptSceenUtil.curWidth()-4*this.buyButton.width-40,this.cancelButton.y=200,this.addChild(this.cancelButton),this.scrollView=new egret.ScrollView,this.buildingContainer=new egret.Sprite,this.scrollView.x=0,this.scrollView.width=AdaptSceenUtil.curWidth(),this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.addChild(this.scrollView),this.updateView()},e.prototype.updateView=function(){this.status===this.INSURE_STATUS?(this.scrollView.visible=!0,this.backButton.visible=!0,this.levelUpButton.visible=!1,this.demolishButton.visible=!1,this.buyButton.visible=!1,this.cancelButton.visible=!1):this.status===this.INIT_STATUS?(this.scrollView.visible=!1,this.backButton.visible=!1,this.levelUpButton.visible=!0,this.demolishButton.visible=!0,this.buyButton.visible=!0,this.cancelButton.visible=!0):this.status===this.INFO_STATUS},e.prototype.onBackButtonTouched=function(){this.status=this.INIT_STATUS,this.updateView()},e.prototype.onShowBuldingList=function(t){this.status=this.INSURE_STATUS,this.buildingList=[];for(var e,i,n=0;n<CityController.getInstance().getBuildings().length;n++)0!==CityController.getInstance().getBuildings()[n].level&&(i=CityController.getInstance().getBuildings()[n],e=new BuildingView,e.touchEnabled=!0,e.name=i18n.getInstance().getLanguage(i.name),e.position=n,e.level=i.level,e.view=i.view,e.x=200*this.buildingList.length,this.buildingList.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyBuildingInsure,this),this.buildingContainer.addChild(e));this.scrollView.setContent(this.buildingContainer),this.updateView()},e.prototype.onBuyBuildingInsure=function(t){var e=t.target;CityController.getInstance().buyInsure(e.position)},e.prototype.onShowInsuredBuilding=function(t){this.status=this.INSURE_STATUS,this.buildingList=[];for(var e,i=CityController.getInstance().getBuildings(),n=0;n<i.length;n++)0!==i[n].level&&0!==i[n].insure.length&&(e=new BuildingView,e.touchEnabled=!0,e.touchChildren=!1,e.name=i18n.getInstance().getLanguage(i[n].name),e.position=n,e.level=i[n].level,e.x=200*this.buildingList.length,e.view=i[n].view,this.buildingList.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuildingUninsure,this),this.buildingContainer.addChild(e));this.scrollView.setContent(this.buildingContainer),this.updateView()},e.prototype.onBuildingUninsure=function(t){var e=t.target;CityController.getInstance().unInsure(e.position)},e}(BuildingControlView);__reflect(CompanyControlView.prototype,"CompanyControlView");var DefenseControlView=function(t){function e(){var e=t.call(this)||this;return e.initDefense(),e}return __extends(e,t),e.prototype.initDefense=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton),this.buyButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.onBuyMissle),this.buyButton.scale(.5,.5),this.buyButton.setButtonText(i18n.getInstance().getLanguage("ui_buy_missle")),this.buyButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.buyButton.y=200,this.addChild(this.buyButton)},e.prototype.onBackButtonTouched=function(){},e.prototype.onBuyMissle=function(){CityController.getInstance().buyMissle()},e}(BuildingControlView);__reflect(DefenseControlView.prototype,"DefenseControlView");var FactoryControlView=function(t){function e(){var e=t.call(this)||this;return e.initFactoryView(),e}return __extends(e,t),e.prototype.initFactoryView=function(){return this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),CityController.getInstance().selectedData.level<CityController.getInstance().selectedData.top&&(this.repairButton.visible=!0),this.repairAllButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.repairAllBuilding),this.repairAllButton.scale(.5,.5),this.repairAllButton.setButtonText(i18n.getInstance().getLanguage("ui_repair_all")),this.repairAllButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.repairAllButton.y=200,void this.addChild(this.repairAllButton)},e.prototype.onBackButtonTouched=function(){},e.prototype.repairAllBuilding=function(){CityController.getInstance().repairAll()},e}(BuildingControlView);__reflect(FactoryControlView.prototype,"FactoryControlView");var GroundControlView=function(t){function e(){var e=t.call(this)||this;return e.buildingViewList=[null],e.touchedTime=0,e.touching=!1,e.intiView(),e}return __extends(e,t),e.prototype.intiView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.controlViewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.controlViewBg),this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text="新建筑",this.addChild(this.titleTextField),this.tipText=new egret.TextField,this.tipText.x=36,this.tipText.y=18+this.titleTextField.height,this.tipText.text="一星建筑拆除没有折损，会返回原价，您可以任意尝试多种建筑组合。",this.addChild(this.tipText),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.buildingContainer=new egret.Sprite;for(var t,e,i=1;i<BuildingEnum.count;i++)t=BuildingDataCache.getInstance().getBuildingByIdAndLevel(i,1),e=new BuildingView,e.touchEnabled=!0,e.name=i18n.getInstance().getLanguage(t.name),e.view=t.view,e.x=200*(this.buildingViewList.length-1),this.buildingViewList.push(e),e.touchChildren=!1,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuild,this),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.buildingContainer.addChild(e);this.scrollView.width=AdaptSceenUtil.curWidth(),this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.buildingContainer),this.addChild(this.scrollView)},e.prototype.onBuild=function(t){var e=t.target,i=this.buildingViewList.indexOf(e);CityController.getInstance().buildBuilding(i)},e.prototype.onTouchBegin=function(t){var e=this;this.touchedTime=(new Date).getTime(),this.touching=!0,egret.setTimeout(function(){e.touching&&(console.log(e.buildingViewList),SceneManager.getInstance().cityScene.buildDetail(e.buildingViewList.indexOf(t.target)))},this,1e3),t.target.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchEnd=function(t){this.touching=!1,t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onBackButtonTouched=function(){},e}(egret.Sprite);__reflect(GroundControlView.prototype,"GroundControlView");var ScienceControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.BULLETS_STATUS=1,e.INFO_STATUS=2,e.initScieneView(),e}return __extends(e,t),e.prototype.initScieneView=function(){this.status=this.INIT_STATUS,this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton),this.detailButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.showBulletList),this.detailButton.scale(.5,.5),this.detailButton.setButtonText(i18n.getInstance().getLanguage("ui_bullet_detail")),this.detailButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.detailButton.y=200,this.addChild(this.detailButton),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.bulletList=new Array;for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView),this.updateView()},e.prototype.updateView=function(){this.status===this.BULLETS_STATUS?(this.scrollView.visible=!0,this.backButton.visible=!0,this.levelUpButton.visible=!1,this.demolishButton.visible=!1):this.status===this.INIT_STATUS?(this.scrollView.visible=!1,this.backButton.visible=!1,this.levelUpButton.visible=!0,this.demolishButton.visible=!0):this.status===this.INFO_STATUS},e.prototype.showBulletList=function(){this.status=this.BULLETS_STATUS},e.prototype.onBackButtonTouched=function(t){t.target;SceneManager.getInstance().cityScene.cityMsgView.renderBullet()},e}(BuildingControlView);__reflect(ScienceControlView.prototype,"ScienceControlView");var StationControlView=function(t){function e(){var e=t.call(this)||this;return e.initStation(),e}return __extends(e,t),e.prototype.initStation=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(StationControlView.prototype,"StationControlView");var AirportControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.OPPONENT_STATUS=1,e.initAirport(),e}return __extends(e,t),e.prototype.initAirport=function(){if(this.status=this.INIT_STATUS,this.demolishButton.visible=!1,this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData.name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.oppoContiner=new egret.Sprite,this.opponentList=new Array,CityController.getInstance().getBuildingByPostion(0).level>0)for(var t=AIController.getInstance().randomOpponent(),e=void 0,i=0;i<t.length;i++)e=new OpponentView,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedOpponent,this),e.x=200*i,e.level=t[i],this.oppoContiner.addChild(e),this.opponentList.push(e);else this.repairButton.visible=!0;this.refreshButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.onRefreshButtonTouched),this.refreshButton.scale(.5,.5),this.refreshButton.setButtonText(i18n.getInstance().getLanguage("ui_refresh")),this.refreshButton.x=0,this.refreshButton.y=200,this.addChild(this.refreshButton),this.scrollView.x=this.refreshButton.width+10,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.oppoContiner),this.addChild(this.scrollView),this.awayButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.onToAwayScene),this.awayButton.scale(.5,.5),this.awayButton.setButtonText(i18n.getInstance().getLanguage("ui_attack")),this.awayButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-30,this.awayButton.y=200,this.addChild(this.awayButton),this.placingButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.onToPlacingScene),this.placingButton.scale(.5,.5),this.placingButton.setButtonText(i18n.getInstance().getLanguage("ui_placing")),this.placingButton.x=AdaptSceenUtil.curWidth()-2*this.levelUpButton.width-20,this.placingButton.y=200,this.addChild(this.placingButton),this.updateView()},e.prototype.updateView=function(){this.status===this.OPPONENT_STATUS?(this.placingButton.visible=!1,this.awayButton.visible=!1,this.scrollView.visible=!0,this.backButton.visible=!0,this.levelUpButton.visible=!1,this.refreshButton.visible=!0,this.repairButton.visible=!1):(this.placingButton.visible=!0,this.awayButton.visible=!0,this.scrollView.visible=!1,this.backButton.visible=!1,this.levelUpButton.visible=!0,this.refreshButton.visible=!1,CityController.getInstance().selectedData.level<CityController.getInstance().selectedData.top&&(this.repairButton.visible=!0),this.repairButton?this.repairButton.visible=!0:this.repairButton.visible=!1)},e.prototype.onToPlacingScene=function(t){GameController.getInstance().startPlacingGame(),SceneManager.getInstance().toPlacingScene()},e.prototype.onToAwayScene=function(t){this.status=this.OPPONENT_STATUS,this.updateView()},e.prototype.onSelectedOpponent=function(t){var e=t.target;GameController.getInstance().attackOpponent(e.level)},e.prototype.onBackButtonTouched=function(){this.status===this.OPPONENT_STATUS&&(this.status=this.INIT_STATUS,this.updateView())},e.prototype.onRefreshButtonTouched=function(){for(var t,e=AIController.getInstance().randomOpponent(),i=0;i<e.length;i++)this.opponentList.length>=i?this.opponentList[i].level=e[i]:(t=new OpponentView,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedOpponent,this),t.x=200*i,t.level=e[i],this.oppoContiner.addChild(t),this.opponentList.push(t))},e}(BuildingControlView);__reflect(AirportControlView.prototype,"AirportControlView");var OpponentView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.airport=new egret.Bitmap,this.airport.texture=RES.getRes("view_airport_png"),this.airport.anchorOffsetX=this.airport.width/2,this.airport.anchorOffsetY=this.airport.height/2,this.airport.scaleX=this.airport.scaleY=.25,this.airport.x=this.bg.width/2,this.airport.y=this.bg.height/2,this.addChild(this.airport),this.nameText=new egret.TextField,this.nameText.textAlign=egret.HorizontalAlign.CENTER,this.nameText.x=this.width/2,this.nameText.y=0,this.addChild(this.nameText),this.levelText=new egret.TextField,this.levelText.x=30,this.levelText.y=30,this.addChild(this.levelText),[2]})})},e.prototype.updateData=function(){var t=CityController.getInstance().makeOpponenetDataByLevel(this._level);this.levelText.text=i18n.getInstance().getLanguage("ui_oppo_"+t.level)},Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t,this.updateData()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(OpponentView.prototype,"OpponentView");var GameView=function(t){function e(e,i,n){void 0===e&&(e=!1),void 0===i&&(i=null),void 0===n&&(n=!0);var r=t.call(this)||this;return r.gridList=[],r.letters=["A","B","C","D","E","F","G","H","I"],r.numbers=["1","2","3","4","5","6","7","8","9"],r.rowTags=[],r.colTags=[],r.showAll=e,r.showTags=n,null!==i?r.initWithData(i):r.initView(),r}return __extends(e,t),e.prototype.initWithData=function(t){for(var e,i=0;81>i;i++){var n=i%9,r=Math.floor(i/9),o=void 0,s=void 0;i%2==1?(o=240116,s=1):(o=16777215,s=0);var a=new egret.Shape;a.graphics.beginFill(o,s),a.graphics.drawRect(0,0,60,60),a.graphics.endFill(),this.addChild(a),this.showAll?(e=new PlacingGridView(i),null!==t&&e.setPlane(t[i].index,t[i].gridType,t[i].bodyType,t[i].direction)):e=new AwayGridView(i),e.x=60*n,e.y=60*r,this.addGridEventListener(e),this.addChild(e),this.gridList.push(e)}this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=AdaptSceenUtil.curWidth()/2,this.y=AdaptSceenUtil.curHeight()/2,this.showTags&&this.addTags()},e.prototype.updateWithData=function(t){for(var e=0;81>e;e++)this.gridList[e].setPlane(t[e].index,t[e].gridType,t[e].bodyType,t[e].direction),this.gridList[e].updateView()},e.prototype.initView=function(){for(var t,e=0;81>e;e++){var i=e%9,n=Math.floor(e/9),r=void 0,o=void 0;
e%2==1?(r=240116,o=1):(r=16777215,o=0);var s=new egret.Shape;s.graphics.beginFill(r,o),s.graphics.drawRect(0,0,60,60),s.graphics.endFill(),s.x=60*i,s.y=60*n,this.addChildAt(s,0),t=this.showAll?new PlacingGridView(e):new AwayGridView(e),t.x=60*i,t.y=60*n,this.addGridEventListener(t),this.addChildAt(t,this.numChildren-1),this.gridList.push(t)}this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2;var a=0;this.showTags&&(this.addTags(),a=AdaptSceenUtil.curWidth()/2-this.width/2),this.x=AdaptSceenUtil.curWidth()/2+a,this.y=AdaptSceenUtil.curHeight()/2},e.prototype.addTags=function(){for(var t,e=0;9>e;e++)t=DrawUtil.textFilter(this.numbers[e],36,!1),t.x=60*e+30,t.y=-30,this.colTags.push(t),this.addChild(t),t=DrawUtil.textFilter(this.letters[e],36,!1),t.x=-30,t.y=60*e+30,this.rowTags.push(t),this.addChild(t)},e.prototype.addGridEventListener=function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouched,this),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchRelease,this)},e.prototype.resetView=function(){for(var t=0;81>t;t++)this.gridList[t].resetView()},e.prototype.updateView=function(){for(var t=0;81>t;t++)this.gridList[t].updateView()},e.prototype.updateTags=function(){for(var t=0;9>t;t++)DrawUtil.setImageColor(this.colTags[t],16777215),DrawUtil.setImageColor(this.rowTags[t],16777215)},e.prototype.onTouched=function(t){var e=t.target;PlayerHandleController.getInstance().playerTouchedGameView(e.id)},e.prototype.onTouchBegin=function(t){this.updateTags();var e=t.target,i=MapUtil.getXYFromValue(e.id).x,n=MapUtil.getXYFromValue(e.id).y;DrawUtil.setImageColor(this.colTags[i],16711680),DrawUtil.setImageColor(this.rowTags[n],16711680),PlayerHandleController.getInstance().playerBeginMoveInGameView(e.id,t)},e.prototype.onTouchMove=function(t){var e=t.target;this.updateTags();var i=MapUtil.getXYFromValue(e.id).x,n=MapUtil.getXYFromValue(e.id).y;DrawUtil.setImageColor(this.colTags[i],16711680),DrawUtil.setImageColor(this.rowTags[n],16711680),PlayerHandleController.getInstance().playerMovingInGameView(e.id,t)},e.prototype.onTouchEnd=function(t){var e=t.target;this.updateTags(),PlayerHandleController.getInstance().playerReleaseOnGameView(e.id,t)},e.prototype.onTouchRelease=function(t){t.target},e.prototype.onTouchCancel=function(t){},e.prototype.setGuideStepGridEnable=function(t){switch(t){case GuideEnum.HIT_GRID:this.gridList[0].enable=1,this.gridList[8].enable=1,this.gridList[72].enable=1,this.gridList[80].enable=1;break;case GuideEnum.HIT_BODY:this.gridList[0].enable=2,this.gridList[8].enable=2,this.gridList[72].enable=2,this.gridList[80].enable=2,this.gridList[0].enable=2,this.gridList[8].enable=2,this.gridList[72].enable=2,this.gridList[80].enable=2,this.gridList[0].enable=2,this.gridList[8].enable=2,this.gridList[72].enable=2,this.gridList[80].enable=2;break;default:this.gridList[0].enable=0,this.gridList[8].enable=0,this.gridList[72].enable=0,this.gridList[80].enable=0}},e}(egret.Sprite);__reflect(GameView.prototype,"GameView");var PlacingController=function(){function t(){if(this.heads=null,t.instance)throw new Error("AIController singlon error");this.init()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.init=function(){},t.prototype.shareMap=function(){null!==this.heads&&(platform.share("欢迎来打飞机","","",this.onShared,this.heads,""),SaveDataManager.getInstance().getUserData().shareMap(this.heads))},t.prototype.onShared=function(){GameController.getInstance().addGas(SaveDataManager.getInstance().getUserData().gas)},t.prototype.randomMap=function(){SceneManager.getInstance().placingScene.resetView();var t=AIController.getInstance().generateRandomMap();this.heads=t.getHeadList();for(var e=0,i=0;i<this.heads.length;i++)e++,SceneManager.getInstance().placingScene.addOnePlane(e,this.heads[i].head,this.heads[i].direction);SceneManager.getInstance().placingScene.planeAmount=e},t.prototype.selectedSharedMap=function(t){SceneManager.getInstance().placingScene.resetView();var e=0;t.headData.forEach(function(t){e++,SceneManager.getInstance().placingScene.addOnePlane(e,t.head,t.direction)}),SceneManager.getInstance().placingScene.planeAmount=3},t.prototype.addOnePlane=function(){},t.prototype.getHomeMapData=function(t){return this.homeMapData.map[t].gridType},t.prototype.setHomeMapData=function(t,e){this.homeMapData.map[t].gridType=e},t.instance=null,t}();__reflect(PlacingController.prototype,"PlacingController");var AlertPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(AlertPop.prototype,"AlertPop");var BackGround=function(t){function e(){var e=t.call(this)||this;return e.targetPos=[-150,-150,-150,-150,-150],e.bgColor=0,e.touchTimes=0,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=this;this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("bg_png"),this.bg.width=AdaptSceenUtil.curWidth(),this.bg.height=AdaptSceenUtil.curHeight(),DrawUtil.setImageColor(this.bg,ColorEnum.colorOrder[Math.floor(Math.random()*ColorEnum.colorOrder.length)]),this.addChild(this.bg),this.bg_mask=new egret.Bitmap,this.bg_mask.texture=RES.getRes("bg_mask_png"),this.bg_mask.width=AdaptSceenUtil.curWidth(),this.bg_mask.height=AdaptSceenUtil.curHeight(),this.addChild(this.bg_mask),this.clouds=new egret.Sprite,this.addChild(this.clouds),egret.Ticker.getInstance().register(this.update,this);for(var e=1;3>=e;e++)this["cloud"+e]=new egret.Bitmap,this["cloud"+e].texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this["cloud"+e].y=1*AdaptSceenUtil.curHeight()/5+Math.random()*AdaptSceenUtil.curHeight()*1/6,this["cloud"+e].x=Math.random()*AdaptSceenUtil.curWidth()+AdaptSceenUtil.curWidth()*e,this["cloud"+e].scaleX=this["cloud"+e].scaleY=2*this["cloud"+e].y/AdaptSceenUtil.curHeight(),this.targetPos[e-1]=-150-Math.random()*AdaptSceenUtil.curWidth(),this["cloud"+e].alpha=.6,this.clouds.addChild(this["cloud"+e]);for(var e=4;5>=e;e++)this["cloud"+e]=new egret.Bitmap,this["cloud"+e].texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this["cloud"+e].y=1*AdaptSceenUtil.curHeight()/3+Math.random()*AdaptSceenUtil.curHeight()*1/3,this["cloud"+e].x=Math.random()*AdaptSceenUtil.curWidth()+AdaptSceenUtil.curWidth()*(e-3),this["cloud"+e].scaleX=this["cloud"+e].scaleY=2*this["cloud"+e].y/AdaptSceenUtil.curHeight(),this.targetPos[e-1]=-150-Math.random()*AdaptSceenUtil.curWidth(),this["cloud"+e].alpha=.6,SceneManager.getInstance().getEffectLayer().addChild(this["cloud"+e]);egret.Tween.get(this.bg,{loop:!0}).wait(2*GameConst.MINUTE).call(function(){var e=ColorEnum.colorOrder[t.bgColor];t.bgColor++,t.bgColor===ColorEnum.colorOrder.length&&(t.bgColor=0);var i=ColorEnum.colorOrder[t.bgColor];DrawUtil.colorTween(t.bg,e,i)}),this.cloud5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cloud5Touched,this)},e.prototype.cloud5Touched=function(t){var e=this;0===this.touchTimes&&egret.setTimeout(function(){e.touchTimes>4&&console.log("hello")},this,2e3),this.touchTimes++},e.prototype.update=function(t){this.cloud1.x<this.targetPos[0]?(this.cloud1.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this.cloud1.x=Math.random()*AdaptSceenUtil.curWidth()+AdaptSceenUtil.curWidth(),this.cloud1.y=1*AdaptSceenUtil.curHeight()/5+Math.random()*AdaptSceenUtil.curHeight()*1/4,this.cloud1.scaleX=this.cloud1.scaleY=2*this.cloud1.y/AdaptSceenUtil.curHeight()+.1,this.targetPos[0]=-150,this.cloud1.y<this.cloud2.y&&this.clouds.setChildIndex(this.cloud1,this.clouds.getChildIndex(this.cloud2)),this.cloud1.y<this.cloud3.y&&this.clouds.setChildIndex(this.cloud1,this.clouds.getChildIndex(this.cloud3))):this.cloud1.x-=this.cloud1.y/AdaptSceenUtil.curHeight(),this.cloud2.x<this.targetPos[1]?(this.cloud2.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this.cloud2.x=Math.random()*AdaptSceenUtil.curWidth()*2+AdaptSceenUtil.curWidth(),this.cloud2.y=1*AdaptSceenUtil.curHeight()/5+Math.random()*AdaptSceenUtil.curHeight()*1/4,this.cloud2.scaleX=this.cloud2.scaleY=2*this.cloud2.y/AdaptSceenUtil.curHeight()+.1,this.targetPos[1]=-150,this.cloud2.y<this.cloud1.y&&this.clouds.setChildIndex(this.cloud2,this.clouds.getChildIndex(this.cloud1)),this.cloud2.y<this.cloud3.y&&this.clouds.setChildIndex(this.cloud2,this.clouds.getChildIndex(this.cloud3))):this.cloud2.x-=this.cloud2.y/AdaptSceenUtil.curHeight(),this.cloud3.x<this.targetPos[2]?(this.cloud3.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this.cloud3.x=Math.random()*AdaptSceenUtil.curWidth()*3+AdaptSceenUtil.curWidth(),this.cloud3.y=1*AdaptSceenUtil.curHeight()/5+Math.random()*AdaptSceenUtil.curHeight()*1/6,this.cloud3.scaleX=this.cloud3.scaleY=2*this.cloud3.y/AdaptSceenUtil.curHeight(),this.targetPos[2]=-150,this.cloud3.y<this.cloud2.y&&this.clouds.setChildIndex(this.cloud3,this.clouds.getChildIndex(this.cloud2)),this.cloud3.y<this.cloud1.y&&this.clouds.setChildIndex(this.cloud3,this.clouds.getChildIndex(this.cloud1))):this.cloud3.x-=this.cloud3.y/AdaptSceenUtil.curHeight(),this.cloud4.x<this.targetPos[2]?(this.cloud4.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this.cloud4.x=Math.random()*AdaptSceenUtil.curWidth()*3+AdaptSceenUtil.curWidth(),this.cloud4.y=1*AdaptSceenUtil.curHeight()/3+Math.random()*AdaptSceenUtil.curHeight()*1/3,this.cloud4.scaleX=this.cloud4.scaleY=2*this.cloud4.y/AdaptSceenUtil.curHeight(),this.targetPos[2]=-150,this.cloud4.y<this.cloud5.y&&SceneManager.getInstance().getEffectLayer().setChildIndex(this.cloud4,SceneManager.getInstance().getEffectLayer().getChildIndex(this.cloud5))):this.cloud4.x-=this.cloud4.y/AdaptSceenUtil.curHeight(),this.cloud5.x<this.targetPos[2]?(this.cloud5.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),this.cloud5.x=Math.random()*AdaptSceenUtil.curWidth()*3+AdaptSceenUtil.curWidth(),this.cloud5.y=1*AdaptSceenUtil.curHeight()/3+Math.random()*AdaptSceenUtil.curHeight()*1/3,this.cloud5.scaleX=this.cloud5.scaleY=2*this.cloud5.y/AdaptSceenUtil.curHeight(),this.targetPos[2]=-150,this.cloud5.y<this.cloud4.y&&SceneManager.getInstance().getEffectLayer().setChildIndex(this.cloud5,SceneManager.getInstance().getEffectLayer().getChildIndex(this.cloud4))):this.cloud5.x-=this.cloud5.y/AdaptSceenUtil.curHeight()},e}(egret.Sprite);__reflect(BackGround.prototype,"BackGround");var FlippyTip=function(t){function e(e){var i=t.call(this)||this;return i.contentText=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Bitmap;t.texture=RES.getRes("tip_bg_png"),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,this.addChild(t);var e=DrawUtil.textFilter(this.contentText);this.addChild(e)},e}(egret.Sprite);__reflect(FlippyTip.prototype,"FlippyTip");var GoldFrame=function(t){function e(e){var i=t.call(this)||this;return i._amount=0,i.targetNumber=0,i._type=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.scrolling=!1,this.frameBg=new egret.Bitmap,this.frameBg.texture=RES.getRes("frame_png"),this.frameBg.x=0,this.frameBg.y=0,this.addChild(this.frameBg),this.goldIcon=new egret.Bitmap,this.goldIcon.texture=RES.getRes(this._type+"_png"),this.goldIcon.x=0,this.goldIcon.y=0,this.addChild(this.goldIcon),this.amountText=new egret.TextField,this.amountText.text="0",this.amountText.x=this.goldIcon.width,this.amountText.textAlign=egret.HorizontalAlign.RIGHT,this.amountText.y=10,this.amountText.width=110,this.addChild(this.amountText)},Object.defineProperty(e.prototype,"amount",{set:function(t){this.scrolling===!1&&(this.targetNumber=t,this.scrolling=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.scrollToAmount,this))},enumerable:!0,configurable:!0}),e.prototype.scrollToAmount=function(t){this._amount<this.targetNumber&&this.scrolling===!0?(this._amount+=3333,this.updateView()):(this.removeEventListener(egret.Event.ENTER_FRAME,this.scrollToAmount,this),this._amount=this.targetNumber,this.scrolling=!1,this.updateView())},e.prototype.updateView=function(){"gold"===this._type?this.amountText.text=NumUtil.numberToString(this._amount):"gas"===this._type&&(this.amountText.text=(this._amount<CityController.getInstance().getGasStationMax()?this._amount:CityController.getInstance().getGasStationMax())+"/"+CityController.getInstance().getGasStationMax())},e}(egret.Sprite);__reflect(GoldFrame.prototype,"GoldFrame");var HeadUI=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.goldHead=new GoldFrame("gold"),this.goldHead.x=80,this.goldHead.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.goldHead),this.gasHead=new GoldFrame("gas"),this.gasHead.x=272,this.gasHead.y=32+AdaptSceenUtil.y_fix()/2,this.gasHead.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.addChild(this.gasHead)},e.prototype.onTouch=function(){console.log("观看视频")},Object.defineProperty(e.prototype,"GoldHead",{get:function(){return this.goldHead},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GasHead",{get:function(){return this.gasHead},enumerable:!0,configurable:!0}),e.prototype.setGold=function(t){this.goldHead.amount=t},e.prototype.setGas=function(t){this.gasHead.amount=Math.floor(t)},e}(egret.Sprite);__reflect(HeadUI.prototype,"HeadUI");var PlayerHandleController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.playerTouchedGameView=function(t){GameController.getInstance().isHitGaming()?GameController.getInstance().isAttackPhase&&(RecordController.getInstance().isGridOpen(t)?SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_already_hit_this_place")):GameController.getInstance().hitGrid(t,BulletController.getInstance().useBullet())):GameController.getInstance().isDoubleHitting()||(GameController.getInstance().isPlacing()?SceneManager.getInstance().placingScene.rotationPlane(t):GameController.getInstance().isGuiding()&&GuideController.getInstance().hitGridGuide(t))},t.prototype.playerBeginMoveInGameView=function(t,e){GameController.getInstance().isHitGaming()&&GameController.getInstance().isAttackPhase?this.headGridId=t:GameController.getInstance().isPlacing()&&SceneManager.getInstance().placingScene.selectOneGrid(t)},t.prototype.playerMovingInGameView=function(t,e){GameController.getInstance().isHitGaming()&&GameController.getInstance().isAttackPhase||GameController.getInstance().isPlacing()&&SceneManager.getInstance().placingScene.movingOnePlane(t,e)},t.prototype.playerReleaseOnGameView=function(t,e){GameController.getInstance().isHitGaming()||GameController.getInstance().isPlacing()&&SceneManager.getInstance().placingScene.releaseOnePlane(t,e)},t.instance=null,t}();__reflect(PlayerHandleController.prototype,"PlayerHandleController");var PanelBase=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Bitmap;t.texture=RES.getRes("panel_png"),this.addChild(t)},e.prototype.updateView=function(){},e}(egret.DisplayObjectContainer);__reflect(PanelBase.prototype,"PanelBase");var MiniGameView=function(t){function e(e){var i=t.call(this)||this;return i.headData=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.mapData=new MapData,[4,this.initData()];case 1:return t.sent(),this.gameView=new GameView(!0,this.mapData.map,!1),this.gameView.anchorOffsetX=this.gameView.width/2,this.gameView.anchorOffsetY=this.gameView.height/2,this.gameView.scaleX=160/630,this.gameView.scaleY=160/630,this.gameView.x=this.bg.width/2,this.gameView.y=this.bg.height/2-5,this.addChild(this.gameView),this.gameView.touchEnabled=!1,this.gameView.touchChildren=!1,this.gameView.cacheAsBitmap=!0,[2]}})})},e.prototype.initData=function(){for(var t=0;t<this.headData.length;t++)this.mapData.setPlaneGridByHead(this.headData[t].head,this.headData[t].direction)},e.prototype.updateData=function(){},e}(egret.Sprite);__reflect(MiniGameView.prototype,"MiniGameView");var PlacingControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.HISTORY_STATUS=1,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.controlViewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.controlViewBg),this.historyButton=new E8TextButton(this,RES.getRes("btn_yellow_png"),this.onHistoryButtonTouched),this.historyButton.touchEnabled=!0,this.historyButton.scale(.8,.5),this.historyButton.x=AdaptSceenUtil.curWidth()-3*this.historyButton.width-30,this.historyButton.y=200,this.historyButton.setButtonText("分享历史"),this.addChild(this.historyButton),this.shareButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.shareButtonTouched),this.shareButton.touchEnabled=!0,this.shareButton.scale(.8,.5),this.shareButton.x=AdaptSceenUtil.curWidth()-2*this.historyButton.width-20,this.shareButton.y=200,this.shareButton.setButtonText("分享此地图"),this.addChild(this.shareButton),this.randomButton=new E8TextButton(this,RES.getRes("btn_purple_png"),this.onRandomButtonTouched),this.randomButton.touchEnabled=!0,this.randomButton.scale(.5,.5),this.randomButton.x=AdaptSceenUtil.curWidth()-this.randomButton.width-10,this.randomButton.y=200,this.randomButton.setButtonText("随机"),this.addChild(this.randomButton),this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text="我的飞机图",this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=this.backButton.height/2,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.mapController=new egret.Sprite,this.mapList=new Array;for(var t,e=SaveDataManager.getInstance().getUserData().getSharedMap(),i=0;i<e.length;i++)t=new MiniGameView([]),t.x=200*i,this.mapController.addChild(t),this.mapList.push(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mapTouched,this);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.mapController),this.addChild(this.scrollView),this.newMapButton=new E8Button(this,RES.getRes("new_map"),this.onRandomButtonTouched),this.newMapButton.x=this.newMapButton.width/2,this.newMapButton.y=this.controlViewBg.height-this.newMapButton.height/2,this.addChild(this.newMapButton),this.updateView()},e.prototype.mapTouched=function(t){var e=t.target;PlacingController.getInstance().selectedSharedMap(e)},e.prototype.updateView=function(){this.status===this.HISTORY_STATUS?(this.shareButton.visible=!1,this.randomButton.visible=!1,this.historyButton.visible=!1,this.scrollView.visible=!0,this.newMapButton.visible=!0,this.backButton.visible=!0):(this.shareButton.visible=!0,this.randomButton.visible=!0,this.historyButton.visible=!0,this.scrollView.visible=!1,this.newMapButton.visible=!1,this.backButton.visible=!1)},e.prototype.shareButtonTouched=function(){PlacingController.getInstance().shareMap()},e.prototype.onRandomButtonTouched=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return SceneManager.getInstance().placingScene.resetView(),PlacingController.getInstance().randomMap(),[2]})})},e.prototype.onHistoryButtonTouched=function(){this.status=this.HISTORY_STATUS,this.updateView()},e.prototype.onBackButtonTouched=function(){this.status===this.HISTORY_STATUS&&(this.status=this.INIT_STATUS,this.updateView())},e}(egret.Sprite);__reflect(PlacingControlView.prototype,"PlacingControlView");var PlacingGridView=function(t){function e(e){var i=t.call(this,e)||this;return i._bodyType=BodyGridEnum.UNSET,i._direction=DirectionTypeEnum.UNSET,i._planeIndex=0,i.helpView=new egret.Bitmap,i.helpView.width=60,i.helpView.height=60,i.helpView.texture=RES.getRes("help_png"),i.addChild(i.helpView),i}return __extends(e,t),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),e.prototype.getPlaneIndex=function(){return this._planeIndex},Object.defineProperty(e.prototype,"bodyType",{get:function(){return this._bodyType},enumerable:!0,configurable:!0}),e.prototype.updateView=function(){this._type===GridTypeEnum.HEAD?this.gridView.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[this._direction]+"_H"):this._type===GridTypeEnum.BODY?this.gridView.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[this._direction]+"_"+this._bodyType):this.gridView.texture=null},e.prototype.resetView=function(){this._planeIndex=0,this._type=GridTypeEnum.MISS,this._bodyType=BodyGridEnum.UNSET,this._direction=DirectionTypeEnum.UNSET,this.gridView.texture=null,this.updateView()},e.prototype.setPlane=function(t,e,i,n){this._planeIndex=t,this._direction=n,this._bodyType=i,this._type=e,this.updateView()},Object.defineProperty(e.prototype,"selected",{set:function(t){t?DrawUtil.setImageColor(this.gridView,8947848):DrawUtil.setImageColor(this.gridView,16777215)},enumerable:!0,configurable:!0}),e.prototype.setPlaneEnable=function(t){void 0===t&&(t=!0),t?DrawUtil.setImageColor(this.gridView,65280):DrawUtil.setImageColor(this.gridView,16711680)},e.prototype.setNoPlaneLanding=function(){DrawUtil.setImageColor(this.gridView,16777215)},e}(GridView);__reflect(PlacingGridView.prototype,"PlacingGridView");var PlacingMsgView=function(t){function e(){var e=t.call(this)||this;return e.msgKey=["playerName","排名","城镇积分","可掠夺金币","被进攻次数","S率","摧毁炮数"],e.msgValue=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.addChild(this.viewBg),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer),this.updateView()},e.prototype.updateView=function(t){if(void 0===t&&(t=0),this.msgContainer.removeChildren(),0===t);else{var e=void 0,i=void 0;this.msgKey[0]="韩闯",this.msgValue=[t.toString()+"级",Math.floor(Math.random()*Math.pow(10,8-t)),Math.floor(100*t*Math.random()),10*Math.floor(100*t*Math.random()),Math.floor(100*t*Math.random()),(40+20*Math.random()).toFixed(2)+"%",Math.floor(11*Math.random())+8];for(var n=0;n<this.msgKey.length;n++)e=new egret.TextField,e.text=this.msgKey[n]+":",e.x=20+Math.floor(n%2)*AdaptSceenUtil.curWidth()/2,e.y=10+Math.floor(n/2)*e.height,i=e.width,this.msgContainer.addChild(e),e=new egret.TextField,e.text=this.msgValue[n],e.x=i+20+Math.floor(n%2)*AdaptSceenUtil.curWidth()/2,e.y=10+Math.floor(n/2)*e.height,this.msgContainer.addChild(e)}},e.prototype.getPlayerData=function(t){return-1!==t.indexOf("msg")?this.opponentData[t]:t},e}(egret.Sprite);__reflect(PlacingMsgView.prototype,"PlacingMsgView");var PlacingScene=function(t){function e(){var e=t.call(this)||this;return e.amount=0,e.draggingGridId=-1,e.currentDraggingGridId=-1,e.current_selected=0,e.dragging=!1,e.planeList=[],e.selectedHead=-1,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Bitmap;t.texture=RES.getRes("bg_png"),t.width=AdaptSceenUtil.curWidth(),t.height=AdaptSceenUtil.curHeight(),DrawUtil.setImageColor(t,ColorEnum.NATTIER_BLUE),this.addChild(t),this.msgView=new PlacingMsgView,this.msgView.anchorOffsetX=this.msgView.width/2,this.msgView.x=AdaptSceenUtil.curWidth()/2,this.msgView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.msgView),this.gameView=new GameView(!0),this.addChild(this.gameView),this.drag_plane=new PlaneView,this.drag_plane.visible=!1,this.addChild(this.drag_plane),this.controlView=new PlacingControlView,this.controlView.x=0,this.controlView.visible=!1,this.controlView.y=AdaptSceenUtil.curHeight()-this.controlView.height,SceneManager.getInstance().getUILayer().addChild(this.controlView),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10+this.backButton.width/2,this.backButton.y=32+AdaptSceenUtil.y_fix()/2+this.backButton.height/2,this.addChild(this.backButton),this.gameView.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOut,this)},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toCityScene()},e.prototype.resetView=function(){this.amount=0,this.gameView.resetView()},e.prototype.inAnimate=function(){this.controlView.visible=!0,this.visible=!0},e.prototype.outAnimate=function(){this.controlView.visible=!1,this.visible=!1},e.prototype.addOnePlane=function(t,e,i){this.gameView.gridList[e].setPlane(t,GridTypeEnum.HEAD,BodyGridEnum.UNSET,i);for(var n=DirectionTypeEnum.getGridByDirection(i),r=0;r<n.length;r++)this.gameView.gridList[e+n[r]].setPlane(t,GridTypeEnum.BODY,r,i);this.planeList.push({head:e,direction:i})},e.prototype.removeOnePlane=function(t){var e=this.gameView.gridList[t],i=e.direction;e.setPlane(0,GridTypeEnum.MISS,BodyGridEnum.UNSET,DirectionTypeEnum.UNSET);for(var n=DirectionTypeEnum.getGridByDirection(i),r=0;r<n.length;r++)this.gameView.gridList[t+n[r]].setPlane(0,GridTypeEnum.MISS,BodyGridEnum.UNSET,DirectionTypeEnum.UNSET);this.removeHeadFromList(t)},e.prototype.removeHeadFromList=function(t){for(var e=0;e<this.planeList.length;e++)if(this.planeList[e].head===t){this.planeList.splice(e,1);break}},e.prototype.selectOneGrid=function(t){var e=this.gameView.gridList[t];e.type===GridTypeEnum.MISS?0!==this.current_selected&&this.cancelSelected():e.type===GridTypeEnum.BODY?this.current_selected===e.getPlaneIndex()?this.cancelSelected():(0!==this.current_selected&&this.cancelSelected(),this.selectOnePlane(t)):e.type===GridTypeEnum.HEAD&&(this.current_selected===e.getPlaneIndex()?this.cancelSelected():(0!==this.current_selected&&this.cancelSelected(),this.selectOnePlane(t)))},e.prototype.cancelSelected=function(){if(0!==this.current_selected){var t=this.planeList[this.current_selected-1],e=t.head,i=t.direction,n=DirectionTypeEnum.getGridByDirection(i);this.gameView.gridList[e].selected=!1;for(var r=0;r<n.length;r++)this.gameView.gridList[e+n[r]].selected=!1;this.dragging=!1,this.currentDraggingGridId=-1,this.current_selected=0}},e.prototype.selectOnePlane=function(t){this.dragging=!0,this.draggingGridId=t;var e,i,n=this.gameView.gridList[t],r=n.direction,o=DirectionTypeEnum.getGridByDirection(r);n.type===GridTypeEnum.BODY?(e=n.bodyType,i=t-o[e]):i=t,this.gameView.gridList[i].selected=!0;for(var s=0;s<o.length;s++)this.gameView.gridList[i+o[s]].selected=!0;this.current_selected=n.getPlaneIndex(),this.selectedHead=i},e.prototype.releaseOnePlane=function(t,e){if(this.dragging&&this.currentDraggingGridId!==t){var i,n,r=this.gameView.gridList[this.draggingGridId],o=r.direction,s=DirectionTypeEnum.getGridByDirection(o);r.type===GridTypeEnum.BODY?(i=r.bodyType,n=t-s[i]):n=t,this.checkValid(n,o)?(this.removeOnePlane(this.selectedHead),this.addOnePlane(this.current_selected,n,o),this.cancelSelected(),this.gameView.updateView(),this.drag_plane.clearView()):this.cancelSelected(),this.drag_plane.visible=!1;for(var a=0;a<this.gameView.gridList.length;a++){var l=this.gameView.gridList[a];l.setNoPlaneLanding()}}},e.prototype.checkValid=function(t,e){var i=!1,n=this.gameView.gridList[t];if(!MapUtil.checkHeadAndDirection(t,e))return!1;if(0!==n.getPlaneIndex()&&n.getPlaneIndex()!==this.current_selected)return i;var r=DirectionTypeEnum.getGridByDirection(e);if(0===r.length)return!1;for(var o=0;o<r.length;o++){var s=this.gameView.gridList[t+r[o]];if(0!==s.getPlaneIndex()&&s.getPlaneIndex()!==this.current_selected)return i}return i=!0},e.prototype.movingOnePlane=function(t,e){if(this.dragging&&this.currentDraggingGridId!==t&&(this.drag_plane.visible||(this.drag_plane.visible=!0,this.drag_plane.setView(t),this.contains(this.drag_plane)||this.addChild(this.drag_plane)),this.drag_plane.x=e.stageX,this.drag_plane.y=e.stageY,this.draggingGridId!==t)){var i,n=this.gameView.gridList[this.draggingGridId],r=void 0,o=n.direction,s=DirectionTypeEnum.getGridByDirection(o),a=DirectionTypeEnum.getRowFromHeadByDirection(o);n.type===GridTypeEnum.BODY?(r=n.bodyType,i=t-s[r]):i=t;var l=[];l.push(i),s.forEach(function(t){l.push(t+i)});for(var h=0;h<this.gameView.gridList.length;h++){var u=this.gameView.gridList[h].id,c=this.gameView.gridList[u];-1!==l.indexOf(u)&&c.type!==GridTypeEnum.MISS&&a[l.indexOf(u)]+a[l.indexOf(t)]===MapUtil.getYOffset(i,u)+MapUtil.getYOffset(i,t)?c.getPlaneIndex()!==this.current_selected?c.setPlaneEnable(!1):c.setPlaneEnable(!0):c.setNoPlaneLanding()}}},e.prototype.rotationPlane=function(t){var e=this.gameView.gridList[t];if(e.type!==GridTypeEnum.MISS){this.current_selected=e.getPlaneIndex();var i,n,r=e.direction,o=DirectionTypeEnum.getGridByDirection(r);e.type===GridTypeEnum.BODY?(i=e.bodyType,n=t-o[i]):n=t;for(var s=MapUtil.rotationPlane(n,r),a=!1;s.direction!==r;){if(this.checkValid(s.head,s.direction)){var l=e.getPlaneIndex();this.removeOnePlane(n),this.addOnePlane(l,s.head,s.direction),a=!0;break}s=MapUtil.rotationPlane(s.head,s.direction)}a||SceneManager.getInstance().showTip(i18n.getInstance().getLanguage("tip_this_place_cant_rotation")),this.cancelSelected()}},e.prototype.releaseOut=function(t){this.releaseOnePlane(this.draggingGridId,t)},e.prototype.getPlane=function(t){return[]},e.prototype.getDraggingRealHead=function(){return this.selectedHead},Object.defineProperty(e.prototype,"planeAmount",{set:function(t){this.amount=t},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(PlacingScene.prototype,"PlacingScene",["Scene"]);var PlaneGrid=function(){function t(){}return t}();__reflect(PlaneGrid.prototype,"PlaneGrid");var PlaneView=function(t){function e(){var e=t.call(this)||this;return e.gridViewList=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.grid_sheet=RES.getRes("plane_sheet"),this.drag_index=0;for(var t,e=0;10>e;e++)t=new egret.Bitmap,this.gridViewList.push(t),this.addChild(t)},e.prototype.clearView=function(){},e.prototype.setView=function(t){var e=SceneManager.getInstance().placingScene.gameView,i=e.gridList[t];this.drag_index=i.getPlaneIndex();var n,r,o=i.direction,s=DirectionTypeEnum.getGridByDirection(o);i.type===GridTypeEnum.HEAD?r=t:(n=i.bodyType,r=t-s[n]),this.addGrid(o,"_H",t,r);for(var a=0;a<s.length;a++)this.addGrid(o,"_"+a,t,e.gridList[r+s[a]].id)},e.prototype.addGrid=function(t,e,i,n){var r=this.gridViewList.shift();r.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[t]+e),r.x=-30+60*MapUtil.getXOffset(i,n),r.y=-30+60*MapUtil.getYOffset(i,n),this.gridViewList.push(r)},e.prototype.getIndex=function(){return this.drag_index},e}(egret.Sprite);__reflect(PlaneView.prototype,"PlaneView");var StoreCardView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){if(this.gameView=new GameView(!0),this.heads=this.data.heads,3!==this.heads.length)console.log("头信息错误");else for(var t=0;t<this.heads.length;t++)this.addOnePlane(this.heads[t].head,this.heads[t].direction)},e.prototype.addOnePlane=function(t,e){},e}(egret.Sprite);__reflect(StoreCardView.prototype,"StoreCardView");var Report=function(t){function e(){return t.call(this)||this
}return __extends(e,t),e}(egret.Sprite);__reflect(Report.prototype,"Report");var ResultScene=function(t){function e(){var e=t.call(this)||this;e.reporting=!1,e.report_bullet=0;var i=new egret.Bitmap;return i.texture=RES.getRes("bg_png"),i.width=AdaptSceenUtil.curWidth(),i.height=AdaptSceenUtil.curHeight(),DrawUtil.setImageColor(i,ColorEnum.NATTIER_BLUE),e.addChild(i),e.title=new egret.Bitmap,e.title.y=100,e.addChild(e.title),e.score=new egret.Bitmap,e.score.y=e.title.y+e.title.height+50,e.addChild(e.score),e.bullet_animate=new egret.MovieClip,e.backButton=new E8Button(e,RES.getRes("back_png"),e.onBackButtonTouched),e.backButton.touchEnabled=!0,e.backButton.x=-10+e.backButton.width/2,e.backButton.y=32+AdaptSceenUtil.y_fix()/2+e.backButton.height/2,e.addChild(e.backButton),e.reward_control=new RewardControlView,e.reward_control.width=AdaptSceenUtil.curWidth(),e.reward_control.x=0,e.reward_control.y=AdaptSceenUtil.curHeight()-e.reward_control.height,e.reward_control.visible=!1,e.addChild(e.reward_control),e.review_panel=new E8Panel(e,RES.getRes("panel_png"),null),e.review_panel.width=.5*AdaptSceenUtil.curWidth(),e.review_panel.height=.5*AdaptSceenUtil.curHeight(),e.review_panel.x=AdaptSceenUtil.curWidth()/2,e.review_panel.y=AdaptSceenUtil.curHeight()/2,e.review_panel.visible=!1,e.addChild(e.review_panel),e.gameView=new GameView(!1),e.gameView.visible=!1,e.addChild(e.gameView),e.review_button=new E8TextButton(e,RES.getRes("btn_green_png"),e.reviewButtonTouched),e.review_button.scale(.5,.5),e.review_button.setButtonText("本局回顾"),e.review_button.touchEnabled=!0,e.review_button.x=AdaptSceenUtil.curWidth()/2-40,e.review_button.y=AdaptSceenUtil.curHeight()/2+100,e.addChild(e.review_button),e.shareButton=new E8TextButton(e,RES.getRes("btn_red_png"),e.shareButtonTouched),e.shareButton.scale(.5,.5),e.shareButton.setButtonText("分享此地图"),e.shareButton.touchEnabled=!0,e.shareButton.x=AdaptSceenUtil.curWidth()/2-240,e.shareButton.y=AdaptSceenUtil.curHeight()/2+100,e.addChild(e.shareButton),e.next_button=new E8TextButton(e,RES.getRes("btn_blue_png"),e.nextButtonTouched),e.next_button.scale(.5,.5),e.next_button.setButtonText(i18n.getInstance().getLanguage("ui_next_bullet")),e.next_button.touchEnabled=!0,e.next_button.x=AdaptSceenUtil.curWidth()/2+140,e.next_button.y=AdaptSceenUtil.curHeight()/2+300,e.next_button.visible=!1,e.addChild(e.next_button),e}return __extends(e,t),e.prototype.reviewButtonTouched=function(){this.reporting=!0,this.gameView.visible=!0,this.next_button.visible=!0,this.review_panel.visible=!1},e.prototype.hideReview=function(){this.reporting=!1,this.gameView.visible=!1,this.next_button.visible=!1,this.review_panel.visible=!1},e.prototype.nextButtonTouched=function(){if(0!==RecordController.getInstance().getEachGridOpenRecord(this.report_bullet).length){console.log(this.report_bullet),console.log(RecordController.getInstance().getEachGridOpenRecord(this.report_bullet));for(var t=0;t<RecordController.getInstance().getEachGridOpenRecord(this.report_bullet).length;t++){var e=RecordController.getInstance().getEachGridOpenRecord(this.report_bullet)[t],i=RecordController.getInstance().recordedMap[e];this.showGridView(e,i.gridType)}this.report_bullet++}},e.prototype.showGridView=function(t,e,i){void 0===i&&(i=GridStatusEnum.SHOW),this.gameView.gridList[t].status=i,this.gameView.gridList[t].type=e},e.prototype.shareButtonTouched=function(){platform.share("欢迎来打飞机","","",this.onShared,RecordController.getInstance().heads,"")},e.prototype.onShared=function(){GameController.getInstance().addGas(SaveDataManager.getInstance().getUserData().gas)},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toCityScene()},e.prototype.showResult=function(t,e){switch(void 0===t&&(t=ResultTypeEnum.WIN),void 0===e&&(e=ScoreTypeEnum.NO_SCORE),t===ResultTypeEnum.WIN?this.title.texture=RES.getRes("win_png"):t===ResultTypeEnum.FAIL?this.title.texture=RES.getRes("fail_png"):t===ResultTypeEnum.GIVE_UP&&(this.title.texture=RES.getRes("give_up_png")),this.title.x=AdaptSceenUtil.curWidth()/2-this.title.width/2,e){case ScoreTypeEnum.SSS:this.score.texture=RES.getRes("sss_png");break;case ScoreTypeEnum.S:this.score.texture=RES.getRes("s_png");break;case ScoreTypeEnum.A:this.score.texture=RES.getRes("a_png");break;case ScoreTypeEnum.B:this.score.texture=RES.getRes("b_png");break;case ScoreTypeEnum.C:this.score.texture=RES.getRes("c_png")}this.score.x=AdaptSceenUtil.curWidth()/2-this.score.width/2},e.prototype.inAnimate=function(){this.reward_control.visible=!0,this.hideReview(),this.visible=!0},e.prototype.outAnimate=function(){this.reward_control.visible=!1,this.gameView.resetView(),this.visible=!1},e}(egret.Sprite);__reflect(ResultScene.prototype,"ResultScene");var RewardCardView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg)},e}(egret.Sprite);__reflect(RewardCardView.prototype,"RewardCardView");var RewardControlView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.addChild(this.controlViewBg),this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text="获得奖励",this.addChild(this.titleTextField),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.rewardList=new Array;for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView)},e.prototype.updateView=function(){},e}(egret.Sprite);__reflect(RewardControlView.prototype,"RewardControlView");