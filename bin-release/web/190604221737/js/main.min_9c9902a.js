var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{l(n.next(t))}catch(e){o(e)}}function a(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},E8Button=function(t){function e(e,i,n){void 0===n&&(n=null);var r=t.call(this)||this;return r.param={context:null,data:null},r.isPlayCartoon=!1,r.param.context=e,r.backFun=n,r.btnImg=new egret.Bitmap,r.btnImg.texture=i,r.btnImg.anchorOffsetX=r.width/2,r.btnImg.anchorOffsetY=r.height/2,r.btnImg.touchEnabled=!0,r.addChild(r.btnImg),r.btnImg.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTouchTap,r),r}return __extends(e,t),e.prototype.changeTexture=function(t){this.btnImg.texture=t},e.prototype.onTouchTap=function(t){if(this.cartoonType=1,!this.isPlayCartoon){this.btnImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.isPlayCartoon=!0;var e=function(){this.isPlayCartoon=!1},i=function(){1==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},500,egret.Ease.elasticOut).call(e,this):2==this.cartoonType?egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},500,egret.Ease.backOut).call(e,this):3==this.cartoonType&&egret.Tween.get(this).to({scaleX:1,scaleY:1,x:this.x-this.btnImg.width/4,y:this.y-this.btnImg.height/4},100).call(e,this)};egret.Tween.get(this).to({scaleX:.5,scaleY:.5,x:this.x+this.btnImg.width/4,y:this.y+this.btnImg.height/4},100,egret.Ease.sineIn).call(i,this),console.log(this.param),egret.setTimeout(function(){null!=this.backFun&&(this.btnImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.backFun.apply(this.param.context,[this.param.data]))},this,300)}},e}(egret.DisplayObjectContainer);__reflect(E8Button.prototype,"E8Button");var AreaTypeEnum;!function(t){function e(t){for(var e=[],i=0;9>i;i++)e.push(t+i);return e}function i(t){for(var e=[],i=0;9>i;i++)e.push(t+9*i);return e}t.ONE_POINT=0,t.POINTS=1,t.ROW_OR_COL=2,t.POINT_EXPAND=3;var n=0,r=9,o=18,s=27,a=36,l=45,u=54,c=63,h=72;t.ROWS=[n,r,o,s,a,l,u,c,h];var d=0,p=1,g=2,y=3,f=4,w=5,_=6,m=7,T=8;t.COLS=[d,p,g,y,f,w,_,m,T],t.getOneRow=e,t.getOneCol=i}(AreaTypeEnum||(AreaTypeEnum={}));var DirectionTypeEnum;!function(t){function e(e){switch(e){case t.UP:return[9,18,7,8,10,11,26,28,27];case t.RIGHT:return[-1,-2,-19,-10,8,17,-12,6,-3];case t.DOWN:return[-9,-18,-7,-8,-10,-11,-26,-28,-27];case t.LEFT:return[1,2,19,10,-8,-17,12,-6,3];default:return console.log("direction error"),[]}}function i(e){switch(e){case t.UP:return[0,1,2,1,1,1,1,3,3,3];case t.RIGHT:return[0,0,0,-2,-1,1,2,-1,1,0];case t.DOWN:return[0,-1,-2,-1,-1,-1,-1,-3,-3,-3];case t.LEFT:return[0,0,0,2,1,-1,-2,1,-1,0];default:return console.log("direction error"),[]}}t.DIRECTION_LIST=[27,-3,-27,3],t.ERROR=-2,t.UNSET=-1,t.UP=0,t.RIGHT=1,t.DOWN=2,t.LEFT=3,t.UNCERTAIN=4,t.DIRECTION_LETTER=["U","R","D","L"],t.getGridByDirection=e,t.getRowFromHeadByDirection=i}(DirectionTypeEnum||(DirectionTypeEnum={}));var MapData=function(){function t(){this.columns=9,this.rows=9,this.numPlane=0,this._map=[],this.hasBadPlane=!1,this.headList=[],this.initialize()}return t.prototype.initialize=function(){this.numPlane=0,this._map.length=this.columns*this.rows;for(var t=0;t<this._map.length;t++)this._map[t]=new GridData(t),this._map[t].gridType=GridTypeEnum.MISS},t.prototype.clear=function(){this.numPlane=0;for(var t=0;t<this._map.length;t++)this._map[t].gridType=GridTypeEnum.MISS;this.headList=[]},t.prototype.getMapGridById=function(t){return this._map[t]},t.prototype.getMapGridByXY=function(t,e){return this._map[e*this.columns+t]},t.prototype.setMapGridTypeByPos=function(t,e,i){this._map[e*this.columns+t].gridType=i},t.prototype.setMapGridTypeByValue=function(t,e){this._map[t].gridType=e},t.prototype.setHeadDirection=function(t,e){this._map[t].direction=e},t.prototype.setBodyTypeByValue=function(t,e){this._map[t].bodyType=e},t.prototype.setDirection=function(t,e){this._map[t].direction=e},t.prototype.setGridIndex=function(t,e){this._map[t].index=e},t.prototype.checkValid=function(t,e,i){if(this.getMapGridByXY(t,e).gridType==GridTypeEnum.MISS){for(var n=e*this.columns+t,r=DirectionTypeEnum.getGridByDirection(i),o=0;o<r.length;o++)if(this._map[n+r[o]].gridType!=GridTypeEnum.MISS)return!1;return!0}return!1},t.prototype.checkForThreePlane=function(t,e,i){for(var n=this.columns*e+t,r=BadPlaceEnum.BAD_GRID_LIST,o=BadPlaceEnum.BAD_GRID_DIRECTION_LIST,s=r.length,a=0;s>a;a++){if(r[a]!=n||o[a]!=i)return egret.log("second time bad"),!0;for(var l=BadPlaceEnum.BAD_GRID_TEST_LIST[a],u=l.length,c=0;u>c;c++){var h=r[l[c]],d=o[l[c]];return this._map[h].gridType==GridTypeEnum.HEAD&&this._map[r[h]+DirectionTypeEnum.DIRECTION_LIST[d]].gridType==GridTypeEnum.BODY?(egret.log("twice bad"),!1):(egret.log("first time bad"),!0)}}},t.prototype.setPlaneGridByHead=function(t,e){return this.setPlaneGrid(t%9,Math.floor(t/9),e)},t.prototype.setPlaneGrid=function(t,e,i){if(!this.checkValid(t,e,i))return!1;if(1==this.numPlane&&!this.checkForThreePlane(t,e,i))return!1;var n=this.columns*e+t;this.setMapGridTypeByValue(n,GridTypeEnum.HEAD),this.setHeadDirection(n,i),this.setGridIndex(n,this.numPlane);for(var r=DirectionTypeEnum.getGridByDirection(i),o=0;o<r.length;o++)this.setMapGridTypeByValue(n+r[o],GridTypeEnum.BODY),this.setBodyTypeByValue(n+r[o],o),this.setDirection(n+r[o],i),this.setGridIndex(n+r[o],this.numPlane);return this.headList.push({head:n,direction:i}),!0},t.prototype.removePlane=function(t){var e=this._map[t].direction;this.setMapGridTypeByValue(t,GridTypeEnum.MISS),this.setHeadDirection(t,DirectionTypeEnum.UNSET);for(var i=DirectionTypeEnum.getGridByDirection(e),n=0;n<i.length;n++)this.setMapGridTypeByValue(t+i[n],GridTypeEnum.MISS),this.setBodyTypeByValue(t+i[n],BodyGridEnum.UNSET);this.removeHeadFromList(t)},t.prototype.removeHeadFromList=function(t){for(var e=0;e<this.headList.length;e++)(this.headList[e].head=t)&&this.headList.splice(e,1)},t.prototype.getHeadList=function(){return console.log(this.headList),this.headList},t.prototype.getPlaneGrid=function(){return this._map.filter(function(t){return t.gridType!==GridTypeEnum.MISS})},Object.defineProperty(t.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),t.prototype.getPlaneGridByIndex=function(t){return this._map.filter(function(e){return e.index===t})},t}();__reflect(MapData.prototype,"MapData");var BuildingBase=function(){function t(){this.id=BuildingEnum.UNSET,this.level=0,this.top=0,this.insure=[],this.protect=!1}return t}();__reflect(BuildingBase.prototype,"BuildingBase");var BuildingControlView=function(t){function e(){var e=t.call(this)||this;return e.buf=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.addChild(this.controlViewBg),this.levelUpButton=new E8TextButton(this,RES.getRes("btn_yellow_png"),this.levelUp),this.levelUpButton.x=AdaptSceenUtil.curWidth()-this.levelUpButton.width-20,this.levelUpButton.y=100,this.levelUpButton.setButtonText(i18n.getInstance().getLanguage("ui_level_up")),this.addChild(this.levelUpButton),this.demolishButton=new E8TextButton(this,RES.getRes("btn_red_png"),this.demolish),this.demolishButton.x=AdaptSceenUtil.curWidth()-2*this.levelUpButton.width-40,this.demolishButton.y=100,this.demolishButton.setButtonText(i18n.getInstance().getLanguage("ui_demolish")),this.addChild(this.demolishButton),this.repairButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.repair),this.repairButton.x=AdaptSceenUtil.curWidth()-3*this.levelUpButton.width-60,this.repairButton.y=100,this.repairButton.setButtonText(i18n.getInstance().getLanguage("ui_repair")),this.addChild(this.repairButton)},Object.defineProperty(e.prototype,"level",{set:function(t){this._level=t,5===this._level&&(this.levelUpButton.visible=!1)},enumerable:!0,configurable:!0}),e.prototype.levelUp=function(){CityController.getInstance().levelUpBuilding(),5===this._level&&(this.levelUpButton.visible=!1)},e.prototype.demolish=function(){CityController.getInstance().demolish()},e.prototype.repair=function(){CityController.getInstance().repairCity(this.position)},e}(egret.Sprite);__reflect(BuildingControlView.prototype,"BuildingControlView");var GridView=function(t){function e(e){var i=t.call(this)||this;return i._id=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.grid_sheet=RES.getRes("plane_sheet");var t;t=this._id%2==1?0:16777215;var e=new egret.Shape;e.graphics.beginFill(t,.2),e.graphics.drawRect(0,0,60,60),e.graphics.endFill(),this.addChild(e),this.gridView=new egret.Bitmap,this.gridView.width=60,this.gridView.height=60,this.addChild(this.gridView)},e.prototype.updateView=function(){},e.prototype.resetView=function(){},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t),0!==this._type,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touched",{get:function(){return this._touched},set:function(t){this._touched=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(GridView.prototype,"GridView");var Panel=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.panelBg=new egret.Bitmap,this.panelBg.texture=RES.getRes("panel_bg_png"),this.panelBg.anchorOffsetX=this.panelBg.width/2,this.panelBg.anchorOffsetY=this.panelBg.height/2,this.addChild(this.panelBg),this.closeButton=new E8Button(this,RES.getRes("close_btn_png"),this.closePanel),this.closeButton.x=this.panelBg.x+this.panelBg.width/2-this.closeButton.width,this.closeButton.y=this.panelBg.y-this.panelBg.height/2,this.closeButton.touchEnabled=!0,this.addChild(this.closeButton),this.touchChildren=!0},e.prototype.setContent=function(){},e.prototype.updateView=function(){},e.prototype.closePanel=function(t){this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Panel.prototype,"Panel");var RepairFactoryData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.REPAIR_FACTORY,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.repair_cost=e.missle,i}return __extends(e,t),e}(BuildingBase);__reflect(RepairFactoryData.prototype,"RepairFactoryData");var RankController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.randomRankData=function(){},t.instance=null,t}();__reflect(RankController.prototype,"RankController");var RecordController=function(){function t(){if(this.headRecored=[],this.hitRecorded=[],this.bulletRecorded=[],this.gridOpenRecorded=[],this.hittedPlane=[],this._continuousIndex=-1,this._continuousType=GridTypeEnum.UNSET,this._continuousTimes=0,this._missTimes=0,this._bodyTimes=0,this._headTimes=0,this._indexTimes=0,this._indexOneTimes=0,this._indexTwoTimes=0,this._indexThreeTimes=0,this._indexContinuousTimes=0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.prototype.reset=function(){this.hitRecorded=[],this.bulletRecorded=[],this.gridOpenRecorded=[],this.hittedPlane=[],this._continuousIndex=-1,this._continuousTimes=0,this._continuousType=GridTypeEnum.UNSET,this._missTimes=0,this._bodyTimes=0,this._headTimes=0,this._indexOneTimes=0,this._indexThreeTimes=0,this._indexTwoTimes=0,this._indexContinuousTimes=0},t.prototype.recordMap=function(t){this.map=t},t.prototype.recordGridOpen=function(t){ArrayUtil.add(this.gridOpenRecorded,t)},t.prototype.recordAction=function(t,e,i){return void 0===e&&(e=BulletTypeEnum.MISSILE),void 0===i&&(i=!0),this.hitRecorded.push(t.gridValue),this.bulletRecorded.push(e),-1!==t.index&&ArrayUtil.add(this.hittedPlane,t.index),-1===this.gridOpenRecorded.indexOf(t.index)&&this.isContinuous(t.index,t.gridType),t.gridType===GridTypeEnum.HEAD&&(ArrayUtil.add(this.headRecored,t),3===this.headRecored.length)?void GameController.getInstance().gameFinished(!0):t.gridType!==GridTypeEnum.HEAD&&this.bulletRecorded.length>=30?void GameController.getInstance().gameFinished(!1):void 0},t.prototype.isContinuous=function(t,e){var i=!1;return t===this._indexTimes&&(this._indexTimes++,i=!0),e===GridTypeEnum.MISS?(this._continuousType===e?(this._continuousTimes++,i=!0):(this._continuousType=GridTypeEnum.MISS,this._continuousTimes=1),this._missTimes++):e===GridTypeEnum.BODY&&(this._continuousType===GridTypeEnum.BODY?(this._continuousTimes++,i=!0):this._continuousType===GridTypeEnum.HEAD?(this._continuousTimes++,this._continuousType=GridTypeEnum.BODY,i=!0):(this._continuousType=GridTypeEnum.BODY,this._continuousTimes=1),this._bodyTimes++),e===GridTypeEnum.HEAD&&(this._continuousType===GridTypeEnum.HEAD?(this._continuousTimes++,i=!0):this._continuousType===GridTypeEnum.BODY?(this._continuousTimes++,this._continuousType=GridTypeEnum.HEAD,i=!0):(this._continuousType=GridTypeEnum.HEAD,this._continuousTimes=1),this._headTimes++),i},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"continuousType",{get:function(){return this._continuousType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"continuousTimes",{get:function(){return this._continuousTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"missTimes",{get:function(){return this._missTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bodyTimes",{get:function(){return this._bodyTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headTimes",{get:function(){return this._headTimes},enumerable:!0,configurable:!0}),t.prototype.getOneUnhitPlane=function(){return-1===this.hittedPlane.indexOf(0)?0:-1===this.hittedPlane.indexOf(1)?1:-1===this.hittedPlane.indexOf(2)?2:-1},t.prototype.getHitRecorded=function(){return this.hitRecorded},Object.defineProperty(t.prototype,"roundBullet",{get:function(){return this.bulletRecorded[this.bulletRecorded.length-1]},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(RecordController.prototype,"RecordController");var RewardController=function(){function t(){if(this.missRewardTimes=0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.reset=function(){this.missRewardTimes=0},t.prototype.continuousReward=function(){switch(RecordController.getInstance().continuousType){case GridTypeEnum.MISS:break;case GridTypeEnum.BODY:switch(RecordController.getInstance().continuousTimes){case RewardTitleEnum.KILLING_SPREE:GameController.getInstance().addGold(1e3);break;case RewardTitleEnum.MONSTER_KILL:GameController.getInstance().addGold(1e3)}}},t.prototype.hitReward=function(t){var e=t.filter(function(t){return t!==GridTypeEnum.MISS}).length;switch(e){case RewardTitleEnum.DOUBLE_KILL:GameController.getInstance().addGold(1e3);break;case RewardTitleEnum.TRIPLE_KILL:GameController.getInstance().addGold(1e3)}},t.prototype.isMissReward=function(){var t=RecordController.getInstance().missTimes;return Math.random()<.2*t-.5*this.missRewardTimes},t.prototype.missReward=function(){return 1200},t.prototype.doubleKill=function(){},t.prototype.tripleKill=function(){},t.prototype.tripleHit=function(){},t.instance=null,t}();__reflect(RewardController.prototype,"RewardController");var SettingController=function(){function t(){this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"SoundPlaying",{get:function(){if(void 0===this._soundPlaying){var t=SaveDataManager.getInstance().getSoundStatus();null===t||void 0===t||""===t||"1"===t?this.SoundPlaying=!0:this._soundPlaying="1"===t?!0:!1}return this._soundPlaying},set:function(t){this._soundPlaying=t,t?(SaveDataManager.getInstance().saveSoundStatus("1"),SoundManager.getInstance().playBGM(),SoundManager.getInstance().playSound(SoundEnum.SELECT_SOUND_MP3)):(SaveDataManager.getInstance().saveSoundStatus("0"),SoundManager.getInstance().stopBGM())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lang",{get:function(){if(void 0===this._lang){var t=SaveDataManager.getInstance().getLang();null===t||void 0===t||""===t?this._lang="zh_CN":this._lang=t}return this._lang},set:function(t){SaveDataManager.getInstance().setLang(t),this._lang=t},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(SettingController.prototype,"SettingController");var Circle=function(){function t(t,e){this.data=[],this.data=e,this._length=t}return t.prototype.getNext=function(t){var e=t-1;return console.log(this.data[this.fixToPositive(e+1)%this._length]),this.data[this.fixToPositive(e+1)%this._length]},t.prototype.getPrevious=function(t){var e=t-1;return console.log(this.data[this.fixToPositive(e-1)%this._length]),this.data[this.fixToPositive(e-1)%this._length]},t.prototype.getArrayData=function(){return this.data},t.prototype.getData=function(t){var e=t-1;return console.log(this.data[this.fixToPositive(e)%this._length]),this.data[this.fixToPositive(e)%this._length]},t.prototype.setData=function(t,e){var i=t-1;return this.data[this.fixToPositive(i)%this._length]=e,!0},Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.fixToPositive=function(t){return 0===this._length&&console.log("circle length error"),t>=0?t%this._length:this.fixToPositive(t+this._length)},t}();__reflect(Circle.prototype,"Circle");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){AdaptSceenUtil.curWidth()>=AdaptSceenUtil.displayWidth()&&AdaptSceenUtil.curHeight()>=AdaptSceenUtil.displayHeight()?(console.log("no_scale"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.NO_SCALE):AdaptSceenUtil.curWidth()/AdaptSceenUtil.curHeight()<AdaptSceenUtil.displayWidth()/AdaptSceenUtil.displayHeight()?(console.log("width"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH):(console.log("height"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT),egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.showLoading(),[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.showLoading=function(){},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,15,,16]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,RES.loadConfig("resource/loading.res.json","resource/")];case 2:return e.sent(),[4,RES.loadConfig("resource/config.res.json","resource/")];case 3:return e.sent(),[4,RES.loadConfig("resource/animate.res.json","resource/")];case 4:return e.sent(),[4,RES.loadConfig("resource/placing.res.json","resource/")];case 5:return e.sent(),[4,RES.loadConfig("resource/result.res.json","resource/")];case 6:return e.sent(),[4,RES.loadGroup("animate",0)];case 7:return e.sent(),[4,RES.loadGroup("config",0)];case 8:return e.sent(),[4,RES.loadGroup("placing_scene",0)];case 9:return e.sent(),[4,RES.loadGroup("scene",0)];case 10:return e.sent(),SceneManager.getInstance().init(this.stage),[4,RES.loadGroup("away_scene",0)];case 11:return e.sent(),[4,RES.loadGroup("city_scene",0)];case 12:return e.sent(),[4,RES.loadGroup("result_scene",0)];case 13:return e.sent(),[4,RES.loadGroup("preload",0)];case 14:return e.sent(),[3,16];case 15:return t=e.sent(),console.error(t),[3,16];case 16:return[2]}})})},e.prototype.createGameScene=function(){AIController.getInstance().calOffline(),BuildingDataCache.getInstance(),SceneManager.getInstance().initUIView(),SceneManager.getInstance().prepareScene(),GuideController.getInstance().isNew()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var E8TextButton=function(t){function e(e,i,n){return void 0===n&&(n=null),t.call(this,e,i,n)||this}return __extends(e,t),e.prototype.scale=function(t,e){var i=new egret.Rectangle(30,51,150,105);this.btnImg.scale9Grid=i,this.btnImg.scaleX=t,this.btnImg.scaleY=e},e.prototype.setButtonText=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=""),""!==i){var n=new egret.Bitmap;n.texture=RES.getRes(i),this.addChild(n)}var r=DrawUtil.textFilter(t);r.x=this.width/2+e,r.y=this.height/2,this.addChild(r)},e.prototype.setButtonEnable=function(t,e){this.changeTexture(t),this.backFun=e},e}(E8Button);__reflect(E8TextButton.prototype,"E8TextButton");var AIController=function(){function t(){if(this.random=!0,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){this.randomMapData=new MapData},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.randomMapData.clear()];case 1:return t.sent(),[2]}})})},t.prototype.generateRandomMap=function(){for(this.clear();this.randomMapData.numPlane<3;)this.addPlane();return this.randomMapData},t.prototype.addPlane=function(){var t=0,e=0,i=0;if(this.random)switch(t=Math.floor(4*Math.random())){case DirectionTypeEnum.UP:e=2+Math.floor(5*Math.random()),i=Math.floor(6*Math.random());break;case DirectionTypeEnum.RIGHT:e=3+Math.floor(6*Math.random()),i=2+Math.floor(5*Math.random());break;case DirectionTypeEnum.DOWN:e=2+Math.floor(5*Math.random()),i=3+Math.floor(6*Math.random());break;case DirectionTypeEnum.LEFT:e=Math.floor(6*Math.random()),i=2+Math.floor(5*Math.random())}this.randomMapData.setPlaneGrid(e,i,t)?this.randomMapData.numPlane++:this.randomMapData.clear()},t.prototype.getGridTypeById=function(t){return this.randomMapData.map[t].gridType},t.prototype.randomOpponent=function(){var t=CityController.getInstance().getTopLevel(BuildingEnum.AIRPORT);if(1===t)return[1,1,1];console.log(t);for(var e,i=BuildingDataCache.getInstance().getAirportDataByLevel(t),n=[],r=0;r<i.opponent;r++){var o=NumUtil.range(1,7);e=1,o>5?e=i.opponent_level:o>3?e=i.opponent_level-1:o>0&&(e=i.opponent_level-2),console.log(n),n.push(e)}return n},t.prototype.makeOpponenetDataByLevel=function(t){var e=200*NumUtil.range(1,100)+NumUtil.range(1,200),i={level:t,rank:e,score:1e3*t,gold:5e4*t,rob:2e4*t};return i},t.prototype.calOffline=function(){var t=SaveDataManager.getInstance().getUserData().lastDate,e=(new Date).getTime();if(console.log(e-t),e-t>2*GameConst.HOUR)for(var i=Math.floor((e-t)/GameConst.HOUR),n=0;i-3>n;n++)this.randomDestroy();SaveDataManager.getInstance().getUserData().setLastDate()},t.prototype.randomDestroy=function(){},t.prototype.AIPlayGame=function(){},t.instance=null,t}();__reflect(AIController.prototype,"AIController");var BadPlaceEnum;!function(t){t.BAD_GRID_LIST=[4,13,20,20,24,24,31,36,37,39,40,40,40,40,41,43,44,49,56,56,60,60,67,76],t.BAD_GRID_DIRECTION_LIST=[DirectionTypeEnum.UP,DirectionTypeEnum.UP,DirectionTypeEnum.UP,DirectionTypeEnum.LEFT,DirectionTypeEnum.UP,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.UP,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.UP,DirectionTypeEnum.DOWN,DirectionTypeEnum.LEFT,DirectionTypeEnum.RIGHT,DirectionTypeEnum.DOWN,DirectionTypeEnum.DOWN,DirectionTypeEnum.DOWN],t.BAD_GRID_TEST_LIST=[[10,22],[23],[13,14],[10,17],[9,11],[10,17],[10,19,20],[13,15],[16],[4,13,21],[0,3,5,6],[4,14,16,21],[17,19,20,23],[2,7,9,18],[2,11,18],[7],[8,11],[3,5,12],[13,14],[6,12],[6,12],[9,11],[0],[1,12]],t.GIFT_GRID_LIST=[0,8,72,80]}(BadPlaceEnum||(BadPlaceEnum={}));var BodyGridEnum;!function(t){function e(e){return e<=t.BONE?t.BONE:e<=t.WING?t.WING:e<=t.TAIL?t.TAIL:e==t.BOTTOM?t.BOTTOM:void 0}t.UNSET=-1,t.BONE=1,t.WING=6,t.TAIL=7,t.BOTTOM=8,t.getType=e}(BodyGridEnum||(BodyGridEnum={}));var BuildingEnum;!function(t){t.buildingString=[],t.UNSET=-1,t.AIRPORT=0,t.buildingString[t.AIRPORT]="airport",t.BANK=1,t.buildingString[t.BANK]="bank",t.BULLET_SCIENCE=2,t.buildingString[t.BULLET_SCIENCE]="bullet_science",t.GAS_STATION=3,t.buildingString[t.GAS_STATION]="gas_station",t.REPAIR_FACTORY=4,t.buildingString[t.REPAIR_FACTORY]="repair_factory",t.INSURE_COMPANY=5,t.buildingString[t.INSURE_COMPANY]="insure_company",t.DEFENSE=6,t.buildingString[t.DEFENSE]="defense",t.STRATEGY_CENTER=7,t.buildingString[t.STRATEGY_CENTER]="strategy_center",t.count=7}(BuildingEnum||(BuildingEnum={}));var BulletTypeEnum;!function(t){t.BULLET_GRID={},t.BULLET_GRID_AREA=[],t.BULLET_GRID_ROW=[];var e=0;t.MISSILE=e++,t.BULLET_GRID[t.MISSILE]=[0],t.BULLET_GRID_AREA[t.MISSILE]=AreaTypeEnum.ONE_POINT,t.CROSS_BOOM=e++,t.BULLET_GRID_AREA[t.CROSS_BOOM]=AreaTypeEnum.POINTS,t.BULLET_GRID[t.CROSS_BOOM]=[-9,-1,0,1,9],t.BULLET_GRID_ROW[t.CROSS_BOOM]=[-1,0,0,0,1],t.INFRARED_ROW=e++,t.BULLET_GRID_AREA[t.INFRARED_ROW]=AreaTypeEnum.ROW_OR_COL,t.INFRARED_COL=e++,t.BULLET_GRID_AREA[t.INFRARED_COL]=AreaTypeEnum.ROW_OR_COL,t.GUIDED_MISSILE=e++,t.BULLET_GRID_AREA[t.GUIDED_MISSILE]=AreaTypeEnum.ONE_POINT,t.INCENDIARY_BOMB=e++,t.BULLET_GRID_AREA[t.INCENDIARY_BOMB]=AreaTypeEnum.POINT_EXPAND,t.ARMOR_PIERCING_MISSILE=e++,t.BULLET_GRID[t.ARMOR_PIERCING_MISSILE]=[0],t.BULLET_GRID_AREA[t.ARMOR_PIERCING_MISSILE]=AreaTypeEnum.ONE_POINT,t.NINE_PALACE_MISSILE=e++,t.BULLET_GRID_AREA[t.NINE_PALACE_MISSILE]=AreaTypeEnum.POINTS,t.BULLET_GRID[t.NINE_PALACE_MISSILE]=[-10,-9,-8,-1,0,1,8,9,10],t.BULLET_GRID_ROW[t.NINE_PALACE_MISSILE]=[-1,-1,-1,0,0,0,1,1,1],t.COUNT=e}(BulletTypeEnum||(BulletTypeEnum={}));var ColorEnum;!function(t){t.DARK_BLUE=6720510,t.BLUE=4177662,t.CYAN=2416057,t.GREEN=1031711,t.YELLOW=16445296,t.ORANGE=16625219,t.RED=16614737,t.PINK=16535159,t.PURPLE=16017916,t.GRAY=12566463,t.colorList=[t.DARK_BLUE,t.BLUE,t.CYAN,t.GREEN,t.YELLOW,t.ORANGE,t.RED,t.PINK,t.PURPLE,t.GRAY]}(ColorEnum||(ColorEnum={}));var BulletController=function(){function t(){if(this.bulletList=[],this.storedBullet=null,t.instance)throw new Error("AIController singlon error")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.resetBullets=function(){this.bulletList=[];for(var t=0;3>t;t++)this.bulletList.push(this.randomOneBullet());console.log(this.bulletList)},t.prototype.getCurrentBullet=function(){return this.bulletList[0]},t.prototype.useBullet=function(){return this.bulletList.shift()},t.prototype.rewardOneBullet=function(t){this.bulletList.unshift(t)},t.prototype.rewardBullet=function(t){this.bulletList.unshift(t),GameController.getInstance().nextAttackPhase()},t.prototype.prepareNextBullet=function(){this.randomNextBullet(),SceneManager.getInstance().awayScene.updateBullets(),GameController.getInstance().nextAttackPhase()},t.prototype.randomOneBullet=function(){var t=CityController.getInstance().getAllBuildingsByType(BuildingEnum.BULLET_SCIENCE);console.log(t);var e=CityController.getInstance().getTopLevel(BuildingEnum.BULLET_SCIENCE);console.log(e);var i=BulletTypeEnum.MISSILE;if(0===e)return i;for(var n=0;n<t.length;n++);return i},t.prototype.randomNextBullet=function(){this.bulletList.push(this.randomOneBullet())},t.prototype.switchBullet=function(){if(null===this.storedBullet)this.storeCurrentBullet();else{var t=this.bulletList.shift();this.bulletList.unshift(this.storedBullet),this.storedBullet=t}},t.prototype.storeCurrentBullet=function(){this.storedBullet=this.bulletList.shift(),this.randomNextBullet()},Object.defineProperty(t.prototype,"stored",{get:function(){return this.storedBullet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bullets",{get:function(){return console.log(this.bulletList),this.bulletList},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(BulletController.prototype,"BulletController");var GameConst;!function(t){t.SECOND=1e3,t.MINUTE=60*t.SECOND,t.HOUR=60*t.MINUTE,t.DAY=24*t.HOUR}(GameConst||(GameConst={}));var GameTypeEnum;!function(t){t.GAME_TYPE_IDLE=0,t.GAME_TYPE_MAPING=1,t.GAME_TYPE_HITTING=2,t.GAME_TYPE_DOUBLE_HITTING=3}(GameTypeEnum||(GameTypeEnum={}));var GridStatusEnum;!function(t){t.COVER=0,t.KNOWN=1,t.SHOW=2,t.UNSHOW=3}(GridStatusEnum||(GridStatusEnum={}));var GridTypeEnum;!function(t){t.UNSET=-1,t.MISS=0,t.BODY=1,t.HEAD=2,t.GIFT=3,t.GOLD=4,t.TELEPORT=5}(GridTypeEnum||(GridTypeEnum={}));var PhaseEnum=function(){function t(){}return t.PREPARE_PHASE=0,t.ATTACK_PHASE=1,t.RESULT_PHASE=2,t.END_PHASE=3,t.OVER_PHASE=4,t}();__reflect(PhaseEnum.prototype,"PhaseEnum");var PlaneTypeEnum=function(){function t(){}return t}();__reflect(PlaneTypeEnum.prototype,"PlaneTypeEnum");var RankTitleEnum;!function(t){t.King="荣耀王者"}(RankTitleEnum||(RankTitleEnum={}));var ResourceEnum;!function(t){t.GOLD="gold",t.GAS="gas"}(ResourceEnum||(ResourceEnum={}));var ResultTypeEnum;!function(t){t.WIN=1,t.FAIL=2,t.GIVE_UP=3}(ResultTypeEnum||(ResultTypeEnum={}));var RewardTitleEnum;!function(t){t.KILLING_SPREE=3,t.DOMANATING=4,t.MEGA_KILL=5,t.UNSTOPPABLE=6,t.WICKED_SICK=7,t.MONSTER_KILL=8,t.GOD_LIKE=9,t.HOLY_SHIT=10,t.DOUBLE_KILL=2,t.TRIPLE_KILL=3,t.ULTRAKILL=4,t.RAMPAGE=5}(RewardTitleEnum||(RewardTitleEnum={}));var ScoreTypeEnum=function(){function t(){}return t.NO_SCORE=0,t.SSS=5,t.S=4,t.A=3,t.B=2,t.C=1,t}();__reflect(ScoreTypeEnum.prototype,"ScoreTypeEnum");var SignTypeEnum=function(){function t(){}return t.UNSIGN=-1,t.MISS=0,t.BODY=1,t.HEAD=2,t
}();__reflect(SignTypeEnum.prototype,"SignTypeEnum");var SoundEnum;!function(t){t.SELECT_SOUND_MP3="select_sound_mp3"}(SoundEnum||(SoundEnum={}));var GridEvent=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.EventDispatcher);__reflect(GridEvent.prototype,"GridEvent");var i18n=function(){function t(){this.langData=RES.getRes("language_json"),console.log(this.langData)}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.getLanguage=function(t){return console.log(SettingController.getInstance().Lang),this.langData[SettingController.getInstance().Lang][t]},t.instance=null,t}();__reflect(i18n.prototype,"i18n");var SaveDataManager=function(){function t(){this.userData=null,this.isNew=!0,this.isGuideFinished=!1,this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.getUserData=function(){return this.userData||(this.userData=new UserData),this.userData},t.prototype.saveUserData=function(){this.userData.saveUserData()},t.prototype.getFromLocal=function(t){return egret.localStorage.getItem(t)},t.prototype.saveToLocal=function(t,e){egret.localStorage.setItem(t,e)},t.prototype.saveSoundStatus=function(t){egret.localStorage.setItem("soundPlaying",t)},t.prototype.getSoundStatus=function(){return egret.localStorage.getItem("soundPlaying")},t.prototype.getLang=function(){return egret.localStorage.getItem("lang")},t.prototype.setLang=function(t){egret.localStorage.setItem("lang",t)},t.prototype.getGuide=function(){return this.getFromLocal("guide")},t.prototype.setGuide=function(t){this.saveToLocal("guide",t)},t.instance=null,t}();__reflect(SaveDataManager.prototype,"SaveDataManager");var SceneManager=function(){function t(){if(this.currentScene=null,this.gameLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,this.uiLayer=new egret.DisplayObjectContainer,this.popLayer=new egret.DisplayObjectContainer,this.tipLayer=new egret.DisplayObjectContainer,this.headUI=null,t.instance)throw new Error("AIController singlon error")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.init=function(t){this.egretStage=t,this.saveMsg=SaveDataManager.getInstance(),this.egretStage.addChild(new BackGround),this.egretStage.addChild(this.gameLayer),this.egretStage.addChild(this.uiLayer),this.egretStage.addChild(this.popLayer),this.egretStage.addChild(this.tipLayer),this.egretStage.addChild(this.loadingLayer)},t.prototype.initLayer=function(t){t.x=(AdaptSceenUtil.curWidth()-AdaptSceenUtil.displayWidth())/2,t.y=(AdaptSceenUtil.curHeight()-AdaptSceenUtil.displayHeight())/2,this.egretStage.addChild(t)},t.prototype.initUIView=function(){this.headUI=new HeadUI,this.updateGas(),this.updateGold(),t.getInstance().getUILayer().addChild(this.headUI)},t.prototype.updateGold=function(){this.headUI.setGold(this.saveMsg.getUserData().gold)},t.prototype.updateGas=function(){this.headUI.setGas(this.saveMsg.getUserData().gas)},t.prototype.showLoading=function(){},t.prototype.prepareScene=function(){this.cityScene=new CityScene,this.awayScene=new AwayScene,this.placingScene=new PlacingScene,this.resultScene=new ResultScene,this.cityScene.x=0,this.awayScene.x=0,this.placingScene.x=0,this.resultScene.x=0,this.toCityScene()},t.prototype.toResultScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.resultScene.inAnimate(),this.gameLayer.addChild(t.getInstance().resultScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.resultScene},t.prototype.toCityScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.cityScene.inAnimate(),this.gameLayer.addChild(t.getInstance().cityScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.cityScene},t.prototype.toAwayScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.awayScene.inAnimate(),this.gameLayer.addChild(t.getInstance().awayScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.awayScene},t.prototype.toPlacingScene=function(){this.currentScene&&this.currentScene.outAnimate(),this.placingScene.inAnimate(),this.gameLayer.addChild(t.getInstance().placingScene),this.gameLayer.contains(this.currentScene)&&this.gameLayer.removeChild(this.currentScene),this.currentScene=this.placingScene},t.prototype.getGameLayer=function(){return this.gameLayer},t.prototype.getUILayer=function(){return this.uiLayer},t.prototype.getLoadingLayer=function(){return this.loadingLayer},t.prototype.getPopLayer=function(){return this.popLayer},t.prototype.getTipLayer=function(){return this.tipLayer},t.prototype.openBuildingPop=function(t){this.popLayer.addChild(new BuildingPop(t))},t.prototype.showTip=function(t){var e=this;0!==this.tipLayer.numChildren&&this.tipLayer.removeChildren();var i=new FlippyTip(t);i.x=AdaptSceenUtil.curWidth()/2,i.y=AdaptSceenUtil.curHeight()/2,egret.setTimeout(function(){e.tipLayer.contains(i)&&e.tipLayer.removeChild(i)},this,1500),this.tipLayer.addChild(i)},t.instance=null,t}();__reflect(SceneManager.prototype,"SceneManager");var SoundManager=function(){function t(){this.init()}return t.prototype.init=function(){if(null!==t.instance)throw new Error("single instance error")},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.playBGM=function(){SettingController.getInstance().SoundPlaying},t.prototype.playSound=function(t,e){if(void 0===e&&(e=1),SettingController.getInstance().SoundPlaying){var i=RES.getRes(t);this.soundChannel=i.play(0,e)}},t.prototype.onPlayOver=function(){},t.prototype.stopBGM=function(){this.bgmChannel.stop(),void 0!==this.soundChannel&&this.soundChannel.stop()},t.instance=null,t}();__reflect(SoundManager.prototype,"SoundManager");var BulletData=function(){function t(t){this.phase=[],this.id=t.id,this.type=t.type,this.desc=t.desc,this.view=t.view,this.animate=t.animate,this.phase=t.phase}return t}();__reflect(BulletData.prototype,"BulletData");var BulletDataCache=function(){function t(){this.bulletDatas=[],this.intiData()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.intiData=function(){this.parseData(RES.getRes("bullet_json"))},t.prototype.parseData=function(t){for(var e,i=t.bullet,n=0;i>n;n++)e=new BulletData(i[n]),this.bulletDatas.push(e)},t.prototype.getBulletData=function(t){return this.bulletDatas[t]},t.instance=null,t}();__reflect(BulletDataCache.prototype,"BulletDataCache");var GridData=function(){function t(t,e,i,n){void 0===e&&(e=GridTypeEnum.MISS),void 0===i&&(i=DirectionTypeEnum.UNSET),void 0===n&&(n=BodyGridEnum.UNSET),this._gridValue=t,this._gridType=e,this._direction=i,this._bodyType=n,this.index=-1}return Object.defineProperty(t.prototype,"row",{get:function(){return Math.floor(this._gridValue/9)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._gridValue%9},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridValue",{get:function(){return this._gridValue},set:function(t){this._gridValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridType",{get:function(){return this._gridType},set:function(t){this._gridType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bodyType",{get:function(){return this._bodyType},set:function(t){this._bodyType=t},enumerable:!0,configurable:!0}),t}();__reflect(GridData.prototype,"GridData");var HeadData=function(){function t(t){this.head=t.head,this.direction=t.direction}return t}();__reflect(HeadData.prototype,"HeadData");var CityController=function(){function t(){if(this.buildings=[],this.selectedPosition=-1,t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){this.buildingData=BuildingDataCache.getInstance(),this.citySave=SaveDataManager.getInstance().getUserData().buildings,this.center=this.buildingData.getAirportDataByLevel(this.citySave[0].level),this.center.position=0,this.buildings.push(this.center);for(var t=1;t<this.citySave.length;t++)this.buildings.push(this.buildingData.getBuildingByIdAndLevel(this.citySave[t].id,this.citySave[t].level)),this.buildings[t].position=t,this.buildings[t].top=this.citySave[t].top;this.buildingCircle=new Circle(6,this.buildings.slice(1,this.buildings.length))},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.selectPosition=function(t){console.log(t),this.selectedPosition=t,SceneManager.getInstance().cityScene.selectPosition(this.buildings[t],this.selectedPosition)},t.prototype.updateCircle=function(){this.buildingCircle.data=this.buildings.slice(1,this.buildings.length)},t.prototype.buildBuilding=function(t){this.selectedPosition>0&&this.selectedPosition<7&&-1===this.buildings[this.selectedPosition].id&&GameController.getInstance().costGold(this.buildingData.getBuildingByIdAndLevel(t,1).cost)&&(this.buildings[this.selectedPosition]=this.buildingData.getBuildingByIdAndLevel(t,1),this.buildings[this.selectedPosition].position=this.selectedPosition,this.saveCity(this.selectedPosition),this.updateCircle(),SceneManager.getInstance().cityScene.build(this.buildings[this.selectedPosition]))},t.prototype.demolish=function(){return 0===this.selectedPosition?void console.log("空军基地不能拆除"):(GameController.getInstance().addGold(this.buildings[this.selectedPosition].cost),this.buildings[this.selectedPosition]=new BuildingBase,this.buildings[this.selectedPosition].position=this.selectedPosition,this.saveCity(this.selectedPosition),this.updateCircle(),void SceneManager.getInstance().cityScene.demolish(this.buildings[this.selectedPosition]))},t.prototype.levelUpBuilding=function(){if(console.log("level up"),this.selectedPosition>=0&&this.selectedPosition<7)if(console.log(this.buildings[this.selectedPosition]),this.buildings[this.selectedPosition].level<5){var t=this.buildingData.getBuildingByIdAndLevel(this.buildings[this.selectedPosition].id,this.buildings[this.selectedPosition].level+1);GameController.getInstance().costGold(t.cost)&&(this.buildings[this.selectedPosition]=t,this.buildings[this.selectedPosition].position=this.selectedPosition,this.saveCity(this.selectedPosition),this.updateCircle(),SceneManager.getInstance().cityScene.levelupBuilding(this.buildings[this.selectedPosition]))}else console.log("已经达到满级别")},t.prototype.getTotalScore=function(){for(var t=0,e=0;e<this.buildings.length;e++)this.buildings[e].id!==BuildingEnum.UNSET&&(t+=this.buildings[e].score);return t},t.prototype.getBuildingNum=function(t){for(var e=0,i=0;i<this.buildings.length;i++)this.buildings[i].id===t&&e++;return e},t.prototype.getTopLevel=function(t){for(var e=0,i=0;i<this.buildings.length;i++)this.buildings[i].id===t&&(e=Math.max(e,this.buildings[i].level));return e},t.prototype.getAllBuildingsByType=function(t){var e=this.buildings.filter(function(e){return e.id===t});return e},t.prototype.getBuildingBlockByType=function(t){for(var e=[],i=0;i<this.buildingCircle.length;i++)this.isBlock(this.buildingCircle.data[i].position)&&e.push(this.buildingCircle.data[i]);return e.filter(function(e){return e.id===t})},t.prototype.getBlock=function(t){for(var e=[],i=!0,n=!0,r=t;i;)if(this.isBlockNext(r)?(r++,e.push(r%this.buildingCircle.length)):i=!1,e.length===this.buildingCircle.length)return e;for(r=t;n;)this.isBlockPrevious(r)?(r--,e.push(r%this.buildingCircle.length)):n=!1;return e.push(t),e},t.prototype.isBlock=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getNext(t).id||this.buildingCircle.getData(t).id===this.buildingCircle.getPrevious(t).id},t.prototype.isBlockPrevious=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getPrevious(t).id},t.prototype.isBlockNext=function(t){return this.buildingCircle.getData(t).id===this.buildingCircle.getNext(t).id},t.prototype.getBuildingByPostion=function(t){return this.buildings[t]},t.prototype.getBuildingsExceptAirpot=function(){return this.buildings},t.prototype.getBuildings=function(){return this.buildings},t.prototype.saveCity=function(t){var e={id:this.buildings[t].id,level:this.buildings[t].level,top:this.buildings[t].top,insure:this.buildings[t].insure,protect:this.buildings[t].protect};SaveDataManager.getInstance().getUserData().setBuilding(t,e)},t.prototype.destroyCity=function(t){if(this.buildings[t].level-1>0){this.buildings[t].level-=1;var e={id:this.buildings[t].id,level:this.buildings[t].level,top:this.buildings[t].top,insure:this.buildings[t].insure,protect:this.buildings[t].protect};SaveDataManager.getInstance().getUserData().setBuilding(t,e)}},t.prototype.repairCity=function(t){void 0===t&&(t=null),null===t&&(t=this.selectPosition),this.buildings[t].level<this.buildings[t].top},t.prototype.selectedData=function(){return this.buildings[this.selectedPosition]},t.instance=null,t}();__reflect(CityController.prototype,"CityController");var MapStatsData=function(){function t(t){this.id=t.id,this.heads=t.heads,this.attacted=t.attacted}return t}();__reflect(MapStatsData.prototype,"MapStatsData");var OpponentData=function(){function t(t){this.playerName=t.playerName,this.level=t.level,this.rank=t.rank,this.city_score=t.city_score,this.distance=t.distance,this.gold=t.gold}return t}();__reflect(OpponentData.prototype,"OpponentData");var PerfectMapData=function(t){function e(){var e=t.call(this)||this;return e.numPlane=3,e}return __extends(e,t),e.prototype.setPlaneByHeadData=function(){if(3!==this.headList.length)throw new Error("headDataError");for(var t=0;t<this.headList.length;t++)this.setPlaneGridByHead(this.headList[t].head,this.headList[t].direction)},e}(MapData);__reflect(PerfectMapData.prototype,"PerfectMapData");var UserData=function(){function t(){this._gold=0,this._gas=0,this._buildings=[{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1},{id:0,level:0,top:0,insure:[],protect:!1}],this._rank=0,this.initData()}return t.prototype.initData=function(){var t=SaveDataManager.getInstance().getFromLocal("userData");if(null===t||void 0===t||""===t)this._gold=5e3,this._gas=15,this._lastDate=(new Date).getTime(),this._buildings=[{id:0,level:1,top:1,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1},{id:-1,level:0,top:0,insure:[],protect:!1}],SaveDataManager.getInstance().saveToLocal("userData",JSON.stringify({gold:this._gold,gas:this._gas,buildings:this._buildings,lastDate:(new Date).getTime()}));else{var e=JSON.parse(t);console.log(e),this._gold=e.gold,this._gas=e.gas,this._buildings=e.buildings,this._lastDate=e.lastDate}},Object.defineProperty(t.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=t,this.saveUserData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gas",{get:function(){return this._gas},set:function(t){this._gas=t,this.saveUserData()},enumerable:!0,configurable:!0}),t.prototype.setBuilding=function(t,e){this._buildings[t]={id:e.id,level:e.level,top:e.top,insure:e.insure,protect:e.protect},this.saveUserData()},Object.defineProperty(t.prototype,"buildings",{get:function(){return this._buildings},enumerable:!0,configurable:!0}),t.prototype.saveUserData=function(){SaveDataManager.getInstance().saveToLocal("userData",JSON.stringify({gold:this._gold,gas:this._gas,buildings:this._buildings,lastDate:this._lastDate}))},t.prototype.getSharedMap=function(){},t.prototype.getSaveData=function(){return{gold:this._gold,gas:this._gas,lastDate:this.lastDate,buildings:this._buildings}},Object.defineProperty(t.prototype,"lastDate",{get:function(){return this._lastDate},enumerable:!0,configurable:!0}),t.prototype.setLastDate=function(){this._lastDate=(new Date).getTime(),this.saveUserData()},t}();__reflect(UserData.prototype,"UserData");var AirportData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.AIRPORT,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.opponent=e.opponent,i.opponent_level=e.opponent_level,i}return __extends(e,t),e}(BuildingBase);__reflect(AirportData.prototype,"AirportData");var BankData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.BANK,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.game_reward=e.game_reward,i.chest_reward=e.chest_reward,i.vedio_reward=e.vedio_reward,i}return __extends(e,t),e}(BuildingBase);__reflect(BankData.prototype,"BankData");var GameController=function(){function t(){if(this.gameResult=null,this.one_round_result=[],t.instance)throw new Error("AIController singlon error")}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.resetAwayGame=function(t){void 0===t&&(t=0),this.phase=PhaseEnum.PREPARE_PHASE,this.gameResult=null,RewardController.getInstance().reset(),RecordController.getInstance().reset(),BulletController.getInstance().resetBullets(),this._type=GameTypeEnum.GAME_TYPE_HITTING,SceneManager.getInstance().awayScene.resetGameView(),this.awayMapData=AIController.getInstance().generateRandomMap(),this.phase=PhaseEnum.ATTACK_PHASE},t.prototype.startPlacingGame=function(){this._type=GameTypeEnum.GAME_TYPE_MAPING,PlacingController.getInstance().randomMap()},t.prototype.gameStart=function(){this.phase=PhaseEnum.ATTACK_PHASE},t.prototype.gameFinished=function(t){this.phase=PhaseEnum.OVER_PHASE,this.gameResult=t,RecordController.getInstance().recordMap(this.awayMapData.map),console.log(t),SceneManager.getInstance().resultScene.showResult(ResultTypeEnum.WIN,ScoreTypeEnum.SSS),SceneManager.getInstance().toResultScene()},t.prototype.mapShowGird=function(t){MapUtil.gridValid(t)&&(this.one_round_result.push(this.awayMapData.map[t].gridType),RecordController.getInstance().recordGridOpen(t),SceneManager.getInstance().awayScene.showGridView(t,this.awayMapData.map[t].gridType))},t.prototype.nextAttackPhase=function(){this.phase=PhaseEnum.ATTACK_PHASE,BulletController.getInstance().getCurrentBullet()===BulletTypeEnum.GUIDED_MISSILE&&this.hitGrid(this.getUnHitPlaneGrid(),BulletController.getInstance().useBullet())},t.prototype.hitGrid=function(t,e){if(this.phase!==PhaseEnum.OVER_PHASE&&this.phase===PhaseEnum.ATTACK_PHASE){this.phase=PhaseEnum.RESULT_PHASE;var i;BulletTypeEnum.BULLET_GRID_AREA[e];switch(this.one_round_result=[],e){case BulletTypeEnum.MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.CROSS_BOOM:i=BulletTypeEnum.BULLET_GRID[BulletTypeEnum.CROSS_BOOM];for(var n=0;n<i.length;n++)this.mapShowGird(t+i[n]);break;case BulletTypeEnum.INFRARED_ROW:var r=MapUtil.getXYFromValue(t).y;i=AreaTypeEnum.getOneRow(AreaTypeEnum.ROWS[r]);for(var n=0;n<i.length;n++)this.mapShowGird(i[n]);break;case BulletTypeEnum.INFRARED_COL:var o=MapUtil.getXYFromValue(t).x;i=AreaTypeEnum.getOneCol(AreaTypeEnum.COLS[o]);for(var n=0;n<i.length;n++)this.mapShowGird(i[n]);break;case BulletTypeEnum.GUIDED_MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.INCENDIARY_BOMB:this.mapShowGird(t);break;case BulletTypeEnum.ARMOR_PIERCING_MISSILE:this.mapShowGird(t);break;case BulletTypeEnum.NINE_PALACE_MISSILE:i=BulletTypeEnum.BULLET_GRID[BulletTypeEnum.NINE_PALACE_MISSILE];for(var n=0;n<i.length;n++)this.mapShowGird(t+i[n]);break;default:this.mapShowGird(t)}RecordController.getInstance().recordAction(this.awayMapData.map[t],e),this.one_round_result.length>1?(console.log(this.one_round_result),RewardController.getInstance().hitReward(this.one_round_result)):this.one_round_result[0]===GridTypeEnum.MISS&&RewardController.getInstance().isMissReward()&&RewardController.getInstance().missReward(),RecordController.getInstance().isContinuous(this.awayMapData.map[t],this.awayMapData.map[t].gridType)&&RewardController.getInstance().continuousReward(),this.phase!==PhaseEnum.OVER_PHASE&&(this.phase=PhaseEnum.END_PHASE,BulletController.getInstance().prepareNextBullet())}},t.prototype.costGold=function(t){var e=SaveDataManager.getInstance().getUserData().gold;return 0/0===Number(e)?(console.log("金币存储错误"),!1):t>e?(console.log("金币不足"),!1):(console.log(SaveDataManager.getInstance().getUserData().gold),console.log(e),console.log(t),console.log(Number(e)-t),SaveDataManager.getInstance().getUserData().gold=Number(e)-Number(t),SceneManager.getInstance().updateGold(),SaveDataManager.getInstance().saveUserData(),!0)},t.prototype.costGas=function(t){SaveDataManager.getInstance().getUserData().gas-=t,SceneManager.getInstance().updateGas(),SaveDataManager.getInstance().saveUserData()},t.prototype.addGold=function(t){SaveDataManager.getInstance().getUserData().gold+=t,SceneManager.getInstance().updateGold(),SaveDataManager.getInstance().saveUserData()},t.prototype.getMapByUser=function(){},t.prototype.getTestMapData=function(){},t.prototype.setTestMapData=function(){},t.prototype.getAwayMapData=function(t){return this.awayMapData.map[t].gridType},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAttackPhase",{get:function(){return this.phase===PhaseEnum.ATTACK_PHASE},enumerable:!0,configurable:!0}),t.prototype.getUnHitPlaneGrid=function(){var t=RecordController.getInstance().getOneUnhitPlane();return-1===t?this.getPlaneGridUnhit():this.getPlaneGridUnhitByIndex(t)},t.prototype.getPlaneGridUnhitByIndex=function(t){var e=RecordController.getInstance().getHitRecorded(),i=this.awayMapData.getPlaneGridByIndex(t),n=i.filter(function(t){return-1===e.indexOf(t.gridValue)});return ArrayUtil.random(n).gridValue},t.prototype.getPlaneGridUnhit=function(){var t=RecordController.getInstance().getHitRecorded(),e=this.awayMapData.getPlaneGrid(),i=e.filter(function(e){return-1===t.indexOf(e.gridValue)});return ArrayUtil.random(i).gridValue},t.instance=null,t}();__reflect(GameController.prototype,"GameController");var BuildingDataCache=function(){function t(){this.airportData=[null],this.bankData=[null],this.scienceData=[null],this.gasStationData=[null],this.repairFactoryData=[null],this.insureCompanyData=[null],this.defenseData=[null],this.intiData()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.intiData=function(){this.parseData(RES.getRes("building_json"))},t.prototype.parseData=function(t){console.log(t);for(var e in t)switch(e){case BuildingEnum.buildingString[BuildingEnum.AIRPORT]:this.parseAirport(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.BANK]:this.parseBank(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.BULLET_SCIENCE]:this.parseBulletScience(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.GAS_STATION]:this.parseGasStatision(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.REPAIR_FACTORY]:this.parseRepairFactory(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.INSURE_COMPANY]:this.parseInsureCompany(t[e]);break;case BuildingEnum.buildingString[BuildingEnum.DEFENSE]:this.parseDefense(t[e]);break;default:console.log("new building has no parse")}},t.prototype.parseAirport=function(t){for(var e,i=0;i<t.length;i++)e=new AirportData(t[i]),this.airportData.push(e)},t.prototype.parseBank=function(t){for(var e,i=0;i<t.length;i++)e=new BankData(t[i]),this.bankData.push(e)},t.prototype.parseBulletScience=function(t){for(var e,i=0;i<t.length;i++)e=new BulletScienceData(t[i]),this.scienceData.push(e)},t.prototype.parseGasStatision=function(t){for(var e,i=0;i<t.length;i++)e=new GasStationData(t[i]),this.gasStationData.push(e)},t.prototype.parseRepairFactory=function(t){for(var e,i=0;i<t.length;i++)e=new RepairFactoryData(t[i]),this.repairFactoryData.push(e)},t.prototype.parseInsureCompany=function(t){for(var e,i=0;i<t.length;i++)e=new InsureCompanyData(t[i]),this.insureCompanyData.push(e)},t.prototype.parseDefense=function(t){for(var e,i=0;i<t.length;i++)e=new DefenseData(t[i]),this.defenseData.push(e)},t.prototype.getBuildingByIdAndLevel=function(t,e){if(!(e>0&&6>e))return new BuildingBase;switch(t){case BuildingEnum.AIRPORT:return this.getAirportDataByLevel(e);case BuildingEnum.BANK:return this.getBankDataByLevel(e);case BuildingEnum.BULLET_SCIENCE:return this.getBulletScienceByLevel(e);case BuildingEnum.GAS_STATION:return this.getGasStationByLevel(e);case BuildingEnum.REPAIR_FACTORY:return this.getRepairFactoryByLevel(e);case BuildingEnum.INSURE_COMPANY:return this.getInsureCompanyByLevel(e);case BuildingEnum.DEFENSE:return this.getDefenseByLevel(e)}},t.prototype.getAirportDataByLevel=function(t){return new AirportData(this.airportData[t])},t.prototype.getBankDataByLevel=function(t){return new BankData(this.bankData[t])},t.prototype.getBulletScienceByLevel=function(t){return new BulletScienceData(this.scienceData[t])},t.prototype.getGasStationByLevel=function(t){return new GasStationData(this.gasStationData[t])},t.prototype.getRepairFactoryByLevel=function(t){return new RepairFactoryData(this.repairFactoryData[t])},t.prototype.getInsureCompanyByLevel=function(t){return new InsureCompanyData(this.insureCompanyData[t])},t.prototype.getDefenseByLevel=function(t){return new DefenseData(this.defenseData[t])},t.instance=null,t}();__reflect(BuildingDataCache.prototype,"BuildingDataCache");var BulletScienceData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.BULLET_SCIENCE,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.level=e.level,i.first=e.first,i.then=e.then,i.first_num=e.first_num,i.bullets=e.bullets,i}return __extends(e,t),Object.defineProperty(e.prototype,"allBulletsType",{get:function(){return this.bullets},enumerable:!0,configurable:!0}),e}(BuildingBase);__reflect(BulletScienceData.prototype,"BulletScienceData");var DefenseData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.DEFENSE,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.missle=e.missle,i}return __extends(e,t),e}(BuildingBase);__reflect(DefenseData.prototype,"DefenseData");var GasStationData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.GAS_STATION,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.level=e.level,i.mph=e.mph,i.max=e.max,i}return __extends(e,t),e}(BuildingBase);__reflect(GasStationData.prototype,"GasStationData");var InsureCompanyData=function(t){function e(e){var i=t.call(this)||this;return i.id=BuildingEnum.INSURE_COMPANY,i.level=e.level,i.cost=e.cost,i.name=e.name,i.view=e.view,i.desc=e.desc,i.duration=e.missle,i.building=e.missle,i.paid=e.missle,i}return __extends(e,t),e}(BuildingBase);__reflect(InsureCompanyData.prototype,"InsureCompanyData");var DebugPlatform=function(){function t(){}return t.prototype.initSDK=function(){},t.prototype.initAnalytics=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{gameKey:"02a2d376f1268780cdeb969e3385bae2",secretKey:"9b426779362d3259747c55f90ce0a40500524bcb"}]})})},t.prototype.analytics=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return console.log(t,e),[2]})})},t.prototype.setLifeCycleCallBack=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return egret.lifecycle.onPause=function(){t()},egret.lifecycle.onResume=function(){e()},[2]})})},t.prototype.setLoadingProgress=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.loadingComplete=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.print=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return console.log(t),[2]})})},t.prototype.existRank=function(){return!1},t.prototype.getRank=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){console.log("获取"),t([{nick:"哈N她!)|A(1",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)A(2",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(3",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(4",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(5",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(6",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(7",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(8",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(9",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(10",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(11",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(12",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(13",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"},{nick:"哈N她!)|A(14",score:5,selfFlag:1,url:"http://thirdqq.qlogo.cn/g?b=sdk&k=F7aCnicxWzpicK89d0gkh7cw&s=100&t=1516260478"}])})]})})},t.prototype.share=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return console.log(t),[2]})})},t.prototype.uploadRank=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,e]})})},t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.offsetHead=function(){return 0},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchBanner=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.showBanner=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.hideBanner=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchInterstitial=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.showInterstitial=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.fetchVedio=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,null]})})},t.prototype.reloadVedio=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.vedioPlay=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return i(!0),[2]
})})},t.prototype.getSaveData=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{key:"key"}]})})},t.prototype.setSaveData=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.rankView=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getGameRecorderManager=function(){return null},t.prototype.shareVedio=function(t){},t.prototype.showTip=function(t){},t.prototype.stopRecord=function(){},t.prototype.pauseRecord=function(){},t.prototype.resumeRecord=function(){},t.prototype.startRecord=function(){},t.prototype.loadNextStage=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.loadFont=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.getAppName=function(){return""},t.prototype.hasBannerSDK=function(){return!1},t.prototype.hasInterstitialSDK=function(){return!1},t.prototype.hasVedioSDK=function(){return!1},t.prototype.hasShareSDK=function(){return!1},t.prototype.hasShareVedioSDK=function(){return!1},t.prototype.openScheme=function(){},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform,window.platform.name="web");var AdaptSceenUtil;!function(t){function e(){return egret.MainContext.instance.stage.stageWidth/640}function i(){return egret.MainContext.instance.stage.stageHeight/egret.MainContext.instance.stage.stageWidth}function n(){return 640/1136}function r(){return(egret.MainContext.instance.stage.stageWidth-640)/2}function o(){return(egret.MainContext.instance.stage.stageHeight-1136)/2}function s(){return egret.MainContext.instance.stage}function a(){return egret.MainContext.instance.stage.stageWidth}function l(){return egret.MainContext.instance.stage.stageHeight}function u(){return 640}function c(){return 1136}function h(){return egret.MainContext.instance.stage.scaleMode}function d(t,e,i){void 0===e&&(e=1),void 0===i&&(i=0),0===i&&(i=t.totalFrames),t.currentFrame<e||t.currentFrame>=i?t.gotoAndStop(e):t.nextFrame()}function p(t,e){-1===t.indexOf(e)&&t.push(e)}function g(){t.curWidth()>=t.displayWidth()&&t.curHeight()>=t.displayHeight()?(console.log("no_scale"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.NO_SCALE):t.curWidth()/t.curHeight()<t.displayWidth()/t.displayHeight()?(console.log("width"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT):(console.log("height"),egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH)}t.factor=e,t.wDivideH=i,t.designWDivideH=n,t.x_fix=r,t.y_fix=o,t.gameStage=s,t.curWidth=a,t.curHeight=l,t.displayWidth=u,t.displayHeight=c,t.scaleMode=h,t.loopPlay=d,t.singletonPush=p,t.E8ScaleMode=g}(AdaptSceenUtil||(AdaptSceenUtil={}));var ArrayUtil;!function(t){function e(t,e){-1===t.indexOf(e)&&t.push(e)}function i(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}function n(t){return t[Math.floor(Math.random()*t.length)]}t.add=e,t.remove=i,t.random=n}(ArrayUtil||(ArrayUtil={}));var DrawUtil;!function(t){function e(t,e){var i=function(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e},n=i(e),r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];r[0]=n.r/255,r[6]=n.g/255,r[12]=n.b/255;var o=new egret.ColorMatrixFilter(r);t.filters=[o]}function i(t,e,i){void 0===e&&(e=24),void 0===i&&(i=!0);var n=new egret.Sprite,r=new egret.TextField;if(r.text=t,r.stroke=4,r.strokeColor=3355443,r.size=e,r.lineSpacing=20,i){var o=new egret.TextField;o.text=t,o.textColor=3355443,o.size=e,o.x=5,o.y=7,n.addChild(o)}return n.addChild(r),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.cacheAsBitmap=!0,n}t.setImageColor=e,t.textFilter=i}(DrawUtil||(DrawUtil={}));var MapUtil;!function(t){function e(t,e){if(t===e)return DirectionTypeEnum.UNSET;var i=r(t),n=r(e);return Math.abs(i.x-n.x)-Math.abs(i.y-n.y)>0?i.x-n.x>0?DirectionTypeEnum.RIGHT:i.x-n.x<0?DirectionTypeEnum.LEFT:DirectionTypeEnum.ERROR:Math.abs(i.x-n.x)-Math.abs(i.y-n.y)<0?i.y-n.y>0?DirectionTypeEnum.DOWN:i.y-n.y<0?DirectionTypeEnum.UP:DirectionTypeEnum.ERROR:DirectionTypeEnum.UNCERTAIN}function i(t,e){return e%9-t%9}function n(t,e){return Math.floor(e/9)-Math.floor(t/9)}function r(t){var e={x:t%9,y:Math.floor(t/9)};return e}function o(t,e){if(0>t||t>80)return!1;var i=r(t),n=i.x,o=i.y;switch(e){case DirectionTypeEnum.UP:return 0>n-2||n+2>8||o+3>8?!1:!0;case DirectionTypeEnum.RIGHT:return 0>o-2||o+2>8||0>n-3?!1:!0;case DirectionTypeEnum.DOWN:return 0>n-2||n+2>8||0>o-3?!1:!0;case DirectionTypeEnum.LEFT:return 0>o-2||o+2>8||n+3>8?!1:!0;default:return console.log("direction error"),!1}}function s(t){switch(t){case DirectionTypeEnum.UP:return[9,18,7,8,10,11,26,28,27];case DirectionTypeEnum.RIGHT:return[-1,-2,-19,-10,8,17,-12,6,-3];case DirectionTypeEnum.DOWN:return[-9,-18,-7,-8,-10,-11,-28,-26,-27];case DirectionTypeEnum.LEFT:return[1,2,-17,-8,10,19,-6,12,3];default:return console.log("direction error"),[]}}function a(t,e){switch(console.log("rotation,head:"+t+",direction:"+e),e){case DirectionTypeEnum.UP:return o(t+10,DirectionTypeEnum.RIGHT)?{head:t+10,direction:DirectionTypeEnum.RIGHT}:a(t+10,DirectionTypeEnum.RIGHT);case DirectionTypeEnum.RIGHT:return o(t+8,DirectionTypeEnum.DOWN)?{head:t+8,direction:DirectionTypeEnum.DOWN}:a(t+8,DirectionTypeEnum.DOWN);case DirectionTypeEnum.DOWN:return o(t-10,DirectionTypeEnum.LEFT)?{head:t-10,direction:DirectionTypeEnum.LEFT}:a(t-10,DirectionTypeEnum.LEFT);case DirectionTypeEnum.LEFT:return o(t-8,DirectionTypeEnum.UP)?{head:t-8,direction:DirectionTypeEnum.UP}:a(t-8,DirectionTypeEnum.UP);default:return console.log("direction error"),{head:t,direction:e}}}function l(t){return 0>t||t>81?!1:!0}t.getDirection=e,t.getXOffset=i,t.getYOffset=n,t.getXYFromValue=r,t.checkHeadAndDirection=o,t.getGridByDirection=s,t.rotationPlane=a,t.gridValid=l}(MapUtil||(MapUtil={}));var NumUtil;!function(t){function e(t,e,i){void 0===i&&(i=!0);var n=Math.random()*(e-t);return t+(i?Math.floor(n):n)}t.range=e}(NumUtil||(NumUtil={}));var LoadingScene=function(t){function e(){var e=t.call(this)||this;return e.bg=new egret.Sprite,e.w=0,e.h=0,e.mySheet=RES.getRes("load"),console.log(e.mySheet),e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.w=egret.MainContext.instance.stage.stageWidth,this.h=egret.MainContext.instance.stage.stageHeight,this.bg.graphics.beginFill(3223857,1),this.bg.graphics.drawRect(0,0,this.w,this.h),this.bg.graphics.endFill(),this.bg.width=this.w,this.bg.height=this.h,this.addChild(this.bg),this.touchEnabled=!0,this.pgBg=new egret.Bitmap,this.pgBg.texture=this.mySheet.getTexture("pgBg"),this.pgBg.x=this.w/2,this.pgBg.y=this.h/2,this.pgBg.anchorOffsetX=this.pgBg.width/2,this.pgBg.anchorOffsetY=this.pgBg.height/2,this.addChild(this.pgBg),this.pgBar=new egret.Bitmap,this.pgBar.texture=this.mySheet.getTexture("pgBar"),this.pgBar.x=this.w/2-34,this.pgBar.y=this.h/2,this.pgBar.anchorOffsetX=this.pgBar.width/2,this.pgBar.anchorOffsetY=this.pgBar.height/2,this.addChild(this.pgBar),this.textField=new egret.TextField,this.textField.size=20,this.textField.textColor=16777215,this.textField.bold=!0,this.textField.stroke=1,this.textField.strokeColor=0,this.addChild(this.textField),this.textField.width=100,this.textField.x=this.w/2-this.textField.width/2,this.textField.y=this.h/2-this.textField.height/2-10,this.textField.textAlign="center",this.textField.text="0%"},e.prototype.onProgress=function(t,e){var i=Math.round(t/e*100);this.textField.text=i+"%",this.pgBar.width=282*(t/e)},e}(egret.Sprite);__reflect(LoadingScene.prototype,"LoadingScene",["RES.PromiseTaskReporter"]);var MineScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(MineScene.prototype,"MineScene");var AwayGameMsgView=function(t){function e(){var e=t.call(this)||this;return e.msgKey=["playerName","排名","城镇积分","可掠夺金币","被进攻次数","S率","摧毁炮数"],e.msgValue=["level","rank","city_score","gold_can_rob","attack_times","S_rate","success"],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.viewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.viewBg),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer);for(var t,e,i=0;i<this.msgKey.length;i++)t=new egret.TextField,t.text=this.getPlayerData(this.msgKey[i]),t.x=20+Math.floor(i%2)*AdaptSceenUtil.curWidth()/2,t.y=10+Math.floor(i/2)*t.height,e=t.width,this.addChild(t),t=new egret.TextField,t.text=this.getPlayerData(this.msgValue[i]),t.x=e+20+Math.floor(i%2)*AdaptSceenUtil.curWidth()/2,t.y=10+Math.floor(i/2)*t.height,this.addChild(t)},e.prototype.updateView=function(){},e.prototype.getPlayerData=function(t){return-1!==t.indexOf("msg")?this.opponentData[t]:t},e}(egret.Sprite);__reflect(AwayGameMsgView.prototype,"AwayGameMsgView");var AwayGridView=function(t){function e(e){var i=t.call(this,e)||this;return t.prototype.initView.call(i),i}return __extends(e,t),e.prototype.updateView=function(){this._touched,this._status===GridStatusEnum.COVER?this.gridView.texture=RES.getRes("cover_png"):this._status===GridStatusEnum.KNOWN?this.type===GridTypeEnum.HEAD||this.type===GridTypeEnum.BODY||this.type===GridTypeEnum.MISS:this._status===GridStatusEnum.SHOW?GameController.getInstance().type===GameTypeEnum.GAME_TYPE_MAPING?this._selected:GameController.getInstance().type===GameTypeEnum.GAME_TYPE_HITTING&&(this.type===GridTypeEnum.HEAD?this.gridView.texture=RES.getRes("head_png"):this.type===GridTypeEnum.BODY?this.gridView.texture=RES.getRes("body_png"):this.type===GridTypeEnum.MISS?this.gridView.texture=RES.getRes("miss_png"):this.type===GridTypeEnum.UNSET&&(this.gridView.texture=RES.getRes("cover_png"))):this._status===GridStatusEnum.UNSHOW},e.prototype.resetView=function(){this._status=GridStatusEnum.COVER,this._type=GridTypeEnum.MISS,this.gridView.texture=null,this.updateView()},Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"signType",{get:function(){return this._signType},set:function(t){this._signType=t},enumerable:!0,configurable:!0}),e}(GridView);__reflect(AwayGridView.prototype,"AwayGridView");var AwayScene=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.messageView=new AwayGameMsgView,this.messageView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.messageView),this.gameView=new GameView(!1),this.addChild(this.gameView),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.backButton),this.bulletControlView=new BulletControlView,this.bulletControlView.width=AdaptSceenUtil.curWidth(),this.bulletControlView.y=AdaptSceenUtil.curHeight()-this.bulletControlView.height,this.bulletControlView.visible=!1,SceneManager.getInstance().getUILayer().addChild(this.bulletControlView)},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toResultScene()},e.prototype.inAnimate=function(){this.bulletControlView.visible=!0,this.visible=!0},e.prototype.outAnimate=function(){this.bulletControlView.visible=!1,this.visible=!1},e.prototype.updateBullets=function(){this.bulletControlView.addNewBullet(),this.messageView.updateView()},e.prototype.resetGameView=function(){this.gameView.resetView(),this.bulletControlView.updateView(),this.messageView.updateView()},e.prototype.showGridView=function(t,e,i){void 0===i&&(i=GridStatusEnum.SHOW),this.gameView.gridList[t].status=i,this.gameView.gridList[t].type=e},e.prototype.showGameFinished=function(){},e}(egret.Sprite);__reflect(AwayScene.prototype,"AwayScene",["Scene"]);var BulletControlView=function(t){function e(){var e=t.call(this)||this;return e.bulletPool=[],e.bulletX=[],e.bulletY=[],e.bulletSize=[],e.controlViewBg=new egret.Bitmap,e.controlViewBg.texture=RES.getRes("control_bg_png"),e.controlViewBg.width=AdaptSceenUtil.curWidth(),e.addChild(e.controlViewBg),e.titleTextField=new egret.TextField,e.titleTextField.x=36,e.titleTextField.y=18,e.titleTextField.bold=!0,e.titleTextField.size=28,e.titleTextField.textAlign=egret.HorizontalAlign.CENTER,e.titleTextField.text=i18n.getInstance().getLanguage("ui_title_bullet"),e.addChild(e.titleTextField),e.bulletQueue=new egret.Sprite,e.addChild(e.bulletQueue),e.switchButton=new E8TextButton(e,RES.getRes("btn_purple_png"),e.switchTouched),e.switchButton.setButtonText(i18n.getInstance().getLanguage("ui_switch")),e.switchButton.x=300,e.switchButton.y=100,e.addChild(e.switchButton),e.switchButton.touchEnabled=!0,e.initPool(),e.updateView(),e}return __extends(e,t),e.prototype.switchTouched=function(t){BulletController.getInstance().switchBullet(),void 0===this.storedBullet?this.updateView(!0):this.updateView(!1)},e.prototype.initPool=function(){for(var t,e=0;5>e;e++)t=new BulletView,this.bulletPool.push(t)},e.prototype.addNewBullet=function(){this.updateView(!0)},e.prototype.updateView=function(t){void 0===t&&(t=!0),this.bulletQueue.removeChildren();for(var e=BulletController.getInstance().bullets,i=0;i<e.length;i++){var n=this.getNoUsedBulletFromPool();n.type=e[i],n.y=120,t?(n.x=170-150*i,egret.Tween.get(n).to({x:n.x+150},500)):n.x=320-150*i,this.bulletQueue.addChild(n)}null!==BulletController.getInstance().stored&&(this.storedBullet=this.getNoUsedBulletFromPool(),this.storedBullet.type=BulletController.getInstance().stored,this.storedBullet.x=490,this.bulletQueue.addChild(this.storedBullet))},e.prototype.initPrepare=function(){this.preparedBullet=this.getNoUsedBulletFromPool(),this.addChild(this.preparedBullet)},e.prototype.prepareNextBullet=function(){},e.prototype.getNoUsedBulletFromPool=function(){for(var t=0;t<this.bulletPool.length;t++)if(null===this.bulletPool[t].parent)return this.bulletPool[t];return null},e}(egret.Sprite);__reflect(BulletControlView.prototype,"BulletControlView");var BulletHead=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e.prototype.setName=function(t){this.playerName=t},e}(egret.Sprite);__reflect(BulletHead.prototype,"BulletHead");var BulletView=function(t){function e(){var e=t.call(this)||this;return e.used=!1,e._type=BulletTypeEnum.MISSILE,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.head=new BulletHead,this.view=new egret.Bitmap,this.addChild(this.view),this.anchorOffsetX=this.view.width/2,this.anchorOffsetY=this.view.height/2,this.typeTextField=new egret.TextField,this.typeTextField.anchorOffsetX=this.typeTextField.width,this.typeTextField.anchorOffsetY=this.typeTextField.height,this.addChild(this.typeTextField)},e.prototype.updateView=function(){this.view.texture=RES.getRes("bullet_png"),this.typeTextField.text=this._type.toString()},Object.defineProperty(e.prototype,"type",{set:function(t){this._type=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{set:function(t){this._status=t,this.updateView()},enumerable:!0,configurable:!0}),e.prototype.setUsed=function(){this.used=!0},e.prototype.setBulletHeadUserName=function(t){this.head.name=t},e}(egret.Sprite);__reflect(BulletView.prototype,"BulletView");var ResultPanel=function(t){function e(){var e=t.call(this)||this;return t.prototype.initView.call(e),e.setContent(),e}return __extends(e,t),e.prototype.setContent=function(){this.title=new egret.Bitmap,this.title.texture=RES.getRes("result_success_png"),this.title.anchorOffsetX=this.title.width/2,this.addChild(this.title),this.share_btn=new E8Button(this,RES.getRes("build_button_png"),this.shareResult),this.share_btn.x=0,this.share_btn.y=0,this.addChild(this.share_btn),this.city_btn=new E8Button(this,RES.getRes("build_button_png"),this.toCityScene),this.city_btn.x=200,this.city_btn.y=0,this.addChild(this.city_btn)},e.prototype.updateView=function(){},e.prototype.toCityScene=function(){SceneManager.getInstance().toCityScene()},e.prototype.shareResult=function(){},e}(Panel);__reflect(ResultPanel.prototype,"ResultPanel");var AirPort=function(t){function e(e){void 0===e&&(e=1);var i=t.call(this)||this;return i.touchEnabled=!0,i.update(RES.getRes("city1_sheet").getTexture("building1_"+e)),i}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(AirPort.prototype,"AirPort");var Bank=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Bank.prototype,"Bank");var BuildingListView=function(t){function e(){var e=t.call(this)||this;e.buildingList=[e.airport,e.bank,e.gasStation,e.scenery,e.science],e.buildings=[1,1,1,1,1],e.scrollView=new egret.ScrollView,e.scrollView.x=0,e.scrollView.y=0,e.addChild(e.scrollView),e.airport=new AirPort,e.airport.x=-960,e.bank=new Bank,e.gasStation=new GasStation,e.scenery=new Scenery,e.science=new Science,e.airport.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onAirPortTouched,e),e.bank.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onBankTouched,e),e.gasStation.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGasStationTouched,e),e.scenery.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onSceneryTouched,e),e.science.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onScienceTouched,e);var i=new egret.Sprite;return i.addChild(e.airport),i.addChild(e.bank),i.addChild(e.gasStation),i.addChild(e.scenery),i.addChild(e.science),e.scrollView.setContent(i),e}return __extends(e,t),e.prototype.update=function(){},e.prototype.levelUPBuilding=function(t){},e.prototype.onAirPortTouched=function(t){SceneManager.getInstance().openBuildingPop(1)},e.prototype.onBankTouched=function(t){},e.prototype.onGasStationTouched=function(t){},e.prototype.onSceneryTouched=function(t){},e.prototype.onScienceTouched=function(t){},e}(egret.Sprite);__reflect(BuildingListView.prototype,"BuildingListView");var BuildingPop=function(t){function e(e){var i=t.call(this)||this;return i.buildingId=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e.prototype.setBuildingId=function(t){this.buildingId=t},e}(egret.Sprite);__reflect(BuildingPop.prototype,"BuildingPop");var CityControlView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlContainer=new egret.Sprite,this.addChild(this.controlContainer)},e.prototype.renderControlView=function(t){switch(t.id){case BuildingEnum.UNSET:this.renderGroundControl();break;case BuildingEnum.AIRPORT:this.renderAirportControl();break;case BuildingEnum.BANK:this.renderBankControl();break;case BuildingEnum.BULLET_SCIENCE:this.renderScience();break;case BuildingEnum.GAS_STATION:this.renderStation();break;case BuildingEnum.DEFENSE:this.renderDefense();break;case BuildingEnum.INSURE_COMPANY:this.renderInsure();break;case BuildingEnum.REPAIR_FACTORY:this.renderRepair();break;default:this.renderGroundControl()}},e.prototype.updateView=function(){},e.prototype.renderGroundControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new GroundControlView)},e.prototype.renderAirportControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new AirportControlView)},e.prototype.renderBankControl=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new BankControlView)},e.prototype.renderScience=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new ScienceControlView)},e.prototype.renderStation=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new StationControlView)},e.prototype.renderRepair=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new FactoryControlView)},e.prototype.renderInsure=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new CompanyControlView)},e.prototype.renderDefense=function(){this.controlContainer.removeChildren(),this.controlContainer.addChild(new DefenseControlView)},e}(egret.Sprite);__reflect(CityControlView.prototype,"CityControlView");var CityMessageView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.addChild(this.viewBg),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer),this.renderAirportMsg()},e.prototype.updateView=function(){},e.prototype.renderBanner=function(){},e.prototype.renderPosition=function(t){switch(t.id){case BuildingEnum.AIRPORT:this.renderAirportMsg();break;case BuildingEnum.BANK:this.renderBankMsg();break;case BuildingEnum.BULLET_SCIENCE:this.renderScience();break;case BuildingEnum.GAS_STATION:this.renderStation();break;case BuildingEnum.INSURE_COMPANY:this.renderCompany();break;case BuildingEnum.DEFENSE:this.renderDefense();break;case BuildingEnum.REPAIR_FACTORY:this.renderFactory()}},e.prototype.renderAirportMsg=function(){this.msgContainer.removeChildren();var t=CityController.getInstance().getTopLevel(BuildingEnum.AIRPORT),e=BuildingDataCache.getInstance().getAirportDataByLevel(t),i=new egret.TextField;i.text=i18n.getInstance().getLanguage(e.name),i.x=10,this.addChild(i);var n=new egret.TextField;n.text=i18n.getInstance().getLanguage("ui_level")+t,n.x=10+i.width+100,this.msgContainer.addChild(n);var r=(new egret.TextField,new egret.TextField);r.text=i18n.getInstance().getLanguage(e.desc),r.x=10,r.y=i.height,r.width=this.viewBg.width-40,r.multiline=!0,this.addChild(r);new egret.TextField},e.prototype.renderBankMsg=function(){this.msgContainer.removeChildren();var t=(CityController.getInstance().getBuildingBlockByType(BuildingEnum.BANK),1),e=BuildingDataCache.getInstance().getAirportDataByLevel(t),i=new egret.TextField;i.text=i18n.getInstance().getLanguage(e.name),this.addChild(i);var n=new egret.TextField;n.text="等级"+t.toString(),n.y=i.height,this.msgContainer.addChild(n);CityController.getInstance().getBuildingNum(BuildingEnum.BANK)},e.prototype.renderScience=function(){this.msgContainer.removeChildren()},e.prototype.renderFactory=function(){this.msgContainer.removeChildren()},e.prototype.renderCompany=function(){this.msgContainer.removeChildren()},e.prototype.renderDefense=function(){this.msgContainer.removeChildren()},e.prototype.renderStation=function(){this.msgContainer.removeChildren()},e}(egret.Sprite);__reflect(CityMessageView.prototype,"CityMessageView");var CityScene=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.cityMsgView=new CityMessageView,this.cityMsgView.anchorOffsetX=this.cityMsgView.width/2,this.cityMsgView.x=AdaptSceenUtil.curWidth()/2,this.cityMsgView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.cityMsgView),this.cityView=new CityView,this.cityView.touchChildren=!0,this.cityView.touchEnabled=!0,this.addChild(this.cityView),this.cityControl=new CityControlView,this.cityControl.width=AdaptSceenUtil.curWidth(),this.cityControl.x=0,this.cityControl.y=AdaptSceenUtil.curHeight()-280,this.cityControl.touchEnabled=!0,this.cityControl.visible=!1,SceneManager.getInstance().getUILayer().addChild(this.cityControl)},e.prototype.inAnimate=function(){this.cityControl.visible=!0,this.cityView.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onToCityScene,this),this.visible=!0},e.prototype.outAnimate=function(){this.cityControl.visible=!1,this.visible=!1,this.cityView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onToCityScene,this)},e.prototype.onToCityScene=function(t){SceneManager.getInstance().toCityScene()},e.prototype.selectPosition=function(t,e){this.cityView.updateSelected(e),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.build=function(t){this.cityView.build(t),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.demolish=function(t){this.cityView.demolish(),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e.prototype.levelupBuilding=function(t){this.cityView.levelUp(),this.cityMsgView.renderPosition(t),this.cityControl.renderControlView(t)},e}(egret.Sprite);__reflect(CityScene.prototype,"CityScene",["Scene"]);var CityView=function(t){function e(){var e=t.call(this)||this;return e.addSequence=[6,1,5,0,2,4,3],e.groundX=[0,100,200,100,-100,-200,-100],e.groundY=[0,-180,0,180,180,0,-180],e.groundList=new Array,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.currentSelect=null;var t;this.groundList.length=7,this.centerX=AdaptSceenUtil.curWidth()/2,this.centerY=AdaptSceenUtil.curHeight()/2;for(var e=CityController.getInstance().getBuildings(),i=0;i<this.addSequence.length;i++)t=new Ground(this.addSequence[i]),t.x=this.centerX+this.groundX[this.addSequence[i]],t.y=this.centerY+this.groundY[this.addSequence[i]],t.touchEnabled=!0,this.addChild(t),this.groundList[this.addSequence[i]]=t,null!==e[this.addSequence[i]]&&t.setBuilding(e[this.addSequence[i]].id,e[this.addSequence[i]].level);this.anchorOffsetX=this.centerX,this.anchorOffsetY=this.centerY,this.x=AdaptSceenUtil.curWidth()/2,this.y=AdaptSceenUtil.curHeight()/2,this.addBuildingTouchEventListener()},e.prototype.addBuildingTouchEventListener=function(){for(var t=0;t<this.groundList.length;t++)this.groundList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.groundTouched,this),this.groundList[t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groundTouchBegin,this)},e.prototype.removeBuildingTouchEventListener=function(){for(var t=0;t<this.groundList.length;t++)this.groundList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.groundTouched,this),this.groundList[t].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.groundTouchBegin,this)},e.prototype.updateView=function(t){var e=CityController.getInstance().getBuildings();this.groundList[t].setBuilding(e[t].id,e[t].level)},e.prototype.groundTouchBegin=function(t){this.removeBuildingTouchEventListener(),this.longTouchTime=(new Date).getTime();var e=t.target;this.currentLongTouch=e,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},e.prototype.touchMove=function(t){},e.prototype.touchEnd=function(t){this.addBuildingTouchEventListener();var e=(new Date).getTime();e-this.longTouchTime<1500||(this.closeUp(this.currentLongTouch.position),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this))},e.prototype.groundTouched=function(t){var e=t.target;this.currentSelect!==e.position&&CityController.getInstance().selectPosition(e.position)},e.prototype.closeUp=function(t){egret.Tween.get(this,{loop:!1}).to({x:this.centerX-2*this.groundX[t],y:this.centerY-2*this.groundY[t],scaleX:2,scaleY:2},1500)},e.prototype.updateSelected=function(t){null!==this.currentSelect&&(this.groundList[this.currentSelect].selected=!1),this.currentSelect=t,this.groundList[t].selected=!0},e.prototype.build=function(t){this.groundList[this.currentSelect].setBuilding(t.id,1)},e.prototype.demolish=function(){this.groundList[this.currentSelect].demolish()},e.prototype.levelUp=function(){this.groundList[this.currentSelect].levelUp()},e}(egret.Sprite);__reflect(CityView.prototype,"CityView");var GasStation=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(GasStation.prototype,"GasStation");var Ground=function(t){function e(e){var i=t.call(this)||this;return i._position=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.bgView=new egret.Bitmap,this.bgView.texture=RES.getRes("ground_png"),this.bgView.anchorOffsetX=this.bgView.width/2,this.bgView.anchorOffsetY=this.bgView.height/2,this.addChild(this.bgView),this.buildingView=new egret.MovieClip,this.buildingView.touchEnabled=!1,this.buildingView.stop()},e.prototype.updateView=function(){-1===this.buildingId},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),e.prototype.setBuilding=function(t,e){if(-1!==t&&(this.buildingId!==t||this.buildingLevel!==e)){if(t!==this.buildingId){var i=BuildingEnum.buildingString[t],n=RES.getRes(i+"_json"),r=RES.getRes(i+"_png");this.mcFactory=new egret.MovieClipDataFactory(n,r),this.buildingView.movieClipData=this.mcFactory.generateMovieClipData(i),this.addChild(this.buildingView)}this.buildingId=t,this.buildingLevel=e,this.updateView()}},e.prototype.levelUp=function(){this.buildingLevel++,this.updateView()},e.prototype.demolish=function(){this.buildingId=-1,this.buildingLevel=0,this.buildingView.movieClipData=null,this.buildingView.gotoAndStop(1),this.contains(this.buildingView)&&this.removeChild(this.buildingView)},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"id",{get:function(){return this.buildingId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.buildingLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{set:function(t){this._selected=t,t?DrawUtil.setImageColor(this.bgView,14496733):DrawUtil.setImageColor(this.bgView,16777215)},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Ground.prototype,"Ground");var RankButtom=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){},e.prototype.updateView=function(){},e}(egret.Sprite);__reflect(RankButtom.prototype,"RankButtom");var Scenery=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Scenery.prototype,"Scenery");var Science=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.texture=t},e}(egret.Bitmap);__reflect(Science.prototype,"Science");var BankControlView=function(t){function e(){var e=t.call(this)||this;return e.initBankView(),e}return __extends(e,t),e.prototype.initBankView=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.rewardList=new Array;for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(BankControlView.prototype,"BankControlView");var BannerControlView=function(t){function e(){var e=t.call(this)||this;return e.initBankView(),e}return __extends(e,t),e.prototype.initBankView=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.rewardList=new Array;
for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(BannerControlView.prototype,"BannerControlView");var GuideController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){SaveDataManager.getInstance().getGuide()},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.isNew=function(){return!0},t.prototype.dropPlaneGuide=function(){},t.prototype.hitPlaneGuide=function(){},t.instance=null,t}();__reflect(GuideController.prototype,"GuideController");var BuildingView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.nameText=new egret.TextField,this.addChild(this.nameText),this.levelText=new egret.TextField,this.levelText.x=this.bg.width-20,this.addChild(this.levelText),[2]})})},e.prototype.updateData=function(){},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t,this.nameText.text=this._name,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t,this.levelText.text=this._level.toString(),this.updateData()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BuildingView.prototype,"BuildingView");var CompanyControlView=function(t){function e(){var e=t.call(this)||this;return e.initInsure(),e}return __extends(e,t),e.prototype.initInsure=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.buildingContainer=new egret.Sprite,this.buildingList=new Array;for(var t,e=0;e<CityController.getInstance().getBuildings().length;e++)0!==CityController.getInstance().getBuildings()[e].level&&(t=new BuildingView,t.touchEnabled=!0,t.name=i18n.getInstance().getLanguage(CityController.getInstance().getBuildings()[e].name),t.level=CityController.getInstance().getBuildings()[e].level,t.x=200*this.buildingList.length,this.buildingList.push(t),this.buildingContainer.addChild(t));this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.buildingContainer),this.addChild(this.scrollView)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(CompanyControlView.prototype,"CompanyControlView");var DefenseControlView=function(t){function e(){var e=t.call(this)||this;return e.initDefense(),e}return __extends(e,t),e.prototype.initDefense=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(DefenseControlView.prototype,"DefenseControlView");var FactoryControlView=function(t){function e(){var e=t.call(this)||this;return e.initFactoryView(),e}return __extends(e,t),e.prototype.initFactoryView=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.buildingContainer=new egret.Sprite,this.buildingList=new Array;for(var t,e=0;e<CityController.getInstance().getBuildings().length;e++)0!==CityController.getInstance().getBuildings()[e].level&&(t=new BuildingView,t.touchEnabled=!0,t.name=i18n.getInstance().getLanguage(CityController.getInstance().getBuildings()[e].name),t.level=CityController.getInstance().getBuildings()[e].level,t.x=200*this.buildingList.length,this.buildingList.push(t),this.buildingContainer.addChild(t));this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.buildingContainer),this.addChild(this.scrollView)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(FactoryControlView.prototype,"FactoryControlView");var GroundControlView=function(t){function e(){var e=t.call(this)||this;return e.buildingViewList=[null],e.intiView(),e}return __extends(e,t),e.prototype.intiView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.controlViewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.controlViewBg),this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text="新建筑",this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.buildingContainer=new egret.Sprite;for(var t,e,i=1;i<BuildingEnum.count;i++)t=BuildingDataCache.getInstance().getBuildingByIdAndLevel(i,1),e=new egret.Bitmap,e.texture=RES.getRes(t.view),e.scaleX=e.scaleY=.5,e.y=0,e.x=300*(i-1),e.touchEnabled=!0,this.buildingViewList.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuild,this),this.buildingContainer.addChild(e);this.scrollView.width=AdaptSceenUtil.curWidth(),this.scrollView.height=236,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.buildingContainer),this.addChild(this.scrollView)},e.prototype.onBuild=function(t){var e=t.target,i=this.buildingViewList.indexOf(e);CityController.getInstance().buildBuilding(i)},e.prototype.onBackButtonTouched=function(){},e}(egret.Sprite);__reflect(GroundControlView.prototype,"GroundControlView");var ScienceControlView=function(t){function e(){var e=t.call(this)||this;return e.initScieneView(),e}return __extends(e,t),e.prototype.initScieneView=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.rewardList=new Array;for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(ScienceControlView.prototype,"ScienceControlView");var StationControlView=function(t){function e(){var e=t.call(this)||this;return e.initStation(),e}return __extends(e,t),e.prototype.initStation=function(){this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),console.log(this.titleTextField.text),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton)},e.prototype.onBackButtonTouched=function(){},e}(BuildingControlView);__reflect(StationControlView.prototype,"StationControlView");var AirportControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.OPPONENT_STATUS=1,e.initAirport(),e}return __extends(e,t),e.prototype.initAirport=function(){this.demolishButton.visible=!1,this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text=i18n.getInstance().getLanguage(CityController.getInstance().selectedData().name),this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.oppoController=new egret.Sprite,this.opponentList=new Array;for(var t,e=AIController.getInstance().randomOpponent(),i=0;i<e.length;i++)t=new OpponentView,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedOpponent,this),t.x=200*i,t.level=e[i],this.oppoController.addChild(t),this.opponentList.push(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.oppoController),this.addChild(this.scrollView),this.awayButton=new E8TextButton(this,RES.getRes("btn_yellow_png"),this.onToAwayScene),this.awayButton.scale(.8,.5),this.awayButton.setButtonText(i18n.getInstance().getLanguage("ui_attack")),this.awayButton.x=10,this.awayButton.y=50,this.addChild(this.awayButton),this.placingButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.onToPlacingScene),this.placingButton.scale(.8,.5),this.placingButton.setButtonText(i18n.getInstance().getLanguage("ui_placing")),this.placingButton.x=200,this.placingButton.y=50,this.addChild(this.placingButton),this.refreshButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.onRefreshButtonTouched),this.refreshButton.scale(.8,.5),this.refreshButton.setButtonText(i18n.getInstance().getLanguage("ui_refresh")),this.refreshButton.x=200,this.refreshButton.y=50,this.addChild(this.refreshButton),this.updateView()},e.prototype.updateView=function(){this.status===this.OPPONENT_STATUS?(this.placingButton.visible=!1,this.awayButton.visible=!1,this.scrollView.visible=!0,this.backButton.visible=!0,this.levelUpButton.visible=!1,this.refreshButton.visible=!0):(this.placingButton.visible=!0,this.awayButton.visible=!0,this.scrollView.visible=!1,this.backButton.visible=!1,this.levelUpButton.visible=!0,this.refreshButton.visible=!1)},e.prototype.onToPlacingScene=function(t){GameController.getInstance().startPlacingGame(),SceneManager.getInstance().toPlacingScene()},e.prototype.onToAwayScene=function(t){this.status=this.OPPONENT_STATUS,this.updateView()},e.prototype.onSelectedOpponent=function(t){var e=t.target;GameController.getInstance().resetAwayGame(e.level),SceneManager.getInstance().toAwayScene()},e.prototype.onBackButtonTouched=function(){this.status===this.OPPONENT_STATUS&&(this.status=this.INIT_STATUS,this.updateView())},e.prototype.onRefreshButtonTouched=function(){for(var t,e=AIController.getInstance().randomOpponent(),i=0;i<e.length;i++)this.opponentList.length>=i?this.opponentList[i].level=e[i]:(t=new OpponentView,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedOpponent,this),t.x=200*i,t.level=e[i],this.oppoController.addChild(t),this.opponentList.push(t))},e}(BuildingControlView);__reflect(AirportControlView.prototype,"AirportControlView");var OpponentView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.levelText=new egret.TextField,this.addChild(this.levelText),[2]})})},e.prototype.updateData=function(){var t=AIController.getInstance().makeOpponenetDataByLevel(this._level);this.levelText.text=t.level},Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t,this.updateData()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(OpponentView.prototype,"OpponentView");var GameView=function(t){function e(e,i,n){void 0===e&&(e=!1),void 0===i&&(i=null),void 0===n&&(n=!0);var r=t.call(this)||this;return r.gridList=[],r.letters=["A","B","C","D","E","F","G","H","I"],r.numbers=["1","2","3","4","5","6","7","8","9"],r.rowTags=[],r.colTags=[],r.showAll=e,r.showTags=n,null!==i?r.initWithData(i):r.initView(),r}return __extends(e,t),e.prototype.initWithData=function(t){for(var e,i=0;81>i;i++){var n=i%9,r=Math.floor(i/9);this.showAll?(e=new PlacingGridView(i),null!==t&&e.setPlane(t[i].index,t[i].gridType,t[i].bodyType,t[i].direction)):e=new AwayGridView(i),e.x=60*n,e.y=60*r,this.addGridEventListener(e),this.addChild(e),this.gridList.push(e)}this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=AdaptSceenUtil.curWidth()/2,this.y=AdaptSceenUtil.curHeight()/2,this.showTags&&this.addTags()},e.prototype.updateWithData=function(t){for(var e=0;81>e;e++)this.gridList[e].setPlane(t[e].index,t[e].gridType,t[e].bodyType,t[e].direction),this.gridList[e].updateView()},e.prototype.initView=function(){for(var t,e=0;81>e;e++){var i=e%9,n=Math.floor(e/9);t=this.showAll?new PlacingGridView(e):new AwayGridView(e),t.x=60*i,t.y=60*n,this.addGridEventListener(t),this.addChild(t),this.gridList.push(t)}this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=AdaptSceenUtil.curWidth()/2,this.y=AdaptSceenUtil.curHeight()/2,this.showTags&&this.addTags()},e.prototype.addTags=function(){for(var t,e=0;9>e;e++)t=DrawUtil.textFilter(this.numbers[e],36,!1),t.x=60*e+30,t.y=-30,this.colTags.push(t),this.addChild(t),t=DrawUtil.textFilter(this.letters[e],36,!1),t.x=-30,t.y=60*e+30,this.rowTags.push(t),this.addChild(t)},e.prototype.addGridEventListener=function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouched,this),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchRelease,this)},e.prototype.resetView=function(){for(var t=0;81>t;t++)this.gridList[t].resetView()},e.prototype.updateView=function(){for(var t=0;81>t;t++)this.gridList[t].updateView()},e.prototype.updateTags=function(){for(var t=0;9>t;t++)DrawUtil.setImageColor(this.colTags[t],16777215),DrawUtil.setImageColor(this.rowTags[t],16777215)},e.prototype.onTouched=function(t){var e=t.target;PlayerHandleController.getInstance().playerTouchedGameView(e.id)},e.prototype.onTouchBegin=function(t){this.updateTags();var e=t.target,i=MapUtil.getXYFromValue(e.id).x,n=MapUtil.getXYFromValue(e.id).y;DrawUtil.setImageColor(this.colTags[i],16711680),DrawUtil.setImageColor(this.rowTags[n],16711680),PlayerHandleController.getInstance().playerBeginMoveInGameView(e.id,t)},e.prototype.onTouchMove=function(t){var e=t.target;this.updateTags();var i=MapUtil.getXYFromValue(e.id).x,n=MapUtil.getXYFromValue(e.id).y;DrawUtil.setImageColor(this.colTags[i],16711680),DrawUtil.setImageColor(this.rowTags[n],16711680),PlayerHandleController.getInstance().playerMovingInGameView(e.id,t)},e.prototype.onTouchEnd=function(t){var e=t.target;this.updateTags(),PlayerHandleController.getInstance().playerReleaseOnGameView(e.id,t)},e.prototype.onTouchRelease=function(t){t.target},e.prototype.onTouchCancel=function(t){},e}(egret.Sprite);__reflect(GameView.prototype,"GameView");var PlacingController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.init=function(){},t.prototype.randomMap=function(){SceneManager.getInstance().placingScene.resetView();for(var t=AIController.getInstance().generateRandomMap(),e=t.getHeadList(),i=0,n=0;n<e.length;n++)i++,SceneManager.getInstance().placingScene.addOnePlane(i,e[n].head,e[n].direction);SceneManager.getInstance().placingScene.planeAmount=i},t.prototype.selectedSharedMap=function(t){SceneManager.getInstance().placingScene.resetView();var e=0;t.headData.forEach(function(t){e++,SceneManager.getInstance().placingScene.addOnePlane(e,t.head,t.direction)}),SceneManager.getInstance().placingScene.planeAmount=3},t.prototype.addOnePlane=function(){},t.prototype.getHomeMapData=function(t){return this.homeMapData.map[t].gridType},t.prototype.setHomeMapData=function(t,e){this.homeMapData.map[t].gridType=e},t.instance=null,t}();__reflect(PlacingController.prototype,"PlacingController");var AlertPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(AlertPop.prototype,"AlertPop");var BackGround=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=this;this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("bg_png"),this.bg.width=AdaptSceenUtil.curWidth(),this.bg.height=AdaptSceenUtil.curHeight(),DrawUtil.setImageColor(this.bg,ColorEnum.BLUE),this.addChild(this.bg),this.clouds=new egret.Sprite,this.addChild(this.clouds);for(var e,i=0;5>i;i++)e=new egret.Bitmap,e.texture=RES.getRes("cloud"+Math.floor(3*Math.random()+1)+"_png"),e.x=Math.random()*AdaptSceenUtil.curWidth()+AdaptSceenUtil.curWidth(),e.y=Math.random()*AdaptSceenUtil.curHeight(),this.clouds.addChild(e),egret.Tween.get(this.clouds).to({x:-150},2e3);egret.Tween.get(this.bg,{loop:!0}).wait(5e3).call(function(){DrawUtil.setImageColor(t.bg,ColorEnum.colorList[NumUtil.range(0,ColorEnum.colorList.length)])})},e}(egret.Sprite);__reflect(BackGround.prototype,"BackGround");var FlippyTip=function(t){function e(e){var i=t.call(this)||this;return i.contentText=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Bitmap;t.texture=RES.getRes("tip_bg_png"),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,this.addChild(t);var e=DrawUtil.textFilter(this.contentText);this.addChild(e)},e}(egret.Sprite);__reflect(FlippyTip.prototype,"FlippyTip");var GoldFrame=function(t){function e(e){var i=t.call(this)||this;return i._amount=0,i.targetNumber=0,i._type=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){this.scrolling=!1,this.frameBg=new egret.Bitmap,this.frameBg.texture=RES.getRes("frame_png"),this.frameBg.x=0,this.frameBg.y=0,this.addChild(this.frameBg),this.goldIcon=new egret.Bitmap,this.goldIcon.texture=RES.getRes(this._type+"_png"),this.goldIcon.x=0,this.goldIcon.y=0,this.addChild(this.goldIcon),this.amountText=new egret.TextField,this.amountText.text="0",this.amountText.x=this.goldIcon.width+10,this.amountText.y=10,this.amountText.width=80,this.amountText.textAlign=egret.HorizontalAlign.RIGHT,this.addChild(this.amountText)},Object.defineProperty(e.prototype,"amount",{set:function(t){this.scrolling===!1&&(this.targetNumber=t,this.scrolling=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.scrollToAmount,this))},enumerable:!0,configurable:!0}),e.prototype.scrollToAmount=function(t){this._amount<this.targetNumber&&this.scrolling===!0?(this._amount+=33,this.updateView()):(this.removeEventListener(egret.Event.ENTER_FRAME,this.scrollToAmount,this),this._amount=this.targetNumber,this.scrolling=!1,this.updateView())},e.prototype.updateView=function(){this.amountText.text=this._amount.toString()},e}(egret.Sprite);__reflect(GoldFrame.prototype,"GoldFrame");var HeadUI=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.goldHead=new GoldFrame("gold"),this.goldHead.x=80,this.goldHead.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.goldHead),this.gasHead=new GoldFrame("gas"),this.gasHead.x=272,this.gasHead.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.gasHead)},Object.defineProperty(e.prototype,"GoldHead",{get:function(){return this.goldHead},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GasHead",{get:function(){return this.gasHead},enumerable:!0,configurable:!0}),e.prototype.setGold=function(t){this.goldHead.amount=t},e.prototype.setGas=function(t){this.gasHead.amount=t},e}(egret.Sprite);__reflect(HeadUI.prototype,"HeadUI");var PlayerHandleController=function(){function t(){if(t.instance)throw new Error("AIController singlon error");this.init()}return t.prototype.init=function(){},t.getInstance=function(){return null===this.instance&&(this.instance=new t),this.instance},t.prototype.isHitGaming=function(){return GameTypeEnum.GAME_TYPE_HITTING===GameController.getInstance().type},t.prototype.isDoubleHitting=function(){return GameTypeEnum.GAME_TYPE_DOUBLE_HITTING===GameController.getInstance().type},t.prototype.isPlacing=function(){return GameTypeEnum.GAME_TYPE_MAPING===GameController.getInstance().type},t.prototype.playerTouchedGameView=function(t){this.isHitGaming()?GameController.getInstance().isAttackPhase&&GameController.getInstance().hitGrid(t,BulletController.getInstance().useBullet()):this.isDoubleHitting()||this.isPlacing()&&SceneManager.getInstance().placingScene.rotationPlane(t)},t.prototype.playerBeginMoveInGameView=function(t,e){this.isHitGaming()&&GameController.getInstance().isAttackPhase?this.headGridId=t:SceneManager.getInstance().placingScene.selectOneGrid(t)},t.prototype.playerMovingInGameView=function(t,e){this.isHitGaming()&&GameController.getInstance().isAttackPhase||SceneManager.getInstance().placingScene.movingOnePlane(t,e)},t.prototype.playerReleaseOnGameView=function(t,e){this.isHitGaming()||SceneManager.getInstance().placingScene.releaseOnePlane(t,e)},t.instance=null,t}();__reflect(PlayerHandleController.prototype,"PlayerHandleController");var MiniGameView=function(t){function e(e){var i=t.call(this)||this;return i.headData=e,i.initView(),i}return __extends(e,t),e.prototype.initView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg),this.mapData=new MapData,[4,this.initData()];case 1:return t.sent(),console.log(this.mapData.map),this.gameView=new GameView(!0,this.mapData.map,!1),this.gameView.anchorOffsetX=this.gameView.width/2,this.gameView.anchorOffsetY=this.gameView.height/2,this.gameView.scaleX=160/630,this.gameView.scaleY=160/630,this.gameView.x=this.bg.width/2,this.gameView.y=this.bg.height/2-5,this.addChild(this.gameView),this.gameView.touchEnabled=!1,this.gameView.touchChildren=!1,this.gameView.cacheAsBitmap=!0,[2]}})})},e.prototype.initData=function(){for(var t=0;t<this.headData.length;t++)this.mapData.setPlaneGridByHead(this.headData[t].head,this.headData[t].direction)},e.prototype.updateData=function(){},e}(egret.Sprite);__reflect(MiniGameView.prototype,"MiniGameView");var PlacingControlView=function(t){function e(){var e=t.call(this)||this;return e.INIT_STATUS=0,e.HISTORY_STATUS=1,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.controlViewBg.width=AdaptSceenUtil.curWidth(),this.addChild(this.controlViewBg),this.shareButton=new E8TextButton(this,RES.getRes("btn_green_png"),this.shareButtonTouched),this.shareButton.setButtonText("分享此地图"),this.shareButton.touchEnabled=!0,this.shareButton.anchorOffsetX=this.shareButton.width/2,this.shareButton.anchorOffsetY=this.shareButton.height/2,this.shareButton.x=AdaptSceenUtil.curWidth()/2+40,this.shareButton.y=100,this.addChild(this.shareButton),this.randomButton=new E8TextButton(this,RES.getRes("btn_purple_png"),this.onRandomButtonTouched),this.randomButton.setButtonText("随机"),this.randomButton.touchEnabled=!0,this.randomButton.x=AdaptSceenUtil.curWidth()-this.randomButton.width,this.randomButton.y=100,this.addChild(this.randomButton),this.historyButton=new E8TextButton(this,RES.getRes("btn_yellow_png"),this.onHistoryButtonTouched),this.historyButton.setButtonText("分享历史"),this.historyButton.touchEnabled=!0,this.historyButton.x=AdaptSceenUtil.curWidth()/2-this.randomButton.width,this.historyButton.y=100,this.addChild(this.historyButton),this.titleTextField=new egret.TextField,this.titleTextField.x=36,this.titleTextField.y=18,this.titleTextField.bold=!0,this.titleTextField.size=28,this.titleTextField.textAlign=egret.HorizontalAlign.CENTER,this.titleTextField.text="我的飞机图",this.addChild(this.titleTextField),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=0,this.backButton.visible=!1,this.addChild(this.backButton),this.scrollView=new egret.ScrollView,this.mapController=new egret.Sprite,this.mapList=new Array;for(var t,e=0;5>e;e++)t=new MiniGameView([{head:34,direction:1},{head:49,direction:1},{head:21,direction:1}]),t.x=200*e,this.mapController.addChild(t),this.mapList.push(t),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mapTouched,this);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.mapController),this.addChild(this.scrollView),this.newMapButton=new E8Button(this,RES.getRes("new_map"),this.onRandomButtonTouched),this.newMapButton.y=0,this.addChild(this.newMapButton),this.updateView()},e.prototype.mapTouched=function(t){var e=t.target;PlacingController.getInstance().selectedSharedMap(e)},e.prototype.updateView=function(){this.status===this.HISTORY_STATUS?(this.shareButton.visible=!1,this.randomButton.visible=!1,this.historyButton.visible=!1,this.scrollView.visible=!0,this.newMapButton.visible=!0,this.backButton.visible=!0):(this.shareButton.visible=!0,this.randomButton.visible=!0,this.historyButton.visible=!0,this.scrollView.visible=!1,this.newMapButton.visible=!1,this.backButton.visible=!1)},e.prototype.shareButtonTouched=function(){},e.prototype.onRandomButtonTouched=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return SceneManager.getInstance().placingScene.resetView(),PlacingController.getInstance().randomMap(),[2]})})},e.prototype.onHistoryButtonTouched=function(){this.status=this.HISTORY_STATUS,this.updateView()},e.prototype.onBackButtonTouched=function(){this.status===this.HISTORY_STATUS&&(this.status=this.INIT_STATUS,this.updateView())},e}(egret.Sprite);__reflect(PlacingControlView.prototype,"PlacingControlView");var PlacingGridView=function(t){function e(e){var i=t.call(this,e)||this;return i._bodyType=BodyGridEnum.UNSET,i._direction=DirectionTypeEnum.UNSET,i._planeIndex=0,i.helpView=new egret.Bitmap,i.helpView.width=60,i.helpView.height=60,i.helpView.texture=RES.getRes("help_png"),i.addChild(i.helpView),i}return __extends(e,t),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),e.prototype.getPlaneIndex=function(){return this._planeIndex},Object.defineProperty(e.prototype,"bodyType",{get:function(){return this._bodyType},enumerable:!0,configurable:!0}),e.prototype.updateView=function(){this._type===GridTypeEnum.HEAD?this.gridView.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[this._direction]+"_H"):this._type===GridTypeEnum.BODY?this.gridView.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[this._direction]+"_"+this._bodyType):this.gridView.texture=null},e.prototype.resetView=function(){this._planeIndex=0,this._type=GridTypeEnum.MISS,this._bodyType=BodyGridEnum.UNSET,this._direction=DirectionTypeEnum.UNSET,this.gridView.texture=null,this.updateView()},e.prototype.setPlane=function(t,e,i,n){this._planeIndex=t,this._direction=n,this._bodyType=i,this._type=e,this.updateView()},Object.defineProperty(e.prototype,"selected",{set:function(t){t?DrawUtil.setImageColor(this.gridView,8947848):DrawUtil.setImageColor(this.gridView,16777215)},enumerable:!0,configurable:!0}),e.prototype.setPlaneEnable=function(t){void 0===t&&(t=!0),t?DrawUtil.setImageColor(this.gridView,65280):DrawUtil.setImageColor(this.gridView,16711680)},e.prototype.setNoPlaneLanding=function(){DrawUtil.setImageColor(this.gridView,16777215)},e}(GridView);__reflect(PlacingGridView.prototype,"PlacingGridView");var PlacingMsgView=function(t){function e(){var e=t.call(this)||this;return e.msgKey=["playerName","排名","城镇积分","可掠夺金币","被进攻次数","S率","摧毁炮数"],e.msgValue=["level","rank","city_score","gold_can_rob","attack_times","S_rate","success"],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.viewBg=new egret.Bitmap,this.viewBg.texture=RES.getRes("msg_png"),this.msgContainer=new egret.Sprite,this.addChild(this.msgContainer);for(var t,e,i=0;i<this.msgKey.length;i++)t=new egret.TextField,t.text=this.getPlayerData(this.msgKey[i]),t.x=20+Math.floor(i%2)*AdaptSceenUtil.curWidth()/2,t.y=10+Math.floor(i/2)*t.height,e=t.width,this.addChild(t),t=new egret.TextField,t.text=this.getPlayerData(this.msgValue[i]),t.x=e+20+Math.floor(i%2)*AdaptSceenUtil.curWidth()/2,t.y=10+Math.floor(i/2)*t.height,this.addChild(t);this.viewBg.width=this.msgContainer.width,this.addChild(this.viewBg)},e.prototype.getPlayerData=function(t){return-1!==t.indexOf("msg")?this.opponentData[t]:t},e}(egret.Sprite);__reflect(PlacingMsgView.prototype,"PlacingMsgView");var PlacingScene=function(t){function e(){var e=t.call(this)||this;return e.amount=0,e.draggingGridId=-1,e.currentDraggingGridId=-1,e.current_selected=0,e.dragging=!1,e.planeList=[],e.selectedHead=-1,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.msgView=new PlacingMsgView,this.msgView.anchorOffsetX=this.msgView.width/2,this.msgView.x=AdaptSceenUtil.curWidth()/2,this.msgView.y=100+AdaptSceenUtil.y_fix()/2,this.addChild(this.msgView),this.gameView=new GameView(!0),this.addChild(this.gameView),this.drag_plane=new PlaneView,this.drag_plane.visible=!1,this.addChild(this.drag_plane),this.controlView=new PlacingControlView,this.controlView.x=0,this.controlView.visible=!1,this.controlView.y=AdaptSceenUtil.curHeight()-this.controlView.height,SceneManager.getInstance().getUILayer().addChild(this.controlView),this.backButton=new E8Button(this,RES.getRes("back_png"),this.onBackButtonTouched),this.backButton.touchEnabled=!0,this.backButton.x=-10,this.backButton.y=32+AdaptSceenUtil.y_fix()/2,this.addChild(this.backButton),this.gameView.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.releaseOut,this)
},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toCityScene()},e.prototype.resetView=function(){this.amount=0,this.gameView.resetView()},e.prototype.inAnimate=function(){this.controlView.visible=!0,this.visible=!0},e.prototype.outAnimate=function(){this.controlView.visible=!1,this.visible=!1},e.prototype.addOnePlane=function(t,e,i){this.gameView.gridList[e].setPlane(t,GridTypeEnum.HEAD,BodyGridEnum.UNSET,i);for(var n=DirectionTypeEnum.getGridByDirection(i),r=0;r<n.length;r++)this.gameView.gridList[e+n[r]].setPlane(t,GridTypeEnum.BODY,r,i);this.planeList.push({head:e,direction:i})},e.prototype.removeOnePlane=function(t){var e=this.gameView.gridList[t],i=e.direction;e.setPlane(0,GridTypeEnum.MISS,BodyGridEnum.UNSET,DirectionTypeEnum.UNSET);for(var n=DirectionTypeEnum.getGridByDirection(i),r=0;r<n.length;r++)this.gameView.gridList[t+n[r]].setPlane(0,GridTypeEnum.MISS,BodyGridEnum.UNSET,DirectionTypeEnum.UNSET);this.removeHeadFromList(t)},e.prototype.removeHeadFromList=function(t){for(var e=0;e<this.planeList.length;e++)if(this.planeList[e].head===t){this.planeList.splice(e,1);break}},e.prototype.selectOneGrid=function(t){var e=this.gameView.gridList[t];e.type===GridTypeEnum.MISS?0!==this.current_selected&&this.cancelSelected():e.type===GridTypeEnum.BODY?this.current_selected===e.getPlaneIndex()?this.cancelSelected():(0!==this.current_selected&&this.cancelSelected(),this.selectOnePlane(t)):e.type===GridTypeEnum.HEAD&&(this.current_selected===e.getPlaneIndex()?this.cancelSelected():(0!==this.current_selected&&this.cancelSelected(),this.selectOnePlane(t)))},e.prototype.cancelSelected=function(){if(0!==this.current_selected){var t=this.planeList[this.current_selected-1],e=t.head,i=t.direction,n=DirectionTypeEnum.getGridByDirection(i);this.gameView.gridList[e].selected=!1;for(var r=0;r<n.length;r++)this.gameView.gridList[e+n[r]].selected=!1;this.dragging=!1,this.currentDraggingGridId=-1,this.current_selected=0}},e.prototype.selectOnePlane=function(t){this.dragging=!0,this.draggingGridId=t;var e,i,n=this.gameView.gridList[t],r=n.direction,o=DirectionTypeEnum.getGridByDirection(r);n.type===GridTypeEnum.BODY?(e=n.bodyType,i=t-o[e]):i=t,this.gameView.gridList[i].selected=!0;for(var s=0;s<o.length;s++)this.gameView.gridList[i+o[s]].selected=!0;this.current_selected=n.getPlaneIndex(),this.selectedHead=i},e.prototype.releaseOnePlane=function(t,e){if(this.dragging&&this.currentDraggingGridId!==t){var i,n,r=this.gameView.gridList[this.draggingGridId],o=r.direction,s=DirectionTypeEnum.getGridByDirection(o);r.type===GridTypeEnum.BODY?(i=r.bodyType,n=t-s[i]):n=t,this.checkValid(n,o)?(this.removeOnePlane(this.selectedHead),this.addOnePlane(this.current_selected,n,o),this.cancelSelected(),this.gameView.updateView(),this.drag_plane.clearView()):this.cancelSelected(),this.drag_plane.visible=!1;for(var a=0;a<this.gameView.gridList.length;a++){var l=this.gameView.gridList[a];l.setNoPlaneLanding()}}},e.prototype.checkValid=function(t,e){var i=!1,n=this.gameView.gridList[t];if(!MapUtil.checkHeadAndDirection(t,e))return!1;if(0!==n.getPlaneIndex()&&n.getPlaneIndex()!==this.current_selected)return i;var r=DirectionTypeEnum.getGridByDirection(e);if(0===r.length)return!1;for(var o=0;o<r.length;o++){var s=this.gameView.gridList[t+r[o]];if(0!==s.getPlaneIndex()&&s.getPlaneIndex()!==this.current_selected)return i}return i=!0},e.prototype.movingOnePlane=function(t,e){if(this.dragging&&this.currentDraggingGridId!==t&&(this.drag_plane.visible||(this.drag_plane.visible=!0,this.drag_plane.setView(t),this.contains(this.drag_plane)||this.addChild(this.drag_plane)),this.drag_plane.x=e.stageX,this.drag_plane.y=e.stageY,this.draggingGridId!==t)){var i,n=this.gameView.gridList[this.draggingGridId],r=void 0,o=n.direction,s=DirectionTypeEnum.getGridByDirection(o),a=DirectionTypeEnum.getRowFromHeadByDirection(o);n.type===GridTypeEnum.BODY?(r=n.bodyType,i=t-s[r]):i=t;var l=[];l.push(i),s.forEach(function(t){l.push(t+i)});for(var u=0;u<this.gameView.gridList.length;u++){var c=this.gameView.gridList[u].id,h=this.gameView.gridList[c];-1!==l.indexOf(c)&&h.type!==GridTypeEnum.MISS&&a[l.indexOf(c)]+a[l.indexOf(t)]===MapUtil.getYOffset(i,c)+MapUtil.getYOffset(i,t)?h.getPlaneIndex()!==this.current_selected?h.setPlaneEnable(!1):h.setPlaneEnable(!0):h.setNoPlaneLanding()}}},e.prototype.rotationPlane=function(t){var e=this.gameView.gridList[t];if(e.type!==GridTypeEnum.MISS){this.current_selected=e.getPlaneIndex();var i,n,r=e.direction,o=DirectionTypeEnum.getGridByDirection(r);e.type===GridTypeEnum.BODY?(i=e.bodyType,n=t-o[i]):n=t;for(var s=MapUtil.rotationPlane(n,r),a=!1;s.direction!==r;){if(this.checkValid(s.head,s.direction)){var l=e.getPlaneIndex();this.removeOnePlane(n),this.addOnePlane(l,s.head,s.direction),a=!0;break}s=MapUtil.rotationPlane(s.head,s.direction)}a||SceneManager.getInstance().showTip("这个位置不太好转,挪动一下再试试"),this.cancelSelected()}},e.prototype.releaseOut=function(t){this.releaseOnePlane(this.draggingGridId,t)},e.prototype.getPlane=function(t){return[]},e.prototype.getDraggingRealHead=function(){return this.selectedHead},Object.defineProperty(e.prototype,"planeAmount",{set:function(t){this.amount=t},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(PlacingScene.prototype,"PlacingScene",["Scene"]);var PlaneGrid=function(){function t(){}return t}();__reflect(PlaneGrid.prototype,"PlaneGrid");var PlaneView=function(t){function e(){var e=t.call(this)||this;return e.gridViewList=[],e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.grid_sheet=RES.getRes("plane_sheet"),this.drag_index=0;for(var t,e=0;10>e;e++)t=new egret.Bitmap,this.gridViewList.push(t),this.addChild(t)},e.prototype.clearView=function(){},e.prototype.setView=function(t){var e=SceneManager.getInstance().placingScene.gameView,i=e.gridList[t];this.drag_index=i.getPlaneIndex();var n,r,o=i.direction,s=DirectionTypeEnum.getGridByDirection(o);i.type===GridTypeEnum.HEAD?r=t:(n=i.bodyType,r=t-s[n]),this.addGrid(o,"_H",t,r);for(var a=0;a<s.length;a++)this.addGrid(o,"_"+a,t,e.gridList[r+s[a]].id)},e.prototype.addGrid=function(t,e,i,n){var r=this.gridViewList.shift();r.texture=this.grid_sheet.getTexture(DirectionTypeEnum.DIRECTION_LETTER[t]+e),r.x=-30+60*MapUtil.getXOffset(i,n),r.y=-30+60*MapUtil.getYOffset(i,n),this.gridViewList.push(r)},e.prototype.getIndex=function(){return this.drag_index},e}(egret.Sprite);__reflect(PlaneView.prototype,"PlaneView");var StoreCardView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){if(this.gameView=new GameView(!0),this.heads=this.data.heads,3!==this.heads.length)console.log("头信息错误");else for(var t=0;t<this.heads.length;t++)this.addOnePlane(this.heads[t].head,this.heads[t].direction)},e.prototype.addOnePlane=function(t,e){},e}(egret.Sprite);__reflect(StoreCardView.prototype,"StoreCardView");var Report=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(egret.Sprite);__reflect(Report.prototype,"Report");var ResultScene=function(t){function e(){var e=t.call(this)||this;return e.title=new egret.Bitmap,e.title.y=200,e.addChild(e.title),e.score=new egret.Bitmap,e.score.y=AdaptSceenUtil.curHeight()/2,e.addChild(e.score),e.bullet_animate=new egret.MovieClip,e.backButton=new E8Button(e,RES.getRes("back_png"),e.onBackButtonTouched),e.backButton.touchEnabled=!0,e.backButton.x=-10,e.backButton.y=32+AdaptSceenUtil.y_fix()/2,e.addChild(e.backButton),e.shareButton=new E8TextButton(e,RES.getRes("share_png"),e.shareButtonTouched),e.shareButton.setButtonText("分享此地图"),e.shareButton.touchEnabled=!0,e.shareButton.anchorOffsetX=e.shareButton.width/2,e.shareButton.anchorOffsetY=e.shareButton.height/2,e.shareButton.x=AdaptSceenUtil.curWidth()/2+40,e.shareButton.y=AdaptSceenUtil.curHeight()/2+300,e.addChild(e.shareButton),e.reward_control=new RewardControlView,e.reward_control.width=AdaptSceenUtil.curWidth(),e.reward_control.x=0,e.reward_control.y=AdaptSceenUtil.curHeight()-e.reward_control.height,e.reward_control.visible=!1,e.addChild(e.reward_control),e}return __extends(e,t),e.prototype.shareButtonTouched=function(){},e.prototype.onBackButtonTouched=function(){SceneManager.getInstance().toCityScene()},e.prototype.showResult=function(t,e){switch(void 0===t&&(t=ResultTypeEnum.WIN),void 0===e&&(e=ScoreTypeEnum.NO_SCORE),t===ResultTypeEnum.WIN?this.title.texture=RES.getRes("win_png"):t===ResultTypeEnum.FAIL?this.title.texture=RES.getRes("fail_png"):t===ResultTypeEnum.GIVE_UP&&(this.title.texture=RES.getRes("give_up_png")),this.title.x=AdaptSceenUtil.curWidth()/2-this.title.width/2,e){case ScoreTypeEnum.SSS:this.score.texture=RES.getRes("sss_png");break;case ScoreTypeEnum.S:this.score.texture=RES.getRes("s_png");break;case ScoreTypeEnum.A:this.score.texture=RES.getRes("a_png");break;case ScoreTypeEnum.B:this.score.texture=RES.getRes("b_png");break;case ScoreTypeEnum.C:this.score.texture=RES.getRes("c_png")}this.score.x=AdaptSceenUtil.curWidth()/2-this.score.width/2},e.prototype.inAnimate=function(){this.reward_control.visible=!0,this.visible=!0},e.prototype.outAnimate=function(){this.reward_control.visible=!1,this.visible=!1},e}(egret.Sprite);__reflect(ResultScene.prototype,"ResultScene");var RewardCardView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("map_bg_png"),this.addChild(this.bg)},e}(egret.Sprite);__reflect(RewardCardView.prototype,"RewardCardView");var RewardControlView=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.controlViewBg=new egret.Bitmap,this.controlViewBg.texture=RES.getRes("control_bg_png"),this.addChild(this.controlViewBg),this.scrollView=new egret.ScrollView,this.rewardContainer=new egret.Sprite,this.rewardList=new Array;for(var t,e=0;5>e;e++)t=new RewardCardView,t.touchEnabled=!0,t.x=200*e,this.rewardContainer.addChild(t);this.scrollView.x=90,this.scrollView.width=AdaptSceenUtil.curWidth()-90,this.scrollView.y=80,this.scrollView.height=200,this.scrollView.bounces=!1,this.scrollView.touchEnabled=!0,this.scrollView.setContent(this.rewardContainer),this.addChild(this.scrollView)},e.prototype.updateView=function(){},e}(egret.Sprite);__reflect(RewardControlView.prototype,"RewardControlView");